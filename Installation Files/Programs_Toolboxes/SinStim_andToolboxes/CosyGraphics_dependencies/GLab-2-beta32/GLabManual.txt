                _______________________________________________ 
               |                                               |
               |                  G - L  A  B                  |
               |              Graphics Laboratory              |
               |                                               |
               |        R e f e r e n c e   M a n u a l        |
               |_______________________________________________|


Version 2-beta28



I. G-LAB FUNCTIONS (by Ben Jacob):
===========================================================================


% CHECKERRORS  Error check and error message display.
%    CHECKERRORS(CallingFun,'missedframes',FramesMissed,Tolerance,<isIsochronous>)
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% WAITKEYSEQUENCE  Wait for a sequence of key presses.
%    WAITKEYSEQUENCE(KeySequence)
%    WAITKEYSEQUENCE(KeySequence,isUpEventSequence)
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% BACKGROUNDMASK  Make a binary background mask.
%    BG = BACKGROUNDMASK(I)  returns the logical matrix BG, where background  
%    pixels in image I are represented by 1 and non-background pixels by 0. 
%    Background color will be determined automatically.
%
%    BG = BACKGROUNDMASK(C)  where C is a cell array containing image matrices,
%    returns background matrices in the cell array BG of same dimensions than C.
%
%    BG = BACKGROUNDMASK(I|C,bgcolor)  does the same for given backgroundcolor.
%    bgcolor is a [r,g,b] vector in the range 0.0-1.0.
%
%    BG = BACKGROUNDMASK(I|C <,bgcolor>, err)  searches for RGB values +/- err.  
%    'err' value can be either in the range 0.0-1.0 or 0-255. Default is 1/255.
%
%    BG = BACKGROUNDMASK(I|C <,bgcolor>, err, ErodeForm, FillHoles)  <TODO!>
%
%    BG = BACKGROUNDMASK(I|C <,bgcolor>, err, ErodeForm)  erodes the foreground
%    (i.e.: adds background pixels to the background border). ErodeForm is the 
%    number of pixels of dilation. If it's a negative number, background will 
%    be eroded.
%
%    [BG,bgcolor] = BACKGROUNDMASK(I <,err>)  returns also the background color.
%    I must be a matrix, not a cell array.
%
% See also HSVMASK.
%
% Ben,	Oct. 2007.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% BUFFERSIZE   Size of offscreen buffer.
%    wh = BUFFERSIZE(b), returns the two-element row vector wh = [w h]
%    containing the width and heigth in pixel of buffer b.
%
%    [W,H] = BUFFERSIZE(B) returns width and height as separate output
%    variables. B can be a buffer handle or an array of buffer handles.
%
%    W = BUFFERSIZE(B,1) returns the width.
%
%    H = BUFFERSIZE(B,2) returns the height.
%
%    !!! ---  Note that we don't use standard Matlab convention: Matlab's  
%    SIZE function returns height (number of rows) first and width (number
%    of columns) in second. We do the reverse!  --- !!!
%
% See also IMAGESIZE, NEWBUFFER.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% CDGLAB  Change directory to G-Lab's root directory.
%    CDGLAB
%    CDGLAB(SUBDIR)
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% CHANGEBACKGROUND  Change background color of an image matrix.
%    I = CHANGEBACKGROUND(I,BG,color)  Change background of image matrix I,
%    as defined by background mask BG (see BACKGROUNDMASK) to given color.
%    I and BG can also be cell arrays containing image matrices and 
%    corresponding background masks.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% CHECKKEYDOWN  Check current state of keyboard keys.
%
%    [keyNumber,keyCode,keyTime] = CHECKKEYDOWN;  checks which keys are down
%    currently. Invalid keys (e.g.: special keys on laptops) are not checked.
%    This function does not interfere with the keyboard stack (Cog 1.24 only).
%
%    [keyNumber,keyCode,keyTime] = CHECKKEYDOWN(keyName|keyNumber|keyCode);
%    checks given keys only.
%
%    [keyNumber,keyCode,keyTime] = CHECKKEYDOWN('All');  checks all keys (i.e.: 
%    valid or not).
%
% See also GETKEYCODE, GETKEYNAME.
%
% Ben, Oct. 2008
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% CHECKPARALLELBYTE  Get parallel port current value.
%    CHECKPARALLELBYTE  by itself, displays current parallel port value in Command Window.
%
%    [N,BITS] = CHECKPARALLELBYTE  gets parallel port value both as an integer N (0 <= n <= 255)  
%    and, optionnally, as a logical vector of bit values BITS.
%
%    [N,BITS] = CHECKPARALLELBYTE(n) <TODO!>  checks LPTn
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% CHECKSERIAL  Helper function.
%    ERROR(CHECKSERIAL(i))  Error if port #i is not open.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% CLEARBUFFER   Clear offscreen buffer.
%    CLEARBUFFER(b)  clears buffer b to default background color (as set 
%    with SETBACKGROUND).
%
%    CLEARBUFFER  is the same than  CLEARBUFFER(0).
%
%	 CLEARBUFFER(b,color)  clears buffer b to given color.
%	
% Example:
%	 clearbuffer(6,[1 1 1]);  % clears buffer 6 to white.
%
% Performances:
%    With no background buffer, on WinXP, on Matlab 6.5, on DARTAGNAN:
%    - On PTB:    0.18 ms
%    - On Cogent: 0.38 ms
%
% See also NEWBUFFER SETBACKGROUND.
%
% Ben, 	Sept 2007
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% CLEARGLAB  Stop G-Lab, if running, and clear all G-Lab's global variables.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% CLEARKEYEVENTS  Clear the key events stack.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% CLEARSERIALBYTES clears bytes sent to serial port since last call to READSERIALBYTES
%
% Description:
%      Clears bytes sent to serial port since last call to READSERIALBYTES
%
% Usage:
%   CLEARSERIALBYTES( port )
%
% Arguments:
%     port - port number
%
% See also:
%     CONFIG_SERIAL, READSERIALBYTES, SENDSERIALBYTES, LOGSERIALBYTES, WAITSERIALBYTE, GETSERIALBYTES
%     CLEARSERIALBYTES
%
% Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% CLOSEPARALLELPORT  Close parallel port.
%    CLOSEPARALLELPORT  closes all open parallel ports.
%
%    CLOSEPARALLELPORT(n)  closes LPTn.
%
% Ben, Nov. 2007 v1.0
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% CLOSEPHOTODIODE  End display of photodiode squares.
%    CLOSEPHOTODIODE
%
% See also: OPENPHOTODIODE.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% CLOSESERIALPORT  Close serial port.
%    CLOSESERIALPORT  closes the serial port you had opened with OPENSERIALPORT.
%       (As the OPENSERIALPORT can only open one port at a time, you don't need
%       to specify the port number.) If no port is open, does nothing.
%
% See also: OPENSERIALPORT.
%
% Ben, Nov. 2007
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% COLOR2GRAY   Color to grayscale conversion.
%    color = COLOR2GRAY(color)  Convert rgb vector or M-by-3 matrix 'color' to b&w.
%    I = COLOR2GRAY(I)          Convert M-by-N-by-3 image matrix 'I' to b&w.
%
% For theory, see:  http://en.wikipedia.org/wiki/Luma_%28video%29
%
% See also RGB2GRAY (Image Processing Toolbox)
%
% Ben, Oct 2007
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% CONVERTCOORD  Convert between coordinates systems.
%    This function is a tool used by other G-Lab functions.
%
%    varargout = CONVERTCOORD(Formula,varargin)
%
% Spatial coordinates:
%    XYXY = CONVERTCOORD( 'XY,WH -> XYXY'  , XY,WH)   
%
%    JI   = CONVERTCOORD(    'XY -> JI'    , XY, <b|wh> )  or,
%    JI   = CONVERTCOORD('XYXYXY -> JIJIJI', XY, <b|wh> )  is the same than above.
%
%    JI   = CONVERTCOORD( 'XY,WH -> JI,WH' , XY, <b|wh> )
%
%    JIJI = CONVERTCOORD( 'XY,WH -> JIJI'  , XY,WH, <b|wh> ) 
%    JIJI = CONVERTCOORD(  'XYXY -> JIJI'  , XYXY,  <b|wh> ) 
%
%    RECT = CONVERTCOORD( 'XY,WH -> RECT'  , XY,WH, <b|wh> )  % CG -> PTB !
%    RECT = CONVERTCOORD(  'XYXY -> RECT'  , XYXY,  <b|wh> )
%    RECT = CONVERTCOORD(  'JIJI -> RECT'  , JIJI )         
%    
%    Variables:
%       XY, WH          Cogent coord.: [x,y], [width,heigth], Cartesian coord. (x,y= center).
%       XYXY            [x0,y0,x1,y1], Cartesian coord.
%       JIJI            [j0,j0,i1,i1], graphics coord. (= [left,up,rigth,down])
%       XY or XYXYXY    Cartesian coord. M-by-N matrix. Odd cols: x ; even cols: y. (x,y = center)
%       JI or JIJIJI    Graphics coord.  M-by-N matrix. Odd cols: j ; even cols: i. (j,i = center)
%       JI, WH          [j0,i0], [width,heigth], Graphics coord. (j0,i0 = upper-left corner).
%       RECT            PsychToolBox "rect" argument.
%       b               Buffer ID. Always optional. Default is 0 (backbuffer).
%       wh              [width,heigth] of the buffer. Can replace b.
%
% Color coordinates:
%    CONVERTCOORD('RGB-MATLAB -> RGB-PTB', RGB)  converts standard Matlab RGB
%    matrix (N-by-3, double 0:1 or uint 0:255), to PsychToolBox "rgb" argument  
%    (3-by-N, double 0:255).
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% CONVERTCOORD  Convert between coordinates systems.
%    This function is a tool used by other G-Lab functions.
%
%    varargout = CONVERTCOORD(Formula,varargin)
%
% Spatial coordinates:
%    XYXY = CONVERTCOORD( 'XY,WH -> XYXY'  , XY,WH)   
%
%    JI   = CONVERTCOORD(    'XY -> JI'    , XY, <b|wh> )  or,
%    JI   = CONVERTCOORD('XYXYXY -> JIJIJI', XY, <b|wh> )  is the same than above.
%
%    JI   = CONVERTCOORD( 'XY,WH -> JI,WH' , XY, <b|wh> )
%
%    JIJI = CONVERTCOORD( 'XY,WH -> JIJI'  , XY,WH, <b|wh> ) 
%    JIJI = CONVERTCOORD(  'XYXY -> JIJI'  , XYXY,  <b|wh> ) 
%
%    RECT = CONVERTCOORD( 'XY,WH -> RECT'  , XY,WH, <b|wh> )  % CG -> PTB !
%    RECT = CONVERTCOORD(  'XYXY -> RECT'  , XYXY,  <b|wh> )
%    RECT = CONVERTCOORD(  'JIJI -> RECT'  , JIJI )         
%    
%    Variables:
%       XY, WH          Cogent coord.: [x,y], [width,heigth], Cartesian coord. (x,y= center).
%       XYXY            [x0,y0,x1,y1], Cartesian coord.
%       JIJI            [j0,j0,i1,i1], graphics coord. (= [left,up,rigth,down])
%       XY or XYXYXY    Cartesian coord. M-by-N matrix. Odd cols: x ; even cols: y. (x,y = center)
%       JI or JIJIJI    Graphics coord.  M-by-N matrix. Odd cols: j ; even cols: i. (j,i = center)
%       JI, WH          [j0,i0], [width,heigth], Graphics coord. (j0,i0= upper-left corner).
%       RECT            PsychToolBox "rect" argument.
%       b               Buffer ID. Always optional. Default is 0 (backbuffer).
%       wh              [width,heigth] of the buffer. Can replace b.
%
% Color coordinates:
%    CONVERTCOORD('RGB-MATLAB -> RGB-PTB', RGB)  converts standard Matlab RGB
%    matrix (N-by-3, double 0:1 or uint 0:255), to PsychToolBox "rgb" argument  
%    (3-by-N, double 0:255).
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% COPYBUFFER   Copy a whole offscreen buffer on another offscreen buffer.
%	 COPYBUFFER(b0,b1)  copies source buffer b0 on target buffer b1.
%
%    COPYBUFFER(b0,b1,XY)  copies with an x, y offset.
%
% TODO: Fix multiple source buffers!
%
% Copy a rectangular area: <Todo>
%    COPYBUFFER(b0,b1,XY,WH)  <todo> copies only a rectangular area
%    COPYBUFFER(b0,b1,XYXY)   <todo> copies only a rectangular area from buffer b0 to
%    the same rectangular location in buffer b1.
%    COPYBUFFER(b0,b1,XYXY0,XY1)  <todo> copies  rectangular area from buffer b0 to XY
%    location in buffer b1. XY are cartesian coord. of the center of the rect., in
%    pixels.
%   
% Image Processings: <todo???: Move this in DRAWSTOREDIMAGE ???>
%    The following effects are properly supported only if PTB is used as the graphics 
%    library. (The 'Alpha' effect is availaible on CogentGraphics v1.28, with
%    "startcogent(...'AlphaMode')", but they are performances and synchronization issues.)
%
%    COPYBUFFER(...,'-rotation',Theta)  applies a rotation of Theta degrees.
%    Only avalaible on PTB, for the moment. <todo: Implement it on CG 1.28>
%
%    COPYBUFFER(...,'-alpha',Alpha)  copies with a global translucency value Alpha. Alpha 
%    takes value from 0 (fully transparent) to 1 (fully opaque). If they is an Alpha channel,
%    in the image to be copied, the resulting translucency value will be the multiple of the 
%    alpha channel by the global Alpha factor.
%
%    COPYBUFFER(...,'-colorfilter',RGB|RGBA)  modulates each color channel. E.g., 
%    ColorFilter = [.5 1 0] would leave the green- and Alpha-channel untouched, but it would 
%    multiply the blue channel with 0 - set it to zero blue intensity, and it would multiply 
%    each pixel in the red channel by 0.5 - reducing its intensity to 50%. The most interes-
%    ting application is drawing of arbitrary complex shapes of selectable color: Simply 
%    store a grayscale image, possibly with Alpha channel, in a buffer then draw it with
%    'ColorFilter' set to the wanted color and global Alpha value. 
%    If an 'Alpha' value is also specified, 'Alpha' and 'ColorFilter' have a multiplicative 
%    effect.
%
%    COPYBUFFER(...,'-filter',kernel)  <TODO>
%
% Deprecated syntax:
%   COPYBUFFER(b0,b1,x,y)
%
% See also DISPLAYBUFFER, COPYBUFFERRECT.
%   
% Ben, 	Sept 2007
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% COPYBUFFERRECT   <deprecated>
% Copy a rectangle of pixel values from an offscreen buffer to another.
%	COPYBUFFERRECT(b0,b1,rect)  copies the rectangle 'rect'  
%	in the source buffer b0 to the same position in the target buffer b1.
%	'rect' is a vector of the form [x0 y0 x1 y1] or of the form [x0 y1 x1 y0].
%   See HELP DRAWRECT for more info.
%<TODO: 'pos' -> 'rect'>
%
%	COPYBUFFERRECT(b0,b1,rect,xy)
%
%   COPYBUFFERRECT(b0,b1,rect0,rect1)  copies the rectangle rect0 in buffer b0
%   to rect1 in buffer b1. 'rect0' and 'rect1' are vector either of the form 
%   [x0 y0 x1 y1] or of the form [x0 y1 x1 y0]. See HELP DRAWRECT for more info.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% PIX2DEG  Degrees to pixels conversion.
%    pix = DEG2PIX(deg)
%
% See also DEG2PIX, SETSCREENSIZECM, SETVIEWINGDISTANCECM, SETHARDWARE<todo>.
%
% Ben, June 2010.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% DELETEBUFFER   Delete offscreen b.
%    DELETEBUFFER(b)  deletes offscreen buffer(s) of given handle(s).
%    b is a scalar or a vector.
%
%    DELETEBUFFER ALL  deletes all offscreen buffers. (Exept buffer 0 
%    wich cannot be deleted.)
%
% Ben, Sept 2007
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% demo_philippe3: Blue robe/red robe
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
%% DISPLAYANIMATION  Real-time display of a sequence of images to be build from pre-stored buffers.
%    [DisplayTimes,FrameErr] = DISPLAYANIMATION(B,X,Y)  displays sequence buffers whose handles are stored
%    in matrix B. Each buffer will be displayed with X and Y offsets during one screen frame. B, X
%    and Y are either scalars (buffer/x/y constant) or b-by-N matrices, where b is the number of
%    buffers per frames and N is the number of frames to display (buffer/x/y variable). It returns
%    1-by-N vectors DisplayTimes (timestamps of begins of vertical blankings) and FrameErr.
%
%    [DisplayTimes,FrameErr] = DISPLAYANIMATION(B,X,XAlign,Y,YAlign)  specifies the x/y alignement. XAlign
%    can be 'L', 'C' or 'R' to align on left, center or right respectivelly. YAlign ca be 'T', 'C'
%    or 'B' (top, center, bottom). XAlign and YAlign can also be b-by-N matrices of characters.
%
%    [DisplayTimes,FrameErr] = DISPLAYANIMATION(...,Durations)  specifies durations (in ms) of display
%    for each image buffer. 'Durations' is a 1-by-N vector (N is the number of images). Values of 0
%    are interpreted as 1 frame duration.
%
%% Image Processings (PTB only):
%    The following options are only availables if PTB is used as graphics library.
%
%    DISPLAYANIMATION(...,'Alpha',ALPHA)  copies buffers with an alpha (translucency)
%    factor. ALPHA is a b-by-N matrix (see above).
%
%    DISPLAYANIMATION(...,'Scale',S)  copies buffers with a scaling factor S. (S=1 is 100%.)
%
%    DISPLAYANIMATION(...,'BufferRotation',THETA)  copies buffers with a rotation. THETA is
%    a b-by-N matrix (see above) containing the rotation angles, in degrees, clockwise.
%
%    DISPLAYANIMATION(...,'AxesRotation',THETA)  copies buffers with a rotation of both (x,y)
%    coordinates and buffer orientation. THETA is a b-by-N matrix (see above) containing the
%    rotation angles, in degrees, clockwise. If you want to rotate the x, y coordinates but not
%    the buffer orientation, use:  DISPLAYANIMATION(...,'AxesRotation',THETA,'BufferRotation',0).
%
%% Drawings:
%    DISPLAYANIMATION(...,'Draw',Draw.Draw.Shape,X,Y,W,<H>,RGB,<LineWidth>) draws geometrical
%    object(s). Draw.Draw.Shape can be 'square', 'rect', 'round', 'oval' or 'cross' (if shape is
%    constant) ; it can also be a 1-by-N cell array of strings, one for each image to display (if
%    shape varies). X, Y, W (widths), H (heigths) and LineWidth are s-by-N matrices, where s is the
%    number of shapes to draw and N is the number of frames to display.
%    H and LineWidth are optionnals. RGB is a s-by-N-by-3 matrix or rgb values, in the range 0.0 to
%    1.0. In all matrices missing values are replaced by NaNs.
%    See DRAWSHAPE for more informations.
%
%% Triggers and Events:
%    [DisplayTimes,FrameErr,TrigTimes] = DISPLAYANIMATION(...,'Wait',Device,Bytes)  waits trigger.
%    <todo: not yet implemented>
%
%    [DisplayTimes,FrameErr,EventValues,EventTimes] = DISPLAYANIMATION(...,'Get',Device,Values)  gets
%    events from device during the animation. Device can only be 'Keyboard'. <todo: Implement others.>
%    Values are the IDs of the keys to wait for.
%
%    [DisplayTimes,FrameErr,SendTimes] = DISPLAYANIMATION(...,'Send',Device,Bytes)  sends bytes
%    through device. Device can be 'parallel', 'serial' or 'photodiode'. <todo: 'Daq'> "Bytes" is a
%    1-by-N or 1-by-(N+1) vector, containing values to be sent (integers from 1 to 255)
%    and 0s or NaNs where nothing has to be sent. With parallel port you cannot send the same value
%    two times in a row. With photodiode, values are half-bytes (from 0 to 15) (1: upper-left
%    corner, 2: upper-right, 4: lower-left, 8: lower-right; numbers can be added). Bytes will be
%    sent at the beginning of the display (refresh cycle onset) of the corresponding image. If there
%    is a (N+1)th value, it will be sent at the end of the last display.
%
%    If more than one of these options is used, output argume order is:
%    [DisplayTimes,FrameErr,EventValues,EventTimes,SendTimes] = DISPLAYANIMATION(...)
%
%% Real-time Control:
%    DISPLAYANIMATION(...,'FrameErrorEvent',Device,ErrorCode)  sends ErrorCode through Device each
%    time a frame has been missed. Device can be 'parallel' or 'serial'. ErrorCode is an integer
%    from 1 to 255.
%
%    [DisplayTimes,FrameErr] = DISPLAYANIMATION(...,'Isochronous',flag)  in isochronous mode (flag=1), the
%    function corrects timing errors due to missed refresh deadlines by skipping the next frame after
%    each missed refresh. This will be perfectly efficient if PTB can get high precision timestamps.
%    If PTB has to fallback to lower precision timestamps due to driver bugs, false positive are
%    possibles. Non-isochronous mode (flag=0) is the default. No correction are done in this mode, but
%    all images are guanrantied to be displayed.
%
%           Normal display (no errors):                 1, 2, 3, 4, 5, 6, 7,...
%           Missed frame #4, no correction:             1, 2, 3, 3, 4, 5, 6, 7,...
%           Missed frame #4, isochronous correction:    1, 2, 3, 3, 4, 6, 7,...    (skip frame #5 to correct phase shift)
%
%           Corresponding elements in vetors:          [1  2  3  4 NaN 6  7 ...]
%
%    DISPLAYANIMATION(...,'Priority',PriorityLevel)  sets priority level during animation.
%    PriorityLevel can be 'NORMAL', 'HIGH', 'REALTIME' or 'OPTIMAL'. (In the latter case, GLab will
%    choose for you the optimal solution; this is also the default behavior.)
%
%% Splash Screen:
%    DISPLAYANIMATION(...,'Splash',MessageString,BgColor,FontColor,<TimeOut>,<Delay>)  displays a splash
%    screen when ready and waits a key press to start the animation. MessageString is a cell array
%    of strings. 'TimeOut' (optional) is the max time to wait for, in milliseconds. Default value is inf.
%    'Delay' (optional) is the number of milliseconds to wait after the key press before to start. During 
%    the delay, a blank screen will be shown.
%
%%
% See also PREPARESINANIMATION.
%
% Ben, 2007-2009
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% DISPLAYBUFFER  Display content of offscreen buffer at next refresh cycle.
%    t = DISPLAYBUFFER  or  DISPLAYBUFFER(0)  flips the frontbuffer and the 
%    backbuffer of the onscreen window: at next refresh cycle the current 
%    backbuffer will become the new frontbuffer and be displayed. Returns time
%    of the beginning of the screen refresh cycle, in milliseconds.
%
%	 t = DISPLAYBUFFER(b)  displays buffer b. Buffer will first be copied
%    into the backbuffer (or buffer 0), then the backbuffer will be flipped
%    as explained above and displayed.
%
%    t = DISPLAYBUFFER(b,DUR)  displays buffer b for duration DUR (msec). DUR is actually
%    stored for the next DISPLAYBUFFER call, which will wait to display at time t + DUR. 
%    This is the same than  t = DISPLAYBUFFER(b); WAITSYNCH(DUR); DISPLAYBUFFER(b1);
%    which is deprecated.
%
%       Use  DISPLAYBUFFER(b,oneframe)  to display one frame only. See ONEFRAME.
%       Use  DISPLAYBUFFER(b,inf)  to display indefinitely. (For example until a WAITKEYDOWN returns.)
%       Use  DISPLAYBUFFER(b,0)  if you don't want to give an expected duration. (No automatic verifivation.)
%
%    The DUR argument is mandatory during a trial (i.e.: between STARTTRIAL and STOPTRIAL).
%
%    t = DISPLAYBUFFER(b,DUR,TAG)  if used between STARTTRIAL and STOPTRIAL, records
%    the string TAG in the automatically recorded trial data.
%
% Example:
%    % Draw consign in an offscreen buffer:
%    b1 = newbuffer; % use newbuffer to create a drawable offscreen buffer
%    drawtext('Look at the following image.',b1);
%    % Load image from file and store it an offscreen buffer:
%    I = loadimage(filename);
%    b2 = storeimage(I); % use storeimage to store image in an offscreen buffer
%    % Display:
%    displaybuffer(b1,700); % displays consign
%    displaybuffer(b2,2000); % waits 700 msec and display image
%    displaybuffer(0); % waits 2000 msec and clear screen (i.e.: display buffer 0, which had 
%                      % been automatically cleared after the last display.)
%
% Options:
%    DISPLAYBUFFER(...,'-photodiode',value) <TODO>
%
%    DISPLAYBUFFER(...,'-send','parallel',value,<delay>,<width>) <TODO>
%
%       Example:
%           startcogent;
%           openparallelport;
%           starttrial;
%           drawround(0,[0 0],100,[1 0 0]);
%           displaybuffer(0,150,'-send','parallel',[4 8 16],[0 100 200])
%           drawround(0,[0 0],100,[.4 0 1]);
%           displaybuffer(0,500)
%           stoptrial;
%
%    t = DISPLAYBUFFER(...,'-psbsync')  resets PSB timer at display onset. ("PSB" is Benoît Gerard's 
%    Psychophysics Synchronisation Box.)
%
% See also NEWBUFFER, STOREIMAGE, GCB, ONEFRAME.
%
% Ben,	Sept-Oct 2007
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% DISPLAYBUFFER  Display content of offscreen buffer at next refresh cycle.
%    t = DISPLAYBUFFER  or  DISPLAYBUFFER(0)  flips the frontbuffer and the 
%    backbuffer of the onscreen window: at next refresh cycle the current 
%    backbuffer will become the new frontbuffer and be displayed. Returns time
%    of the beginning of the screen refresh cycle, in milliseconds.
%
%	 t = DISPLAYBUFFER(b)  displays buffer b. Buffer will first be copied
%    into the backbuffer (or buffer 0), then the backbuffer will be flipped
%    as explained above and displayed.
%
%    t = DISPLAYBUFFER(b,WAIT)  waits WAIT duration in msec from the onset
%    of the previous display, then displays buffer b.
%    This is the same than  WAITSYNCH(WAIT); t = DISPLAYBUFFER(b);  which is
%    deprecated.
%
% Example:
%    % Draw consign in an offscreen buffer:
%    b1 = newbuffer; % use newbuffer to create a drawable offscreen buffer
%    drawtext('Press Enter when ready.',b1);
%    % Load image from file and store it an offscreen buffer:
%    I = loadimage(filename);
%    b2 = storeimage(I); % use storeimage to store image in an offscreen buffer
%    % Display:
%    displaybuffer(b1); % display consign
%    displaybuffer(b2,700); % wait 700 msec and display image
%    displaybuffer(0,2000); % wait 2000 msec and clear screen (i.e.: display buffer 0, which had 
%                           % been automatically cleared after the last display.)
%
% See also NEWBUFFER, STOREIMAGE, GCB
%
% Ben,	Sept-Oct 2007
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% DISPLAYERROR  Display error message in G-Lab screen.
%    DISPLAYERROR(String)
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% DISPLAYFRAMESEQ  Display trajectories prepared by FRAMESEQ.
%
%    DISPLAYFRAMESEQ(S)  display target defined by S. S is the output from FRAMESEQ (see).
%
%    DISPLAYFRAMESEQ(S, S2,... ,Sn)  displays main target S, plus secondary targets S2,...
%
% Example: 
%    See HELP FRAMESEQ.
%
% Options:
%    DISPLAYFRAMESEQ(...,'-tolwin',device,isActive,isDrawn)  sets tolerance window options. device
%    can be 'mouse' or 'eyelink'. isActive can be 0 (disable experiment control) or 1 (respect the
%    settings from FRAMESEQ. isDrawn can
%    be 0 (don't draw eye and tolerance window) or 1 (draw them).
% 
%    DISPLAYFRAMESEQ(...,'-sound',b,t)  plays sounds stored in buffers n° b (see STORESOUND, 
%    STORETUUT) at times t (ms). b and t are 1-by-N vectors. Note that you cannot play twice the 
%    same buffer ; if you need to play a sound more than once, store it several times in different
%    buffers.
%
%        Example: Synchronizing sound start with a display event:
%            startcogent;           % starts Cogent display, with default settings
%            opensound;             % initialize sound, with default settings
%            storetuut(3000,200,1); % stores a 3000 Hz, 200 ms, sine wave in buffer #1)
%            grayPoint = frameseq('round',20,[.5 .5 .5],'fix',[0 0],1000);  % gray point, 1 s
%            redPoint  = frameseq('round',20,[1 0 0],'fix',[0 0],700);      % red point, 700 ms
%            traj = [grayPoint redPoint]; 
%            displayframeseq(traj,'-sound',1,1000) % displays points, playing the sound when the point's color changes
%
% See also FRAMESEQ.
%
% Ben,  Jun 2010.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% DISPLAYMESSAGE  Display a message in G-Lab screen.
%    DISPLAYMESSAGE(Str,BackgroundColor,FontColor)
%
%    DISPLAYMESSAGE(Str,BackgrounColor,FontColor,Action,Key)
%
%    keyNumber = DISPLAYMESSAGE(Str,BackgrounColor,FontColor,Action1,Key1,Action2,Key2,...)
%
%    keyNumber = DISPLAYMESSAGE(...,TimeOut)  max time to wait for (ms). Returns 0 if time out
%    reached with no key press.
%
% See also: DISPLAYWARNING, DISPLAYERROR.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% DISPLAYWARNING  Display warning message in G-Lab screen.
%    DISPLAYWARNING(String)
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% DISPSCREENRESOLUTIONS  Print all available screen resolutions.
%    DISPSCREENRESOLUTIONS  displays a table with all screen resolutions and
%    corresponding refresh frequencies availables for the main screen.
%
%    DISPSCREENRESOLUTIONS(SreenNumber)  id. for given screen.
%
% Ben, June 2010.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% DRAW  Primitive drawing function, used by other DRAW* functions.
%    This function is used by all DRAW* functions, except DRAWTEXT.  See each particular function to
%    get help.  DRAW by itself can be usefull to be useed it directly if the shape itself is 
%    variable.
%
%    DRAW('round',    RGB, b, XY, W              <,LineWidth>)
%    DRAW('square',   RGB, b, XY, W              <,LineWidth>)
%    DRAW('cross',    RGB, b, XY, W              <,LineWidth>)
%    DRAW('rect',     RGB, b, XY, WH             <,LineWidth>)
%    DRAW('oval',     RGB, b, XY, WH             <,LineWidth>)
%    DRAW('rect',     RGB, b,     XYXY           <,LineWidth>)
%    DRAW('oval',     RGB, b,     XYXY           <,LineWidth>)
%
%    DRAW('polygon',  RGB, b,     XYXYXY         <,LineWidth>)
%    DRAW('polygon',  RGB, b, XY, XYXYXY <,Theta><,LineWidth>)
%    DRAW('polygonN', RGB, b, XY, D,       Theta <,LineWidth>)  replace "N" by # of sides (e.g.: 'polygon6' = hexagon)
%    DRAW('polygonN', RGB, b, XY, WH,      Theta <,LineWidth>)  <todo>
%
%    DRAW('triangle', ...)                                     is the same as DRAW('polygon3',...)
%    DRAW('arrow',    RGB, b, XY, WH,      Theta <,LineWidth>)  <todo>
%
%    DRAW('dots',     RGB, b, XY, W                          )  <todo>
%    DRAW('dots',     RGB, b, xy, B, W   <,Theta>            )  <todo> B is a logical matrix, and will be drawn centered at xy.
% 
%    DRAW('line',     RGB, b, XY0, XY1           <,LineWidth>)
%    DRAW('line',     RGB, b,     XYXY           <,LineWidth>)
%    DRAW('line',  RGBRGB, b, XY0, XY1           <,LineWidth>)  PTB only.  <todo>
%    DRAW('line',  RGBRGB, b,     XYXY           <,LineWidth>)  PTB only.  <todo>
%
%    DRAW('matrix', M, <RGB,> b, XY <,Theta>)  <todo>
%
% Examples: Six different ways to draw a 60x60 pixels red square. (Use displaybuffer(0); to display the result.)
%       draw('square', [1 0 0], 0, [0 0], 60);
%       draw('rect', [1 0 0], 0, [0 0], [60 60]);
%       draw('rect', [1 0 0], 0, [-30 30, 30 -30]);
%       draw('polygon', [1 0 0], 0, [-30 30, 30 30, 30 -30, -30 -30]);
%       draw('polygon4', [1 0 0], 0, [0 0], 60*sqrt(2), 0); % 60*sqrt(2) is the diameter of the circumscribing circle
%       draw('polygon4', [1 0 0], 0, [0 0], [60 60], 0);
%
% See also DRAWTEXT.
%
% Ben,  Oct 2007 - Jun 2010.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% DRAWCROSS   Draw cross(es) in offscreen buffer.
%    DRAWCROSS(b,XY,W,RGB)
%
%    DRAWCROSS(b,XY,W,RGB,LineWidth)
%
% Ben, Sept. 2008
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% DRAWLINE  Draw line(s) in offscreen buffer.
%    DRAWLINE(b,XY0,XY1,RGB <,LineWidth>)  draws line(s) from start point(s) 
%    XY0 to end point(s) XY1. XY0 and XY1 are N-by-2 matrices of cartesian co-
%    ordinates (in pixels), where N is the number of lines to draw. RGB can 
%    either be a  1-by-3 triplet (all lines have the same colors) or a N-by-3 
%    matrix (one row per line to draw). The optional argument LineWidth is the 
%    line width in pixels.
%
%    DRAWLINE(b,XYXY,RGB <,LineWidth>)  does the same. This syntax is similar to 
%    that of DRAWRECT (see).
%
% PTB only:
%    DRAWLINE(b,XY0,XY1,RGB0,RGB1 <,LineWidth>)  or,
%    DRAWLINE(b,XYXY,RGB0,RGB1 <,LineWidth>)  draws line(s) with color(s) RGB0 
%    for the start points and RGB1 for the end points. Color will be interpolated
%    between start and end points. This is available only if PYB is the graphics 
%    library.
%
% Ben, 	May 2008	
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% DRAWPHOTODIODESQUARE  Draw square in screen corner for photodiode.
%    DRAWPHOTODIODESQUARE(b)  
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% DRAWPOLYGON  Draw regular/irregular polygon(s) in offscreen buffer.
%    DRAWPOLYGON(N,Theta,b,XY,D,RGB)  draws a regular polygon of N vertices and of orientation Theta
%    in buffer b, circumscribed in a circle of diameter D centered at XY. Theta is an angle in
%    clockwise degrees. At the origin (Theta=0), the polygon rests on it's basis.
%
%                    ___________
%                   /          /\
%                  /          /  \
%                 /       D /     \
%                /         /       \
%                \        °(x,y)   /
%                 \     /         /
%                  \   /         /
%                   \/__________/
%                    
%
%    DRAWPOLYGON(N,Theta,b,XY,WH,RGB)  <todo ???>
%
%                    ___________
%                   /     |     \
%                  /      |      \
%                 /      H|       \                  /|\
%                /________|________\               /  |  \
%                \    W   |(x,y)   /             /   H|    \
%                 \       |       /            /______|______\
%                  \      |      /                    W
%                   \_____|_____/
%                  
%
%    DRAWPOLYGON(b,XYXYXY,RGB)  draws an arbitrary polygon with vertices at coord. given by the
%    XYXYXY vector. XYXYXY has the form [x1,y1,x2,y2,...xN,yN].
%
%    DRAWPOLYGON(b,XY,XYXYXY,RGB)  draws an arbitrary polygon "centered" at XY. XYXYXY are now 
%    relative coordinates: they have XY as origin. <TODO!>
%
% Ben, Mar. 2009
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% DRAWRECT  Draw rectangle(s) in offscreen buffer.
%    Note: This function is intended to be as general as possible. To draw easily
%    small target(s), see DRAWSQUARE.
%
%    DRAWRECT(b,XY,WH,RGB)  draws in buffer b N rectangle(s), centered 
%    at x, y coordinates given by N-by-2 matrix 'XY', of width(s) and heigth(s) 
%    given by matrix 'WH', and of color(s) given by matrix 'RGB'. 'W' and 'RGB' 
%    can either have 1 row if rectangles share the same width/color or N rows   
%    if width/color has to be specified for each one.
%
%    DRAWRECT(b,XYXY,RGB)  fills N rectangular area(s) defined by N-by-4 matrix 
%    of coordinates XYXY. XYXY column order is normally [x0 y0 x1 y1] (lower-
%    left corner, upper-right corner).
%
%    Alternatively, XYXY column order can be [x0 y1 x1 y0] (upper-left corner, 
%    lower-right corner). The former order was more intuitive if you think in 
%    Cartesian x,y coordinates; the latter can be convenient if you are used to 
%    the conventional graphics i,j coordinates (origin at the upper-left, downward 
%    vertical axis --like for matrix coordinates). (PTB functions use such i,j 
%    coordinates for the "rect" argument.) Note that independently of the column  
%    order, we always use Cartesian coordinates (origin at the center, upward Y 
%    axis). <todo: suppress this ?>
%
%    DRAWRECT(b,XYXY,'XY',RGB)  is the same than above. <todo>
%    DRAWRECT(b,IJIJ,'IJ',RGB)  <todo>
%
%    DRAWRECT(b,XY,WH,RGB,LineWidth)  or,
%    DRAWRECT(b,XYXY,RGB,LineWidth)  draws hollow rectangular frame(s). LineWidth  
%    specify the thickness of the line in pixels. Similarly to W and RGB, it can   
%    be a scalar or a N-by-1 matrix.  If LineWidth is 0, draws a filled rect, as 
%    by default.
%
% See also DRAWSQUARE, DRAWROUND, DRAWOVAL, DRAWLINE, DRAWTEXT.
%
% Ben, Sept. 2008
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% DRAWROUND  Draw round(s) in offscreen buffer.
%    DRAWROUND(b,XY,D,RGB)  draws round(s) in buffer b. XY is a N-by-2 matrix 
%    of coordinates (in pixels), where N is the number of rounds to draw. D is  
%    the diameter of the round(s). If there are more than one round, D can either  
%    be a scalar (all rounds share the same width) or a N-by-1 matrix (different  
%    widths for each rounds). RGB specify color (red-green-blue, in the range 0.0 
%    to 1.0). Similarly to D, if there are more than one round, RGB can either 
%    be a scalar or a N-by-3 matrix.
%
%    DRAWROUND(b,XY,D,RGB,LineWidth)  draws hollow circle(s). LineWidth specify 
%    the thickness of the line in pixels. Similarly to D and RGB, it can be a  
%    scalar or a N-by-1 matrix. If LineWidth is 0, draws a filled shape, as by 
%    default.
%
% Examples:
%    drawround(0,[-100 200],10,[1 0 0])  % draws (in the backbuffer, or buffer 0)  
%    %   a 10 pixels width red round at coord. x=-100, y=200 (pixels).
%
%    drawround(0,[-100 0; 100 0] ],10,[1 0 0; 0 0 1])  % draws two rounds: a red
%    %   round at x=-100, and a blue round at x=100. Both rounds have a width of 
%    %   10 pixels.
%
% See also DRAWSQUARE, DRAWOVAL.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% DRAWSHAPE  Primitive drawing function, used by other DRAW* functions.
%    This function is used by all DRAW* functions, except DRAWTEXT.  See each particular function to
%    get help.  DRAWSHAPE by itself can be usefull to be useed it directly if the shape itself is 
%    variable.
%
%    DRAWSHAPE('rect'|'oval'|'cross', b, XY, W|WH, RGB <,LineWidth>)
%    DRAWSHAPE('rect'|'oval',         b, XYXY,     RGB <,LineWidth>)
%
%    DRAWSHAPE('polygon',           b,     XYXYXY, RGB <,LineWidth>)
%    DRAWSHAPE('polygon',           b, XY, XYXYXY, RGB <,LineWidth>)
%    DRAWSHAPE({'polygon',N,Theta}, b, XY, D,      RGB <,LineWidth>)
%    DRAWSHAPE({'polygon',N,Theta}, b, XY, WH,     RGB <,LineWidth>)  <todo>
%
%    DRAWSHAPE('line', b, XY0, XY1, RGB <,LineWidth>)
%    DRAWSHAPE('line', b, XYXY, RGB <,LineWidth>)
%    DRAWSHAPE('line', b, XY0, XY1, RGB0, RGB1, <,LineWidth>)  PTB only.
%    DRAWSHAPE('line', b, XYXY, RGB0, RGB1, <,LineWidth>)      PTB only.
%
%    DRAWSHAPE('binarymatrix', b, M, XY, RGB)  <todo: unfinished>
%
% See also DRAWSQUARE, DRAWRECT, DRAWROUND, DRAWOVAL, DRAWPOLYGON, DRAWLINE, DRAWCROSS.
%
% Ben,  Oct 2007.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% DRAWSQUARE  Draw square(s) in offscreen buffer.
%    DRAWSQUARE(b,XY,W,RGB)  draws square(s) in buffer b. XY is a N-by-2 matrix 
%    of coordinates (in pixels), where N is the number of squares to draw. W specify 
%    the width (diameter) of the square(s). If there are more than one square, W can  
%    either be a scalar (all squares share the same width) or a N-by-1 matrix   
%    (different widths for each squares). RGB specify color (red-green-blue, in the 
%    range  0 to 1). Similarly to W, if there are more than one square, RGB can 
%    either be a scalar or a N-by-3 matrix.
%
%    DRAWSQUARE(b,XY,W,RGB,LineWidth)  draws hollow frames(s). LineWidth specify 
%    the thickness of the line, in pixels. Similarly to W and RGB it can be a scalar
%    or a N-by-1 matrix. If LineWidth is 0, draws a filled square, as by default.
%
% Examples:
%    drawsquare(0,[-100 200],10,[1 0 0])  % draws (in the backbuffer, or buffer 0)  
%    %   a 10 pixels width red square at coord. x=-100, y=200 (pixels).
%
%    drawsquare(0,[-100 0; 100 0] ],10,[1 0 0; 0 0 1])  % draws two squares: a red
%    %   square at x=-100, and a blue square at x=100. Both squares have a width of 
%    %   10 pixels.
%
% See also DRAWROUND, DRAWRECT.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% DRAWTARGET  Draw a target during a trial and record it's co-ordinates.
%    DRAWTARGET(targetNum,shape,rgb,b,xy,w|wh)  records all parameters to be saved by SAVETRIALS. The trial 
%    must have been first initialized with STARTTRIAL. targetNum is the target's number. b must always be 0.
%    DRAWTARGET is a wrapper for DRAW. See DRAW for mor informations about other arguments arguments.  
%
%    Note bout buffers: DRAWTARGET draws always on buffer 0 (backbuffer). It's not possible to draw
%    on an other offscreen buffer, because DRAWTARGET is intended to be used *just before* the 
%    display.
%
% Example:
%    startpsych(0,[800 150],[.5 .5 .5]);
%    nTrials = 3;
%    x = -200:2:200;
%    y = 0;
%    for n = 1 : nTrials
%        starttrial;
%        for f = 1 : length(x)
%            drawtarget('round', 'target1', [x(f) y], 10, [1 0 0]);
%            displaybuffer(0,getframedur);
%        end
%        stoptrial;
%    end
%    savetrials('my-file.mat');
%
% See also STARTTRIAL, STOPTRIAL, SAVETRIALS.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% DRAWTEXT  Draw text in an offscreen buffer.
%    Warning: This function takes several msec to execute. This can be an issue
%    on a slow computer.
%
%    DRAWTEXT(Text,b)  draws character string Text in the center of buffer b.
%
%    DRAWTEXT(Text)  Same as DRAWTEXT(Text,0)
%
%    DRAWTEXT(Text,b,option1,option2,...)  specifies text options.
%       Options can be:
%       - Text Position:    an [x y] vector.
%       - Font Name:        'Arial', 'Courier', etc.
%       - Font Size:        value in points.
%       - Font color:       an [r g b] vector.
%       Order of options doesn't matter.
%
% Examples :
%    drawtext('Pause',4);  % draws the string 'Pause' in the center of buffer 4.
%    drawtext('+',b,20,[0 0 1]);  % draws a blue '+', 20 points heigth, in the center 
%                                 % of buffer b.
%    drawtext('Hello!',0,[0 200],'Courier',30,[.2 .2 .2]);
%
% Ben, Oct. 2007
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% DRAWPOLYGON  Draw regular/irregular polygon(s) in offscreen buffer.
%    DRAWPOLYGON(N,Theta,b,XY,R,RGB)  draws a regular polygon of N vertices and of orientation Theta
%    (clockwise deg) in buffer b at coordinates 
%
%    
%
%    DRAWPOLYGON(b,XYXYXY,RGB)
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% EDGV  Edit GLABVERSION.M at the current line.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% EDITGLABVERSION  Edit GLABVERSION.M at the current line.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% FILTERBUFFER  Filter an offscreen buffer. <PTB only>
% bf = filterbuffer(b,kernel)  filters buffer b, applying kernel. All the job
%    is done by the GPU. 
%
%    'kernel' is a simple m-by-n matrix of floating point numbers with m and
%    n being odd numbers, e.g., 1x1, 3x3, 5x5, 7x7, 9x9,..., 1x3, 1x9, 7x1 ...
%    Each entry in the kernel matrix is used as a weight factor for the
%    convolution.
%  
%    The simplest way to get a 2D kernel is to use the function
%    kernel = fspecial(...); fspecial is part of the Matlab image
%    processing toolbox, see "help fspecial" for more information.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% FINDMISSEDFRAMES
%    Errors = FINDMISSEDFRAMES(MeasuredTimes)
%
%    Errors = FINDMISSEDFRAMES(MeasuredTimes,TheorIntervals,FrameDuration)
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% FITHSV  Fit values in a HSV image matrix within the [0,1] range.
%    I = FITHSV(I)  The hue is be cyclically reduced (e.g.: 1.3 becomes 0.3);
%       the saturation and value are cutted above 1 and under 0.
%    I = FITHSV(I,'cut')  is the same as above.
%    I = FITHSV(I,'rescale')  The saturation and value are rescaled to fit
%       the [0,1] range. Same as above for the hue.
%
% See also FITRGB, FITRANGE.
%
% Ben,	Nov. 2007.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% FITRGB  Fit pixel values within the [0,1] range.
%    I = FITRGB(I)  or  I = FITRGB(I,'cut')  cuts the values in the double matrix 'I'
%       under 0 and above 1
%    I = FITRGB(I,'rescale')  rescales values to fit range.
%
% See also: FITHSV, FITRANGE
%
% Ben,	Nov. 2007.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% FRAMESEQ  Prepare input variables for DISPLAYFRAMESEQ.
%    General syntax:
%       S = FRAMESEQ(What,...,Movement,... <,'-option1',...> <,'-option2',...>
%
%    What:
%       FRAMESEQ('',Duration)  displays nothing for Duration in milliseconds.
%
%       FRAMESEQ(Shape,Color,Size,...)
%       FRAMESEQ(Shape,Color,Size,LineWidth,...) <TODO: orientation>
%
%       FRAMESEQ('buffer',b,...)
%
%       FRAMESEQ('text',string,<FontName>,Size,Color,...)
%
%    Movement: (If you don't find what you which, see the 'custom' movement at the end)
%       FRAMESEQ(...,'fix',[x y],Duration)
%       FRAMESEQ(...,'fix',xyCenter,Rho,Theta,Duration) <todo>
%
%       FRAMESEQ(...,'step',[xstep ystep]) <TODO: coord abs or rel ?> <ans: rel, otherwise it's a fix>
%
%       FRAMESEQ('gap',Duration)  is the same that  FRAMESEQ('',Duration).
%
%       FRAMESEQ(...,'rampe',[x1 y1],Duration,[] ,[]   )  or,
%       FRAMESEQ(...,'rampe',[x1 y1],[]      ,Vel,[]   )  or,
%       FRAMESEQ(...,'rampe',[]     ,Duration,Vel,Alpha)  prepares a rampe from
%       the point x0, y0 to the point x1, y1, of duration 'Duration' (msec), at velocity 'Vel' and of 
%       orientation 'Alpha' (deg). Movement parameters which have to be computed are replaced by [].
%       [x0 y0] is never given as input argument: they are the co-ordinates of the last point of the 
%       previous movement (e.g.: a fixation or a step). See the drawing below to understand why.  
%
%               X ^
%                 |
%             x1 -|                             o  o  o  o  o  o
%                 |                          o
%                 |                       o
%                 |                    o
%                 |                 o
%             x0 -|  o  o  o  o  o
%                 '- |-----------|  |-----------|  |-----------|  ---> time
%                    t0   fix    t1 t0  rampe   t1 t0   fix    t1
%
%       FRAMESEQ(...,'arc',xyCenter,Rho,Theta1,Duration,[]    ,[]     )  or,  <todo>
%       FRAMESEQ(...,'arc',xyCenter,Rho,Theta1,[]      ,AngVel,VelSign)  or,  <todo>
%       FRAMESEQ(...,'arc',xyCenter,Rho,[]    ,Duration,AngVel,VelSign)       <todo>
%
%       FRAMESEQ( ... ,Shape,Size,Color,'continue',...)  x0 and y0 are the last x and y
%       values of the last call to FRAMESEQ. <???>
%
%       FRAMESEQ(...,'custom:xxx',xvect,yvect)
%
% Options:
%  - Tolerance Window:
%    FRAMESEQ(...,'-tolwin',GraceDuration,WinSize)  defines a tolerance window, appearing
%    after GraceDuration ms, of size given by the [width heigth] vector WinSize.
%
%  - Sound:
%    FRAMESEQ(...,'-sound',b,Delay)  associates a sound with the target. The sound  
%    previously stored in audio-buffer #b (by STORESOUND, STORETUUT or a similar STORE* function) 
%    will be  played Delay ms after the onset of the first frame. Delay will be rounded to an   
%    integer number of frames.
%
% Output:
%    The output S is a structure array (one structure per frame) containing the fields:
%           S.mov       Movement ('', 'fix', 'rampe', etc.)
%           S.what      'round', 'square', 'buffer', 'text', etc
%           S.size      Target width, or [width height], or relative coord for a arbitrary polygon
%           S.color     [r g b] or [r g b alpha] vector (values from 0.0 to 1.0)
%           S.x         x position (pixel)
%           S.y         y position (pixel)
%           S.option.tolwin    Tolerance window [width height] ([0 0] if no window)
%           S.option.sound     IDs of audio-buffers to be played (0 if none)
%
% Example: The incredible rashbass of the green point !!!
%    % Init display
%    startcogent % initializes Cogent display with default settings. Use startpsych to init psychToolbx display
%
%    % Get structures for each movement:
%    size = 10;
%    rgb = [1 0 0]; % MUST contain red for PSB !!!
%    fix1  = frameseq('round',rgb,size,'fix',[-200 0],1000,'-tolwin',250,[100 100]);
%    gap   = frameseq('',500);
%    rampe = frameseq('round',rgb,size,'rampe',[200 0],2000,[],[],'-tolwin',250,[200 100],'-sound',1,0);
%    fix2  = frameseq('round',rgb,size,'fix',[200 0],1000,'-tolwin',0,[100 100]);
%
%    % Concatenate structures:
%    target = [fix1 gap rampe fix2];
%
%    % Display trial
%    displayframeseq(target);
%
% See also DISPLAYFRAMESEQ.
%
% Ben,  Jun 2010.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GAMMACOMPRESS  Undo gamma correction on a matrix.
%    M = GAMMACOMPRESS(M,gamma)
%    C = GAMMACOMPRESS(C,gamma)
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GAMMAEXPAND  Apply gamma correction on a matrix.
%    M = GAMMAEXPAND(M,gamma)
%    C = GAMMAEXPAND(C,gamma)
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GBB   Get Blank Buffer.
%	 b = GBB  returns the handle of the blank buffer. The blank buffer  
%    is automatically created at startup by G-Lab.
%
% See also GCB.
%
% Ben, Feb 2009
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GCB   Get Current Buffer.
%	 b = GCB  returns the handle of the current offscreen buffer, i.e.: the
%    last buffer either created by NEWBUFFER or selected by SELECTBUFFER.
%
% See also GBB, GCW, NEWBUFFER, SELECTBUFFER.
%
% Ben, Sept 2007
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GCW   Get current PTB onscreen window handle. (For PTB only).
%    h = GCW  returns handle of PTB open onscreen window.
%
%    Currently multiple displays are not supported.
%
% See also GCB.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETKEYNUMBER   Get key number, numbers if more than one key, corresponding to a key name.
%    GETKEYNUMBER  by itself, waits for a key press and displays the key number(s). <TODO>
%
%    keyNumbers = GETKEYNUMBER(keyNumber|keyName|keyCode)  returns key(s) numbers in the n-by-2
%    matrix keyNumbers. Missing values are replaced by 0s.
%
%    keyNumbers = GETKEYNUMBER(keyName,lib)  returns number for specified library ('PTB' or 'Cog').
%
%    keyNumbers = GETKEYNUMBER(keyNumber,'cog2ptb')  converts Cogent key number to PTB key number.
%    keyNumbers = GETKEYNUMBER(keyNumber,'ptb2cog')  converts PTB key number to Cogent key number.
%    If the keyNumber argument is a key name or a key code instead of a number, 'cog2ptb' is the  
%    than 'PTB' and 'ptb2cog' is the same than 'Cog'.
%
%    Programmer note: Identifying code/number is dependent of the underlying library (PTB
%    or Cogent) used for keyboard. Unless the library is explicitely specified the function  
%    returns code/number for the current keyboard library. (See GETLIBRARY('Keyboard').)
%
% See also: GETKEYCODE, GETKEYNAME.
%
% Ben, Feb. 2009
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETBEAMPOSITION  <alpha stage>
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETBELGIANMAP  Key IDs for a belgian AZERTY keyboard.
%    map = GETBELGIANMAP  returns a structure containing key IDs. Structure
%       fields correspond to key names and field values are key IDs.
%
%   GETBELGIANMAP ?  displays geographical help.
%
% See also GETKEYNUMBER, GETKEYCODE, GETKEYNAME.
%
% Ben, March 2008.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETDRAW  Get drawing settings.
%    Settings = GETDRAW  returns all setting values in a structure.
%
%    Value = GETDRAW(SettingName)  returns value of given setting.
%    Valid setting names are: 'PixelScale', 'DrawColor', 'BackgroundColor', 
%    ('TransparencyColor'), 'LineWidth', 'FontName', 'FontSize'.
%
%    [Value1,Value2,...] = GETDRAW(SettingName1,SettingName2,...)
%
% Ben, apr. 2008.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETFRAMEDUR  Get the duration of one screen frame.
%    D = GETFRAMEDUR  returns the frame duration in milliseconds, as it had been measured at
%    first GLab startup. GLab must have been started at least once for this to work.
%
%    D = GETFRAMEDUR('nominal')  returns the frame duration deduced from the nominal frequency
%    reported by the computer's video driver. This will work even if GLab has never been started.
%
%    D = GETFRAMEDUR('requested')  returns the theoretical frame duration, computed from the
%    screen frequency which was wich was given as input argument to startglab/startcogent/startpsych.  
%
% See also ONEFRAME, COMPUTESCREENFREQ, GETSCREENFREQ.
%
% Ben, Sept-Nov 2007
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETKEYCODE   Get code identifying a key or a combination of keys.
%    The key code is a logical vector identifying one or several key(s). (As in PTB)
%
%    GETKEYCODE  by itself, waits for a key press and displays the key code. <TODO>
%
%    keyCode = GETKEYCODE(keyName|keyNumber|keyCode)  gets key code
%    from it's name(s), number(s) or code.
%
%    keyCode = GETKEYCODE(keyName|keyNumber|keyCode,lib)  returns code
%    for the specified library ('PTB' or 'Cog').
%
%    Programmer note: Identifying code/number is dependent of the underlying library (PTB
%    or Cogent) used for keyboard. Unless the library is explicitely specified the function
%    returns code for the current keyboard library. (See GETLIBRARY('Keyboard').)
%
%    [keyCode,keyCode2] = GETKEYCODE(...)  returns also code of a second key with the same name  
%    if any. Example: Over Cog library, getkeycode('enter') returns keyNumber=59 (Main "Enter"  
%    key) and keyNumber2=90 (NumPad "Enter" key). If there is no second key, keyCode2 value is 0.
%
%    [keyCode,keyCode2,keyNumber,keyNumber2] = GETKEYCODE(...)  is used by GETKEYNUMBER.
%
% See also: GETKEYNUMBER, GETKEYNAME, GETBELGIANMAP (Cogent only).
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETKEYEVENTS  Get keyboard events since last call to GETKEYEVENT.
%    [Times,IDs,isDown] = GETKEYEVENTS  returns key events since last  
%    call to GETKEYEVENT or READKEYS, then clears the key events stack.
%
%    If you want to peek the keyboard stack without clearing it, use
%    PEEKKEYEVENTS. If you don't want to get past events stored in the 
%    stack, but simply want to get the current keyboard state, use 
%    CHECKKEYDOWN, which checks current down/up status without interfer-
%    ring with the event stack.
%
%    The GETKEYEVENTS function relays on CogInput.mex and is not available 
%    with the PTB. In the case you are using PTB, use CHECKKEYDOWN only. 
%    An implementation of a keyboard stack for the PTB is currently under
%    developpement.
%
% Programmer's Note:
%    This function is an interface to "CogInput('GetEvents',...)".
%    It improves the functionning of the keyboard stack. The limitation of 
%    CogInput is that it cannot read the keyboard queue without clearing it.
%    The new stack is composed by both CogInput's queue and a persistent 
%    variable in getkeyevents, but this is transparent for the programmer
%    CogInput's queue should not be be interrogated directly. (i.e.: by 
%    "CogInput('GetEvents',...)" or a m-function which use it.)
%    <TODO: Rewrite waitkeydown, etc... This not yet done !!!>
%
% Programmer only:
%    GETKEYEVENTS('PEEK') is the same than PEEKKEYEVENTS.
%
% See also PEEKKEYEVENTS, CHECKKEYDOWN.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETKEYNAME   Name of a key
%    GETKEYNAME  waits for a key press, then displays the key name. <TODO>
%
%    GETKEYNAME ?  or GETKEYNAME ALL  displays all key names.
%
%    keyName = GETKEYNAME(keyNumber|keyCode)  gets key name from key code or number.
%
%    keyName = GETKEYNAME(keyNumber|keyCode,lib)  gets name from code/number of the
%    specified library ('PTB' or 'Cog').
%
% See also: GETKEYNUMBER, GETKEYCODE, GETBELGIANMAP (Cogent only).
%
% Ben, Oct. 2007
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETKEYNUMBER   Get identifying number of a key.
%    GETKEYNUMBER  by itself, waits for a key press and displays the key number. <TODO>
%
%    keyNumber = GETKEYNUMBER(keyName|keyCode)  gets key(s) number from it's (their's) name(s) 
%    or code.
%
%    keyNumber = GETKEYNUMBER(keyName,lib)  returns number for specified library ('PTB' or 'Cog').
%
%    keyNumber = GETKEYNUMBER(keyNumber,'cog2ptb')  converts Cogent key number to PTB key number.
%    keyNumber = GETKEYNUMBER(keyNumber,'ptb2cog')  converts PTB key number to Cogent key number.
%    If the keyNumber argument is a key name or a key code instead of a number, 'cog2ptb' is the  
%    than 'PTB' and 'ptb2cog' is the same than 'Cog'.
%
%    Programmer note: Identifying code/number is dependent of the underlying library (PTB
%    or Cogent) used for keyboard. Unless the library is explicitely specified the function  
%    returns code/number for the current keyboard library. (See GETLIBRARY('Keyboard').)
%
%    [keyNumber,keyNumber2] = GETKEYNUMBER(...)  returns also the number of a second key with the   
%    same name if any. Example: Over Cog library, getkeycode('enter') returns keyNumber=59 (Main   
%    "Enter" key) and keyNumber2=90 (NumPad "Enter" key). See also GETALLKEYNUMBERS.
%
% See also: GETALLKEYNUMBERS, GETKEYCODE, GETKEYNAME.
%
% Ben, Feb. 2009
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETLIBRARY   Get name and version of lower-level C libraries in use.
%    GETLIBRARY  displays all current libraries info.
%
%    LIB = GETLIBRARY(MODULE)  returns the name library in use for the given
%    module. Type 'getlibrary' to get module names.
%
%    [LIB,V] = GETLIBRARY(MODULE)  returns library name and version number, in 
%    the form of a [x y] or [x y z] vector.
%
%    V = GETLIBRARY(LIB,'version')  returns version number of library LIB.
%
%    S = GETLIBRARY  returns all library infos in a structure. Usefull to save
%    it.
%
% See also SETLIBRARY, ISCOG, ISPTB.
%    
% Ben, Sept-Oct 2008
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETMOUSE  Get current mouse pointer position and button states.
%    This functions works perfecly with Cogent, However with PsychTB, there are issues 
%    due to incomplete support of the mouse by PTB 3.0.8 on MS-Windows and Linux: 
%    - in windowed display: coord are only correct if you DON'T MOVE THE WINDOW.
%    - in fullscreen display: we have to use a hack (see below) to get correct coord. 
%
%    [x,y] = GETMOUSE  or  xy = GETMOUSE  returns mouse position, in pixels.
%
%    [x,y,isDown] = GETMOUSE  returns also the state of the buttons. 'isDown' is 
%    a 3 element vector of logical values containing a 1 if left/middle/right button,
%    repectively, is down and a 0 if it is not. 
%
% PsychTB only, hack for dual-screen: 
%    For fullscreen display on a dual-monitor PC, use this hack (PTB only):
%    GETMOUSE(ScreenPosition)  ScreenPosition is 'L' (left) or 'R' (right).
%
% Cogent only:
%    [x,y,isDown,wasDown] = GETMOUSE  'wasDown' is similar to 'isDown' but contains  
%    1s if buttons has been down since last call to getmouse. This is not supported 
%    on PTB.
%
% Deprecated syntax:
%    xy = GETMOUSE  is still supported for backward compatibility, but deprecated.
%    Programmer's note: We prefer the [x,y] = GETMOUSE syntax, with is the same than
%    the syntax of PTB's homonymous function 'GetMouse', and is also consistent
%    with the syntax of CG's 'cgmouse'.
%
% Obsolete syntax:
%    [xy,isDown,wasDown] = GETMOUSE  is no more supported.
%    
%
% See also SETMOUSE, WAITMOUSECLICK.
%
% Ben, March 2008.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETPARALLELBYTE  Get parallel port current value.
%    GETPARALLELBYTE  by itself, displays current parallel port value in Command Window.
%
%    [n,t] = GETPARALLELBYTE  returns parallel port current value as an integer n (0 <= n <= 255) 
%    and the the timestamps t.
%
%    [n,t,bits] = GETPARALLELBYTE  returns also current port value as a as a logical vector of bit 
%    values.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETPARALLELPORT  Get parallel port digitalio object.
%    GETPARALLELPORT  displays infos on all open // port.
%
%    DIO = GETPARALLELPORT  returns the digitalio object (see DAQ toolbox documentation) of port
%    open with OPENPARALLELPORT. (If there is more than one, selects last open port.)
%
%    DIO = GETPARALLELPORT(n)  selects LPTn.
%
%    [DIO,S] = GETPARALLELPORT(...)  returns object's properties in structure S. Same as S=get(DIO); 
%   
%    Programmer note: Don't use GETPARALLELPORT syntax inside a function. Use GETPARALLELPORT(n) to
%    avoid unsusefull displays.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETPRIORITY  Get current priority level of the MATLAB thread.
%    PRIORITY = GETPRIORITY  returns current priority level. 
%    See "help setpriority" about priority levels.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETSCREENFREQ  Get the screen refresh frequency.
%    Hz = GETSCREENFREQ  returns screen refresh frequency, as it had been measured at
%    first GLab startup. GLab must have been started at least once for this to work.
%
%    Hz = GETSCREENFREQ('nominal')  returns the nominal frequency as reported by
%    the computer's video driver. This will work even if GLab has never been started.
%
%    Hz = GETSCREENFREQ('requested')  returns the theoretical frequency, wich was 
%    given as input argument to startglab/startcogent/startpsych.
%   
%
% See also COMPUTESCREENFREQ, GETFRAMEDUR.
%
% Ben, Sept-Nov 2007
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETSCREENRES  Get resolution of G-Lab display.
%	 res = GETSCREENRES  returns a vector 'res' of the form [width height].
%    [w,h] = GETSCREENRES returns width and height in two separate variables.
%	 w = GETSCREENRES(1)  returns width.
%	 h = GETSCREENRES(2)  returns height.
%    [X0,Y0,X1,Y1] = GETSCREENRES  returns limits of the X and Y axes.
%		e.g: @800x600, X0 = -400, Y0 = -299, X1 = 399, Y1 = 300.
%
% See also GETSCREENXLIM, GETSCREENYLIM, GETFRAMEDUR.
%
% Ben, Oct 2007
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETSCREENSIZECM  Get screen size in centimeters.
%
%    wh = GETSCREENSIZECM  returns screen size in cm, as given by the OS or as set by SETSCREENSIZECM. 
%    'wh' is an [width heigth] vector.
%
%    [w,h] = GETSCREENSIZECM   returns screen's width and heigth as separate output variables.
%
%    See also SETSCREENSIZECM, GETSCREENRES, GETVIEWINGDISTANCECM.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETSCREENXLIM  Screen min and max X co-ordinates.
%    xx = GETSCREENXLIM
%
%    [xmin,xmax] = GETSCREENXLIM
%
% See also GETSCREENYLIM, GETSCREENRES.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETSCREENYLIM  Screen min and max Y co-ordinates.
%    yy = GETSCREENYLIM
%
%    [ymin,ymax] = GETSCREENYLIM
%
% See also GETSCREENXLIM, GETSCREENRES.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETSERIALBYTES  return values and times of received serial bytes
% <TODO: rewrite doc !!!>
% Description:
%     GETSERIALBYTES reads the values and times of bytes sent to the serial port.
%     Use GETSERIALBYTES to access these values and times.  
%
% Usage:
%   [ value, time, n ] = GETSERIALBYTES( port, bytes )
%
% Arguments:
%     port   - port number
%     bytes  - 
%     value  - array of byte values
%     time   - array of times
%     n      - number of serial bytes
%
% See also:
%     CONFIG_SERIAL, READSERIALBYTES, SENDSERIALBYTES, LOGSERIALBYTES, WAITSERIALBYTE, GETSERIALBYTES
%
% Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETTEXT   Get text current settings.
%    S = GETTEXT  returns text settings (backbuffer) in structure S.
%    For PTB, the settings returned are settings of the backbuffer.
%
%    S = GETTEXT(b)  returns text settings of buffer b. <PTB only. CG: b arg. will be ignored.> 
%
% See also SETTEXT, DRAWTEXT.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETTRIALS  Get all trial data recorded between STARTTRIAL and STOPTRIAL calls.
%    TR = GETTRIALS  returns trials data in vector structure TR (one element per trial).
%
%    TR = GETTRIALS('-raw')  returns raw data, without post-processing. For debug purpose.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETVIEWINGDISTANCECM  Get eye to screen distance.
%    D = GETVIEWINGDISTANCECM  returns eye-screen distance in cm. 
%
%    [D,is57] = GETVIEWINGDISTANCECM  returns also, as second output element, a flag which value   
%    is 1 ("true") if viewing distance is 360/(2*pi) = 57.2958 cm, distance at which 1 cm = 1 deg. 
%
% See also SETVIEWINGDISTANCECM, GETSCREENSIZECM.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GLABGLOBAL  Declare global variables for G-Lab.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GLABHELP  Help for the G-Lab toolbox.
%    GLABHELP  displays list of G-Lab functions. (Actually, it displays
%    the first header line of each m-file.)
%
% Programmer only:
%	 GLABHELP FILENAME  saves full help of all m-files in a file. (Concaten-
%    ates full headers.)  Used by GLABMANUAL.
%
% See also GLABMANUAL.
%
% Ben.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GLABCHECK  Check GLab status.
%    GLABCHECK ISDISPLAY  issues an error if no open display.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% CHECKERRORS  Error check and error message display.
%    CHECKERRORS(CallingFun,'missedframes',FramesMissed,Tolerance,<isIsochronous>)
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% HELPER_DISPEVENT  GLab helper function: Display Event message, with time in ms.
%    HELPER_DISPEVENT -INIT  inits function ; used by starttrials.
%
%    HELPER_DISPEVENT(MFILENAME,Str,Time)
%
%    HELPER_DISPEVENT(MFILENAME,Str,Time,ExpectedInterval)
%
% Ben,  Jun 2010.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% glabhelper_perframeevents  Helper function for DISPLAYBUFFER and WAITFRAME.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GLABHELPER_PROCESSTRIALS  Post-processing on trials data. Used by GETTRIALS.
% TR = GLABHELPER_PROCESSTRIALS(TR)
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GLABLOG  GraphicsLab's temporary for temporary files. <TODO: Not yet always used!>
%    GLABLOG  returns path of the tmp folder.
%
% See also: GLABROOT, GLABTMP.
%
% Ben,  Jun 2010.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GLABMANUAL  Generate and edit a file with full G-Lab documentation.
%
% See also GLABHELP.
%
% Ben, March 2008.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GLABREPLACE  Replace expression in GLab M-files.
%     GLABREPLACE(exp0,exp1)  replaces exp0 by exp1 in all GLab M-files, 
%     with the exception of glabversion.m.
%
% Ben, Oct 2009.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GLABROOT  G-Lab's root directory.
%    pathname = GLABROOT
% 
% See also GLABTMP.
%
% Ben,	Nov. 2007.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GLABTMP  GraphicsLab's temporary for temporary files. <TODO: Not yet always used!>
%    GLABTMP  returns path of the tmp folder.
%
% See also: GLABROOT, GLABLOG.
%
% Ben,  Jun 2010.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GLABVERSION  G-Lab version number, and version infos.
%
%                _______________________________________________
%               |                                               |
%               |                  G - L  A  B                  |
%               |              Graphics Laboratory              |
%               |_______________________________________________|
%
%
% 1.0   19/11/2007  First exp. Bruno
% -----
% 1.1   29/11       Exp. Joystick Michael. Create this function (COGENTVERSION).
% -----
% 1.2   11/12		Exp. HalfFaces (Bruno) <bug!: startcogent crashes at 2d call>
% 1.2.1 08/01/2008	startcogent: see file. Add logstring.m for Cogent2000 compatibility.  
% 1.2.2 24/01		startcogent: isFullScreen -> Screen.
% -----
% 1.3   30/01		Exp. Arnaud/Emeline. 
%                   SOUND: opensound, storesound, storetuut.
%					SERIAL: openserialport, closeserialport. 
%					PARALLEL: No more open in startcogent. <!!! Incompatible with v1.2 !!!>
% 					PATH: startcogent sets path at startup. Needs delpath & getsubdirlist (Bentools)
%					Version: startcogent: disp. version ; cogentversion: check version.
% 1.3.1  04/03		loadimage: give directory as argument. 'Grayscale' mode
% 1.3.2  05/03		KEYBOARD: Fix readkey (Cogent2000): suppr. log in file & display in Command window.
%					startcogent: Disp. "Type 'cogenthelp'..." ; Check screen resolution.
%					loadimage: Fix Grayscale mode: use rgb2gray.
% -----
% 1.4    10/03		Exp. Arnaud/Emeline (2d part; changed to fix logkey bug -- see v1.3.2)
%					HELP: cogentdoc, modif. cogenthelp, startcogent: create cogentdoc.txt.
%						Suppr. unused m-files, or rename to m~. Some doc. fixes.
%					startcogent: Define global var. in workspace. (to ensure they'll be saved).
%					Fix COGENT_MESURED_SCREEN_FREQUENCY --> *_MEASURED_*
% 1.4.1  11/03		KEYBOARD: getkeymap, key; readkeys: v2.0 is to slow, v1.0.1: change doc.
% -----
% 1.5    01/04!		SCREEN FREQUENCY: Display warning/error inside Cogent; Check for config. changes;
%                   Check for synchronization problems (fix mirror display in EEG lab).
%                   OPENDISPLAY, OPENKEYBOARD <bug, fixed 16/04>.
%					NO DISPLAY MODE: startcogent none; Suppr. cogent.display field (!).
%                   displaymessage, displaywarning, displayerror.
%                   starttime.
%                   stopcogent: clean.
%                   MOUSE: setmouse, getmouse ; fix waitmouseclick ; startcogent: remove mouse init.
%                   setdraw
%					clearbuffer: fix pen color bug.
%                   Path check: rewrite totally. delpath 2.0.
% 1.5.0.1 03/04		Delete putimage & checkscreenfreq (both obsoletes).
% 1.5.1	  16/04		Fix openkeyboard. cdcog. time(0). config_sound -> Replaced.
%					<TODO: Verify measurescreenfreq !!!>
% 1.5.2   21/05		Add "<cogentroot>\Cogent2000\Obsolete-Replaced" to path for backward compatibility.
% 1.5.3   22/05		<MAJOR BUG !!! See 1.5.5>
%					Add "<cogentroot>\PsychToolBox" to path.
%					WAIT: 'wait' function uses PsychToolBox' WaitSec (no buzzy wait).
%					KEYBOARD: getkeyevents, peekkeyevents, clearkeyevents, waitkeysequence ; key: support cell
% 1.5.4   30/05		displaybuffer: Suppr. 'dontclear' option did not work.
%                   drawline: new function. drawshape: clean. drawsquare: cosmetic.
%					setdraw: new function ; getdraw: modif. getscreenres: add "[x0,y0,x1,y1] = getscreenres" syntax.
% 1.5.5   02/07		MAJOR FIX !!! (from 1.5.3) Fix times in displaybuffer().
% 1.5.6   17/09		"Cogent*\Legacy" folder.
%                   startcogent: Default first arg. = 0
%					'storeimage' --> 'drawimage' (+ Legacy\storeimage) <reverted in 2.0-alpha1>
%                   DRAW: drawsquare --> drawsquare + drawrect
% 1.5.7   25/09		New files: setupcogent, drawcross
%					Modif. files: drawline
%					setupcogent: backport from v2-alpha (with modif.!).
%					drawcross, drawline: Fix line width.
% -----
% 1.6     25/09		COGENT2000 v1.25 -> 1.28 / COGENTGRAPHICS v1.24 -> 1.28.
% 					New fun: setlibrary, getlibrary. Modif fun: setupcogent. Path has totaly changed.
%					KEYBOARD: Use PTB functions (KbCheck, Screen).
%					New fun: checkkeydown.
%					ALPHA BLENDING: <Performance issue: TO SLOW!> Modif fun: copybuffer.
%					draw* functions: syntax revisions.
%                   stopcogent: suppress log closing (obsolete).
%                   getframedur: fix "getframedur('r')".
%                   Gamma: Include in toolbox, in Lib\Gamma.
% 1.6.1   30/09     FIX INSTALL & LIBRARY CHOICES. FIX COGENT 1.28. FIX VISTA!
%                   Fix 1.28: 
%                   - startcogent: openkeyboard after opendisplay.
%                   - setlibrary, openkeyboard: Suppr. change lib from Cog-1.28 to PTB (bug was specific to Cheops).
%                   - setupcogent: Always use m-files of 1.25.
%                   Fix MATLAB 7.5:
%                   - setupcogent: path2rc -> savepath.
%                   Fix case PTB not installed: Standalone use of keyboard (but not Screen!):
%                   - setupcogent: Fix Lib\PTB path.
%                   - Lib\PTB: Add KbName, Is*, streq ; Remove Screen.*.
%                   Fix install:
%                   - setupcogent: setupcogent(vstr) ; Check bentools is in path, add it if possible ; 
%                     Disp cogent version ; setupcogent.m v1.6.1 == setupcogent.m v2-alpha-3.
%                   DRAW*: Finalise syntax and documentation. <to be continued in 1.6.2>
%                   - Modif fun: drawround, drawsquare, drawrect, drawshape, drawline, getdraw, setdraw.
%                   - drawshape: Add 'Line' shape ; Systematic use of getdraw/setdraw.
%                   - drawround/drawshape: Fix hollow circle draw.
%                   Fix. startup: opendisplay: don't display 3 freq.
% 1.6.1.1           Minor doc. fixes. <bug: 4 digit version # not supported!>
% 1.6.2    03/10    PRIORITY FIX: Priority was raised by startcogent after opendisplay
%                                 ==> display testing was made at normal priority.
%                   - setpriority: Add 'OPTIMAL' priority.
%                   - getpriority: New fun. (+ New global var.)
%                   - opendisplay: raise priority to "optimal".
%                   - opensound: lower priority to "normal". (Modif fun: stopcogent)
%                   Fix startup:
%                   - Fix setupcogent: cd to work; setupcogent.m v1.6.2 == setupcogent.m v2-alpha-4
%                   - startcogent: Fix command syntax ; Fix display infos at the end.
%                   Fix cogenthelp.
%                   Change fun names: 
%                   - cogentdoc -> cogentmanual. (Modif fun: cogenthelp)
%                   - waitsynch -> waitsynch + waitbetweendisplays <todo: Chose between the two.>
%                   DRAW*: Fix definitive syntax + doc. ; Draw hollow square/rect frames.
%                   - Modif fun: drawshape, drawsquare, drawrect, drawround.
%                   - drawline: Fix missing LineWidth arg. ; drawshape('Line'): Fix multiple lines.
%                   SOUND: Review.
%                   - Modif fun: opensound, storesound, storetuut.
%                   - Cog2000 -> Cog2007: playsound, waitsound.
%                   - Delete fun: loadsound (now included in storesound), storepuretone.
%======================================================================
% 2.0     18/09		PSYCHTOOLBOX
% 2-alpha0		    From 1.5.6. Backports to 1.5.7. <Abandonned.>
% 2-alpha1          From 1.6.0
%                   New fun: startpsych, gettext, settext
%                   Modif fun: startcogent, setupcogent, setlibrary, opendisplay, stopcogent
%                      and lots of other !!!
%                   Renamed fun: drawimage -> storeimage (revert from 1.5.6).
% 2-alpha2          Hardware test LLN.
%                   New fun: makesinusoid (unfinished), testanimation.
%                   opendisplay: Fix screen # bug. Fix 'DisplayRect'.
%                   displaybufer: PTB: fix time, CG: suppress "floor" <!>
%                   setupcogent: fix: add stopcogent at the beginning.
%                   stopcogent: make it robust to version change.
% 2-alpha3          Port 1.6.1 (exept *draw* files):
%                   - Replaced file/folder (2-alpha2 -> 1.6.1): setupcogent, Lib\PTB
%                   - Modif. files: startcogent, opendisplay, openkeyboard.
% 2-alpha4          Port 1.6.1 (*draw* files):
%                   - Replaced files: drawshape, getdraw, setdraw, drawround, drawsquare, drawrect, drawline.
%                   Port 1.6.2:
%                   - setupcogent.m v1.6.2 == setupcogent.m v2-alpha-4
%                   - Other shared functions: setpriority, getpriority, cogentmanual, cogenthelp,
%                     opensound, storesound, storetuut, playsound, waitsound, waitbetweendisplays.
%                   - Common modif in: startcogent, opendisplay, stopcogent.
%                   DRAW*: Port drawshape on PTB.
%                   - New fun: xy2ij.
%                   - Modif draw* fun from 1.6.2: drawshape, drawline.
%                   - drawshape('BinaryMatrix'): unfinished.
% 2-alpha5          New fun: convertcoord, backgroundalpha, showimage.
%                   Modif fun: copybuffer, drawshape, iscog (returns v2). 
%                   Port fun on PTB: buffersize, waitsynch (!).
%                   Port 1.6.2: getdraw, setdraw <Where forgotten!>
%                   Moved fun: fitrange: From Cogent2007 -> BenTools.
%                   Fix fun: 
%                   - opendisplay: fix isTexture: logical. Fix alpha: now always initialized.
%                   - storeimage: fix cell arg.
%                   - deletebuffer
%                   - chekkeydown: minor fix (fix ';' + fix doc).
%                   - drawtext: See below.
%                   - gettext
%                   - measurescreenfreq: Fix cgflip case ; ...
%                   - clearcogent
%                   Delete files: cgloadlib124.dll, *.asv.
%                   Change global var.: 
%                   - background: Modif files: clearbuffer, cogentglobal displaybuffer getdraw newbuffer opendisplay setbackground setdraw waitscreen
%                   TEXT: Create a draft buffer ; Fix text position
%                   - Modif fun: opendisplay, drawtext, set-text, gettext.
%                   - Fix FonColor setting (alpha value was missing).
%                   FIX COGENT, STARTGLAB: 
%                   - startglab: New fun
%                   - startcogent: Fixed. Now only a wrapper for startglab.
%                   TIME/WAIT: <MAJOR FIXES!!!> <todo: backport maj fix on 1.6.3>
%                   - waitsynch, time, wait: Port on PTB.
%                   - waitsynch: Fix use global var. to know time of last display. <MAJOR FIX!>
%                   - waitsynch(t,unit)
%                   - waitframe: Cog2000 -> Cog2007.
%                   - Suppr. waitbetweendisplays
%                   - setlibrary: Suppr. 'Time' module. Time use now main lib for consistency.
%                   MEASURE FREQ.: <MAJOR FIX.!>
%                   - opendisplay: Recompute freq. if screen changes. <MAJOR FIX!>
%                   - measurescreenfreq: Port on PTB.
% 2-alpha6          measurescreenfreq, opendisplay: <todo: port on 1.6.3>
%                   - Test1: Default NumTestFrames: 300 -> 1000. 
%                   - Test2: Fix.
%                   - Test2-3: Display results.
%                   stopcogent: 
%                   - Make robust in case of startglab crash: Suppr. "if COGENT_IS_RUNNING" test.
%                   - Suppr. COGENT_BUFFERS.Sizes (never used elsewhere).
%                   *buffer: newbuffer: Fix global var ; deletebuffer: Fix multiple buffers.
%                   IMAGE:
%                   - samesize(...,'VH')
%                   - sameluminance: New fun.
%                   - backgroundmask(C)
%                   - scrambleimage: New fun.
%                   stdrgb: New fun.
%                   iscog, isptb: Fix.
%                   displayanimation: Fix doc. ; Fix input Args; setpriority OPTIMAL ; clear at end.
%                   copybuffer: Fix b0, b1 args ; Fix Alpha.
%                   stopcogent -> stopglab. stopcogent moved in Legacy.
%                   displaybuffer: Optimize: add "Screen('DrawingFinished')".
%                   GAMMA: ...
% 2-alpha7          Tests in EEG lab.
% 2-alpha8          sendparallelbyte: fix case port not open.  <todo: port on 1.6.3>
%                   waitsynch: waitsynch(0) ; Fix lib check.
%                   DISPLAYANIMATION:
%                   - Finish doc.
%                   - Rewrite 'Send' option.
%                   - Add 'Draw' option.
%                   - rtdisplay* -> moved to Legacy.
%                   - drawshape: All draw code here. (Code moved from drawcross to drawshape.)
%                   - 'AxesRotation', 'Orientation'
%                   ABORT: Modif. files: displaybuffer, waitframe, displayanimation
%                   openkeyboard: fix: blank -> zeros.
%                   stdrgb, samesize: Fix logicals.
%                   changebackground: New fun.
% 2-alpha9          Tests in EEG lab.
%                   displayanimation: Optim Fix!
%                   stopglab: Fix: close offscreen win/tex first.
% 2-alpha10         startglab: stopglab <- stopcogent
%                   \Legacy: Fix: All files (3) where missing in alpha9 (!?) ; + Add startpsych.
%                   \test: New sub-folder.
%                   backgroundmask:
%                   - Fix: RGBA ; Case bgcolor not given.
%                   - Add internal comments
%                   - Dilate bg
%                   - Fix case of uniform image
%                   samesize: 
%                   - Add syntax:  samesize(...,VH,mn,RoundTo)
%                   - Suppr. syntax:  samesize(I1,I2,...)  For simplicity and consistency with other same*
%                   opendisplay: default # test frames: 1000 -> 800.
%                   sinewave: Change args order <!>: "Duration": 3d arg. -> 1st arg ; Fix case nargin < 4.
%                   buffersize, displayanimation: Fix NaN arg.
% G-LAB ------------
% 2-beta0   12/12   CHANGE NAME !!! COGENT2007 -> GLAB
%                   See beta0_changelog.txt
%                   Fix glabversion: rewrite all. (Fix >3 element version # ; Fix consisteny check.)
%                   setupglab: Modif. setupglab(v). Not backward compatible with older version (!).
%                   Add \Tests dir.
%                   Doc changes: getscreenfreq, iscog, openkeyboard, setlibrary, wait*, opendisplay, open*port.
% 2-beta1           opendisplay: test freq: error -> warning.
%                   startglab, opendisplay: modif display in command window.
%                   sinewave: Fix Slopes.
%                   displayanimation: Splash.
%                   backgroundmask: Change arg order (arg2 <-> arg3).
%                   setgamma: Fix case GLab not started.
% 2-beta2           Beta test EEG + First exp.!!!
%                   displayanimation: Fix // events <major fix!>
%                   setgamma: Fix call before startglab
%                   backgroundmask: Fix color images <major fix!>
%                   convertcoord2: Optim convertcood. 19.6 ms -> 17.5 ms. Usefull?
% 2-beta3           multiplealpha: New fun.
%                   displayanimation: Get Keyboard option.
% 2-beta4 Jan 2009  Fix startcogent/startpsych without args.
%                   loadimage: Fix indexed images (256 colors) <still bug>: New fun: indexed2truecolor.
%                   opendisplay: fix syntax error.
%                   KEYBOARD: 
%                   - Fix opendisplay/openkeyboard chick and egg problem (startglab, openkeyboard, opendisplay, displaymessage).
%                   - Rewrite Cog2000 fun: waitkeydown, waitkeyup.
%                   - Fix: getkeycode.
%                   - New: getkeynumber.
%                   - Doc.: Finish doc. on several keyb. functions.
%                   opendisplay: return err.; fix startglab.
%                   install.txt
% 2-beta5           Fix install.txt: PTB still needed !
%                   displayanimation: Fix "Durations" spelling bug.
%                   Blank Buffer: opendisplay, setbackground, gbb (new fun). <TOD: Revert! clearbuffer(0) is enough.>
%                   setupglab: Fix remove previous versions from path.
%                   loadimage: Fix 2-beta4 (indexed images).
%                   indexed2truecolor: Fix for Matlab 6.5.
% 2-beta5a          Fix openparallelport('in').
% 2-beta6  March    PARALLEL PORT: Multiple ports + Port polling <not finished>.
%                   - Rewrite: openparallelport, closeparallelport, sendparallelbyte.
%                   - New: getparallelport, setparallelport, pollparallelport <not finished>.
%                   drawshape, drawtext: Check b (buffer) exists.
%                   drawshape: Fix current buffer (obsolete global var.)
%                   drawpolygon: New fun + modifs in drawshape.
%                   opendisplay: cosmetic.
%           June    getkeycode([]) returns now keyNumber=[] + fix waitkeydown ; waitkeydown: fix ';' bug.
%                   loadimage: Fix 'grayscale' mode in recursive call.
%                   drawshape: fix polygon on PTB.
%                   displayanimation: 
%                   - Suppr. X, Y input arg no more optional. B can be a scalar.
%                   - XAlign, YAlign optional args.
%                   - 'Scale' option.
%                   - 'Priority' option.
%                   - Fix case no ALPHA or no THETA.
%                   startpsych: <MAJOR FIX!> CogInput v1.28 unstable without CG display: Select PTB as default kb lib.
%                   opendisplay: Lower default # frames for test if windowed.
%                   buffersize: support array as input. <28 Jul: Fix optim pb with NaN.>
%                   setlibrary: - Don't stop glab anymore.
%                               - <!> Fix Cog 1.28 issue: PTB default keyboard library for Matlab 7.5/Cog1.28 <!> <Reverted v2-beta8>
% 2-beta7  July     KEYBOARD: 
%                   - Replace legacy key function by gekeynumber/getkeyname. This fix CogInput crash on Matlab 7.5.
%                     modif. files: displaywarning, displayerror, displaymessage, waitkeysequence, displayanimation.
%                     key: Add warning.
%                   - openkeyboard: - Fix: replace all NaNs by 0s in key # table, because NaNs cannot be converted to logical.
%                                   - Fix 2d key number for keys 16 (Shift) and 17 (Control) in PTB.
%                   - getkeycode: - Change output args: [keyCode,keyNumber] -> [keyCode,keyCode2,keyNumber,keyNumber2]
%                                 - Fix bug when input arg was a cell array.
%                   - getkeynumber: - Change ouput arg.: keyNumber -> [keyNumber,keyNumber2]
%                                   - Case when keyNumber argument is not a number.
%                   - getallkeynumbers: New function.
%                   - getkeyname: Support array as input.
%                   - displaymessage: - Fix bug with Cog as kb lib.
%                                     - Accept also key names & codes as arg. 
%                                     - Suppr. multiple key, to simplify code.
%           Aug     - openkeyboard: - Fix i error in last rows of 'COG' and 'PTB' matrices ; rewrite i update more robustly.
%                                   - Add F1 to F12 keys.
% 2-beta8   Sep/Oct Path: Add /Lib/PTB/PtbReplacement and /Lib/Gama ; modif setupglab  <Change Path!> 
%                   MOUSE: PORT ON PTB
%                   - setmouse, getmouse, waitmouseclick: port on PTB. <TODO: Fix coord on setmouse !!!>
%                   - setmouse, getmouse: Deprecate syntax using 'xy'. <!> <revert that ?>
%                   - PTB functions GetMouse & SetMouse replaced by PtbGetMouse & PtbSetMouse (to fix homonymy pb)
%                   getscreenfreq: Fix case GLab never started; Add 'nominal' option (PTB only. <todo: add CG support>
%                   drawpolygon, drawshape: Add drawpolygon(b,XY,XYXYXY,RGB) syntax, doc. only. <TODO: implement it!>
%                   send//byte: Parallel port not open: error -> warning.
%                   findmissedframes: new fun.
%                   LIB DEFAULTS: <!>
%                   - <!> setlibrary: Default kb lib for Matlab 7.5: Cog  <Revert v2-beta6>
%                   - <!> iscog, isptb: Fix case GLab not started: Default lib is Cog on Windows / PTB on others.
%                   displayanimation v2.2: 
%                   - line 277 remove 'getlibrary' let there for debug purpose.
%                   - 'Isochronous' option. <Bugs. Fixed in beta9>
%                   - <!> FrameErr becomes now a 1xN vector (instead of a scalar).
%                   getkeycode: fix missing ";" line 88
%           14/10   Deployed in CODE with SinStim 1.4 (never used).
% 2-beta9   Oct     PARALLEL PORT:
%                   - Optimization! (See http://psychtoolbox.org/wikka.php?wakka=FaqTTLTrigger) <TODO: test it!>
%                   - getparallelbyte: finish it.
%                   - setparallelbyte: fit range 0-255.
%                   glabreplace: new fun. Doesn't work.
%                   displayanimation: <Fix beta8>
%                   - non-isochronous case was broken.
%                   - fix ischronous mode: "j>N" bug 
%                   - 'FrameErrorEvent' option.
%                   preparesinanimation: 
%                   - use randpattern instead of randele.
%                   - add 'Phases' output arg.
%                   playsound: Suppr. checksound <todo: verif this !>
%                   showbuffers: Rewrite totally. <TODO: Fix waitkeydown on PTB !!!>
%                   drawshape: Fix PTB "draw on buffer other than 0" bug
%                   PHOTODIODE:
%                   - openphotodiode, setphotodiodevalue, closephotodiode: new funs
%                   - displaybuffer <!>, glabglobal, stopglab, displayanimation: modif.
%                   - <todo: auto switch off>
%                   getscreenxlim, getscreenylim: new fun.
%            Nov    displayanimation
%                   - Fix AxesRotation (broken in Oct)
%                   - Fix Scale        (broken in Oct)
%            4 Nov  Used in SinStim 1.5.1 (CODE)
%            5 Nov  Used in pilotess (Sylvie)
%           10 Nov  Used in SinStim 1.5.2 (CODE)
%                   displayanimation: 
%                   - Store all time vars in GLAB_FUNCTIONS.DisplayAnimation
%                   - Workaround "negtimes" bug <uneffective, definitive fix in beta10>
% 2-beta10  Nov     SERIAL PORT:
%                   - sendserialbytes: fix syntax bug
%                   - sendserialbytes: convert arg to double
%                   - openserialport: suppress GLab started condition.
%                   Optimization: replace convertcoord by convertcoord2
%                   stopglab: Add closeeyelink. <reverted>
%                   KEYBOARD:
%                   - Optimize getkeycode. <backported to 2-beta9 in CODE lab>
%                   TIME: <TODO: Rewrite this at the starttrial/displaybuffer/waitsynch/stoptrial level.>
%                   - startglab: Synchronize timers
%                   - displayanimation: Rewrite Workaround "negtimes" bug (v2-beta9/10nov)
%         10 Dec    Used in SinStim 1.6 (CODE)
% 2-beta11  Dec     EYELINK:
%                   - eyelink dir with new *eyelink* funs.
%                   - setupglab: Add eyelink dir.
%                   - glabglobal: Add GLAB_EYELINK.
%                   - closeglab: Add closeeyelink.
%                   - starttrial (see below): send synctime message.
%                   TRIAL:
%                   - starttrial, stopttrial, drawtarget
%                   - displaybuffer: modif. 
%                   PARALLELPORT:
%                   - setparallelbit: new fun
%                   opendisplay: Fix message when screen freq changes <TODO: fix this case!>
%         Jan 2010  TIME/TRIAL:
%                   - startglab: Fix timers synchro failure on some hardware: add a timeout of 2s.
%                   - displaybuffer(b,DUR); Doc: add Example.
%                   - starttrial, stoptrial: continue.
%                   - findmissedframes: 3 arg syntax. <todo: finish function>
%                   IMAGES:
%                   - loadimage: More options. Doc: add "See also".
%                   - resizeimage: New fun.
%                   - storeimage: Check display is open.
% 2-beta12  12 Jan  VERSION #: NEW VERSION # CONVENTION: Odd # are dvpt versions, even # are production versions.
%                   Used on Caroline's PC.
%       12a 20 Jan  Used on BUCKINGHAM. <sub-version # 'a' given retroactively, in 12b>
%                   DISPLAYANIMATION: Fix synchronous mode <!!!> <unfinished>
% 2-beta13          <fork: from 2-beta12a>
%                   starttime: Delete fun.
%                   measurescreenfreq -> sub-function in opendisplay
%                   SPLASH: opendisplay: Splash 'Graphics Lab'. + Fix font size on PTB.
%                   TRIALS: 
%                   - savetrials: new fun <unfinished>
%                   - replace GLAB_TRIAL.Current* -> GLAB_TRIAL.i*
%                   - stoptrial: was mistakenly in "eyeview" folder.
%                   - displaybuffer: error message if called w/o Dur argument during a trial.
%                                    <todo: What about e.g.: displaybuffer; waitkeydown ???>
%                   waitsynch: 
%                   - Fix 'frame' arg.
%                   - Units: rewrite code to clean it
%                   - fix % bug
%                  <todo: displaybuffer: add unit arg.>
% 2-beta12b 27 Jan  VERSION #: 
%                   - glabversion, setupglab: Add subversion <!>  <todo: bug check version #s consistency>
%                   - glabversion('str')  <better for fw compat.>
%                   DISPLAYANIMATION v2.7: 
%                   - Fix isochronous mode <!!!> and add STATS
%                     * Suppress backward compat. GLab v2-beta9-10nov/Sinstim 1.5.x
%                     * Suppress workaround "negtimes" bug (actually isochronous bug)
%                     * Move error messages from Sinstim 1.6.2.
%                     * Make the function verbose
%                     * Export "stats" variable to ws
%                   - Check all warnings in Matlab7.5 editor.
%                   displaymessage: Add TimeOut optional arg.
%                   waitkeydown: 
%                   - Fix 'lib' arg. doc.; duration -> timeout
%                   - Fix case 3 input args.
% 2-beta14          <end fork: Merge beta12b and beta13>
%                   waitsynch: Fix beta13
%           1 Feb   Used on BUCKINGHAM.
%                   round2freqdivisor: Fix missing 2d arg in doc.
%                   DISPLAYANIMATION: v2.7.1
%          12 Feb   Used on BRAGELONNE.
% 2-beta15  3 Feb to ...        
%                   TRIALS:
%                   - Change PERDISPLAY sub-fields names
%                   - starttrial, stoptrial, savettrials: fix and finish saving.
%                   glabcheck: new fun.
%                   PHOTODIODE:
%                   - Field 'isOpen' -> 'Locations'
%                   - Support rect instead of square for PSB
%                   PSB:
%                   - PSB folder
%                   - openpsb, closepsb, psb_*: new funs
%                   - glabglobal: update
%                   - psbblueblanking -> psb_fullblanking
%                   TDT:
%                   - TDT folder
%                   - tdt_* funs
%                   isopen: new fun
% 2-beta16 12 Feb   Used on GALILEO.
%          23 Feb   Hack: com4 -> com3 (Matlab 6.5 only)    
% 2-beta17          gettrials: was in wrong dir. + fix ";" bug.
%                   PSB: move CDM20600.exe from Glab*/Lib/PSB to GLab/PSB <todo: auto install>
%                   COGENT 1.29 <!!!>
%                   - Add v1.29 ; Becomes default in Matlab 7.5+ <!!!>
%                   SERIAL PORT:
%                   - Add GLab*/serial folder. Move all files into it.
%                   - Add MATLAB library <!>
%                   - setlibrary/getlibrary: updtate ; add Matlab version ; fix case n version #
%                   - readserialbytes: Suppress function <!>
%                   LIBRARIES:
%                   - glabglobal: add GLAB_LIBRARIES.
%                   - setlibrary/getlibrary: add MATLAB lib for serial port.
%                   - setlibrary/getlibrary: add Matlab version ; fix case n version # ; 
%                   - getlibrary: Fix current version display in command window.
%                   LINUX: 
%                   - Update/fix funs: setupglab, setlibrary, getlibrary, setpriority, startglab, 
%                     iscog, displayanimation, openparallelport, sendparallelbyte
%                   - setupglab: Replace "cd(<matlab>/work)" by "cd .."
%                   - <Fix PTB !> 
%                     KbName('UnifyKeyNames') sends a warning:
%                     "WARNING! Remapping of Linux/X11 keycodes to unified keynames not yet complete!!"
%                     KbName, line 798, 807-816: Add TRY statement to fix KbName('UnifyKeyNames') on azerty kb on Linux  
%                     Not enough: I still have bugs in subsenquent code in openkeyboard
%                     -> openkeyboard: Don't use KbName('UnifyKeyNames') on Linux!
%                   - openkeyboard: Strange bug line 135: "chars = ',;:=ï¿½ï¿½^$)<ï¿½';" 1 char was missing!
%                   - openkeyboard: Hard-coded modifs in PtbNames.
%                   - openkeyboard: Add TRY statement for 'Shift' and 'control'. <TODO: Suppress generic names>
%                   - openkeyboard: Suppress 'PrintScreen'
%                   - GLab-2*/Lib/ -> GLab-2*/lib/ ; modif setupglab (25/03)
%                   BATCH MODE: 
%                   - displaymessage: Default timeout 10 sec (for stability: avoid to be stuck).
%                   DISPLAYANIMATION: 
%                   - Fix thresh for missed frames warning.
%                   - Add matlab version in 'stats'.
%                   - Modif for test purpose: display priority <TODO: revert it!>
%                   openglabfolder: new fun.
%         -12 mar   setpriority: : Fix buf with cogstd (broken in beta17); Display priority change.
%                   getpriority: Fix realtime case under PTB. <TODO: review getpriority !!! Record priority in displayanimation>
%         -18 mar    displayanimation: Log: minor fixes.
%                   showimagediff: new fun.
%                   INFO:
%                   - dispinfo: New fun.
%                   - Add messages/Replace disp by dispinfo, in: starglab, setupglab, stopglab, openparallelport, setpriority
%                   - setpriority: add '-silent' option.
%         -24 mar   TRAJECTORIES:
%                   - display*: Fix 'tolwin' option doc.
%                   - prepare*/display*: Use '-optionname' convention: 'tolwin' -> '-tolwin' 
%                   - prepare*/display*: '-sound': New option.
%                   - display*: Fix case no tol. win.
%                   - prepare*: Fix Examples in doc.
%                   - prepare*: Fix -tolwin option doc: remove obsolete isWin arg.
%                   - prepare*: Fix 'Phase' arg. case (lower(Phase) at wrong position)
%                   - prepare*: 'none' -> ''
%                   - <TODO:> Change arg order, see humanlab2_demo_beta18alpha
%                   drawround, drawsquare, drawrect: Fix LineWidth doc.
%                   getframdur: Add 'nominal' option. Fix doc. getscreenfreq: cosmetic changes.
%                   isopen: Add 'glab'.
%                   SOUND:
%                   - opensound: Suppr. check GLab open. <reverted>
%                   - opensound: Info.
%                   - storewhitenoise: New fun.
%                   - <TODO!> storewhitenoise, storetuut: Add amplitude arg.
%                   BACKGROUND:
%                   - setbackground: Add setbackground(buffer)
%                   - opendisplay, clearbuffer: modifs
%                   - <TODO:> BlankBuffer is not used: replace by DrawBuffer, replace 0 by DrawBuffer value
% 2-beta18 29 mar   Marcus
%                   displaytrajectory: Fix case several traj.
% 2-beta19 01 Apr :-)
%                   setupglab: Fix 2-beta17: Fix no cd->work, case 1 input arg..
%                   TRAJECTORIES:
%                   - prepare*/display*: version 2 <!!!>
%          15 Apr   DISP INFO:
%                   - dispinfo: Mod. doc.
%                   - Add dispinfo to: openeyelink, checkeyelink, opentdt, startglab, openkeyboard, 
%                     opendisplay, stopglab, 28apr: checkerrors
%                   EYELINK:
%                   - Port on Matlab 6.5. Works only on bt 0.10.4.16. (<!> Suppr. warnings: see openeyelink)
%                   - calibrateeylink/EyelinkDoTrackerSetup_Modified: Fix: EyelinkClearCalDisplay not more used.
%                   - isopen: Add isopen('eyelink')
%                   - calibrateeyelink -> calibeyelink
%                   - calibeyelink: sub_EyelinkDoTrackerSetup
%               <!> SETUPGLAB:
%                   - Always run setupbentools
%                   - Try to run SetupPsychtoolbox if PTB not already installed.
%                   - Check bentools version. <UPDATE BT VERSION # ON NEXT GLAB VERSIONS !!!>
%                   TRIAL EVENTS:
%                   - helper_perframeevents: New helper fun.
%                   - displaybuffer: big modifs
%                   - waitframe: use helper_perframeevents
%                   - waitsynch: always use waitframe
%                   - starttrials: init // out vars
%                   displaybuffer: Delete 'dontclear' option commented code.
%                   isopen: Add 'parallelport'.
% 2-beta20  29 Apr  Labo TMS.
% 2-beta21  04 May  EYELINK:
%                   - geteyelinkfile: script -> function (why was it a script?) ; input args
%                   - geteyelinkfile: 'active.edf': default in <glabroot>/tmp
%                   - sendeyelinksync: add disp time.
%                   deg2pix: Fix case WidthCM not set.
%                   TRAJECTORIES:
%                   - preparetrajectory: Rewrite options with findoptions <BT v0.10.5>
%                   - preparetrajectory: Fix example (was totally obsolete).
%                   - preparetrajectory, displaytrajectory: Phase -> Movement
%ï¿½                  TRIALS:
%                   - stoptrial: Fix case expected duration = inf.
%                   waitsound: comment line 27: error(checksound)
%          /26 may  PSB:
%                   - COM# becomes an argument: openpsb('COM#').
%                   - Code moved in new helper fun.: psb_sendserialbytes, psb_getserialbytes.
%          /31 may  savetrials: moved from "toolbox+" to "toolbox+\GLab-2-beta21"
%          /01 jun  TRAJECTORIES:
%                   - displaytrajectory: Eyelink support.
%                   EYELINK 3.10:
%                   - openeyelink: Record Eyelink version.
%                   - checkeyelink: Fix "record flag inversion" bug in Eyelink CL 3.10 (Marcus') <!>
%                   - checkeyelink: Fix case unknown arg.
%                   - calibeyelink: Make it verbose. /02jun: Dipslay key shortcuts doc from manual p.29.
%                   - calibeyelink: open Eyelink if required.
%          /02 jun  - checkeyelink: Fix IP in error message.
%                   - checkeyelink('isconfigured'): returns -1 when ipconfig returns "Media disconnected".
%                   - Cosmetic: replace "Eyelink" -> "EyeLink".
%                   - geteyelinkfile: Fix EyeLink 3.10 bug: Eyelink('ReceiveFile') returns 0 instead of file size.
%                   - starttrial, stoptrial: remove start-, stopeyelinkrecording. Now record is started at
%                     block start <!!!>. starttrial: replace by a checkeyelink('isrecording').
%                   - calibeyelink: Update bg color + fix fg color.
%                   -> <todo: calibeyelink: replace KbCheck by waitkeydown to avoid Matlab crash after>
%                   - start-, stopeyelinkrecording -> start-, stopeyelinkrecord.
%                   openpsb: Execute only if GLAB_PSB not empty.
%                   dispinfo: moved from GLab -> bentools ; setupbentools updated <!>.
%          /08 jun  savetrials4eyeview: Save first all vars for safety, then append EV vars in the same file.
%          /10 jun  (geteyelinkfile: Check EL status. <Reverted: opneeyelink needs display open.>)
%                   closeeyelink: executes geteyelinkfile before closing link.
%                   geteyelinkfile: verbose.
%                   savetrials4eyeview: - Fix doc. - Try to fix "Error using ==> psychhid" bug (???).
%                                       - Rplace *.g4e -> *.gdf.
%                   starglab: display title.
%                   edf2asc.m: New file. Still empty.
%          /11      CM/DEG:
%                   - dispscreenresolutions: New fun
%                   - startglab: runs stopglab only if not GLAB_IS_RUNNING <!!!>
%                   - setscreensizecm, getscreensizecm: New fun.
%                   - opendisplay: uses getscreensizecm to setup GLAB_DISPLAY.ScreenSize_cm.
%                   - setscreenwidthcm, getscreenwidthcm: obsolete -> /Legacy <!> NB: only used on joystick_erwan#.
%                   - deg2pix, pix2deg: <TODO: case GLab not started> 
%                   - isopen('display'): fix test.
%                   - stopglab: resets GLAB_DISPLAY.ScreenSize_cm = []; <TODO: what appens if pix2deg used after stopglab ???>
%                   TRAJECTORIES -> FRAME SEQUENCES:
%                   - prepareframeseq: New fun. <todo>
%                   HARDWARE:
%                   - config file is always: "X:\glab-hardware.conf", where X: is the drive where GLab is installed.
%                   - setharware: New fun
%                   STATUS:
%                   - Suppr GLAB_FIRST_START_DONE (not used).
%                   - <TODO> opendisplay: replace persistent 'Old' by GLAB_DISPLAY.OLD
%                   - <TODO> setdisplay: New fun.
%                   - <TODO> GLAB_IS_RUNNING -> GLAB_STATUS.isStarted (! if tests: use isopen !!!)
%                   - <todo> GLAB_DEBUG -> GLAB_STATUS.DEBUG
%          /14-18   editglabversion: New fun.
%                   SAVETRIALS4EYEVIEW: 
%                   - to 1.0
%                   - <TODO> Implement varargin
%                   - <TODO> get .edf file
%                   CM/DEG:
%                   - setviewingdistancecm, getviewingdistance: New funs.
%                   - deg2pix, pix2deg: manage viewing distance.
%                   - opendisplay: First run: setviewingdistancecm(57);
%                   clearglab: Add dispinfo.
%                   EYELINK:
%                   - openeyelink, opendisplay: The second to be run sets the display resolution on the EL system.
%                   - edf2asc.m: 
%                     -- Write function. 
%                     -- Exec dir is: "X:\glab\lib\" <!!>
%                     -- Temp dir is: "X:\glab\tmp\" <!!>
%                     -- <TODO: Move output file to original EDF file's dir>
%                     -- <TODO: Check options in read_data_eyelink>
%                   startglab, opendisplay, stopglab: Review verbosity.
%                   startglab: Moved setpriority to the end.
%                   startglab: Fix timers synchronization: use tic & toc and not time() to check timeout.
%                   startglab: Add timer drift test at the end. <TODO: does not work. Move test to stopglab.>
%                   DIRS:
%                   - New folder : "demos\" ; Update setupglab. (+ change ordes of dirs in setupglab)
%                   - Put inside, changing names: humanlab2_demo_* -> marcuslab_demo_*
%                   - "Legacy\" -> "legacy\"
%                   getscreensizecm: Add a programmer note about units (cm vs mm).
%                   opendisplay: GLAB_DISPLAY.isAplha -> .isAplhaMode4CG (not yet used <!>)
%                   getscreenres, +opendisplay: Fix case after stopglab. <medium bug!>
%                   cdglab: cdglab(subdir)
%           /21-22  TRAJECTORIES/FRAMESEQ:
%                   - prepareframeseq: Implement input arg order modification. 
%                   - marcuslab_demo_beta21.
%           /23     drawhshape: Fix 'polygon'.
%                   DRAW:
%                   - drawshape('polygon',b,XYXYXY,RGB): Fix.
%                   - drawshape('polygon',b,XY,XYXYXY,RGB): Implement.
%                   - drawshape('polygon',...) : Fix LineWidth (bug only on PTB, because hollow polygons not supported on Cogent).
%                   - draw: New fun. drawshape -> draw. Modif: Modify RGB arg order. <!!!> Rewrite all <!!!> <ALPHA>
%                   - other draw* (except drawtext): deprecated <!?!?>
%                   getbeamposition: New fun.
%                   copybuffer: 'Option' -> '-option'.
%           /28-29  TRIAL / EVENTS:
%                   - helper_dispevent: New fun.
%                   - displaybuffer, sendparallelbyte: dispinfo -> helper_dispevent.
%                   - setpriority: Minor modif dispinfo.
%                   - helper_dispevent, startglab, stoglab: doDisplayTimes=1: print after trial, doDisplayTimes=2: print during trial,
%                   - stoptrial: Wait last event <Major fix!>
%                   stopglab: setgamma(1) <TODO: Redo that properly.> ; Suppr GLAB_TRIAL = [];
%                   starttrial, startglab: Fix trial # after crash.
%                   stoptrial: Fix case aborted.
%                   iscog: Fix case bug. <TODO: Check case in setlibrary>
%            /30    glabhelper_* : checkerror, helper_perframeevent, helper_dispevent, glabcheck -> glabhelper_*
%                   glabtmp: New fun. <TODO: Use it everywhere!>
%                   glabreplace: Fix it.
%                   stoptrial: Fix isWaitingFirstFrame.
%                   TRIAL:
%                   - waitsynch, displaybuffer: Implement:  displaybuffer(b); waitsynch(dur);  <!!>
%                   - waitframe: Fix PTB case.  <Major fix !!>
% 2-beta22  01 Jul  x setupglab: Update bentools version required.
%                   x Run glabmanual.
%                   x Delete *trajectory.
%                   x Delete legacy\rtdisplaysprites, legacy\rtdisplaybuffers.
%                   x Delete *.m~
%                   o Empty \log.
% 2-beta23  09 Jul  storeimage: Add PTB doc.
%                   displayanimation: fix ";" bug.
%                   isopen, glabhelper_check: Optimization <!>: Don't use glabglobal.
%                   storeimage: Optimize: 4ms -> 1ms on CHEOPS.
%          /12      STARTGLAB: -KEEP OPTION
%                   - startglab, stopglab, clearglab: '-keep' option.
%                   - startglab: Moved disp info and stop glab code after global vars are defined.
%                   - opendisplay: Fix "startpsych(n)" syntax.
%                   TARGETS & FRAMESEQ:
%                   - drawtarget: Replace drawshape by draw. <!>
%                   - prepareframeseq: Invert Color and Size args order (for consistency with draw). <!>
%                   - prepareframeseq: Fix last_x, last_y in 'gap' case.
%                   - drawtarget: Replace target tag by target # <!>
%                   - drawtarget: Add b arg. (for consistency with draw). <!>
%                   o <TODO!> drawtarget(i,...) -> draw(...,'-target',i)
%                   - displayframeseq: Fix movement = ''
%                   displaybuffer: Suppr. disp. events when duration = 1 frame.
%                   DRAW:
%                   - draw('arrow'): Implement.
%                   - draw: Fix Theta.
%                   o draw('polygon'): Fix Theta/LineWidth.
%                   MOUSE:
%                   - PtbGetMouse: Fix doc.
%                   - opendisplay: Record MouseOnset4PTB. <!>
%                   - opendisplay: Call setmouse to put cursor out of display.
%                   - getmouse: Rewrite PSB case (big simplification).
%                   - setmouse: Review totally PTB part (was totally buggy).
%          /13      FILTER:
%                   - filterbuffer: New fun. 
%                   - copybuffer(...,'-filter',kernel): New option.
%                   - optimize!
%                   - opendisplay: Initialize OpenGL. <!>
%                   - glab*/lib/PTB/PtbModified/LoadGLSLProgramFromFiles: Modified PTB function <!!!>
%                   - setupglab: Add "glab*/lib/PTB/PtbModified/" dir.
%                   - opendisplay: use to load shaders <!!>
%                   o <TODO> filterbuffer: inchannels & outchannels as args. Inversion ?!?
%                   o <TODO> Optimize: Prepare filter in advance.
%                   stoptrial: fix case no // out.
%          /14-16   - oneframe: New fun. Easier to use than getframedur. (Returns always something.)
%                   FRAMESEQ:
%                   - displayframeseq: Use starttrial(nFrames);
%                   - prepareframeseq: error if unknown shape.
%                   - frameseq: Change name <!!>: prepareframeseq -> frameseq 
%                   - frameseq: getframedur('nominal') -> oneframe. Seems to fix major bug when frq measure error.
%                   - displayframeseq: Use starttrial(nFrames);
%                   - prepareframeseq: error if unknown shape.
%                   - frameseq: Change name <!!>: prepareframeseq -> frameseq 
%                   - frameseq: getframedur('nominal') -> oneframe. Seems to fix major bug when frq measure error.
%                   displayanimation: disp -> dispinfo
%                   sg: New fun.
%                   STARTUP:
%                   - startglab: Dissable JIT accel in M7.5. <MAJOR OPTIMIZATION !!!>
%                   - startglab: Store random seed in global var.
%                   - startglab: GLAB_STATUS.wasStarted replaces GLAB_FIRST_START_DONE, suppressed in v2-beta21.
%                   - setupglab: clear GLab when version change. <Rewrite totally buggy code v2-beta21 !!!> <MAJOR FIX!>
%                   - clearglab: run stopglab inside a TRY, to fix stopping other GLab versions.
%                   - opendisplay: Invert tests 1 and 2. <!!>
%                   - waitframe, opendisplay: Fix Hz err in windowed display. <MAJOR FIX!!!>
%                   - opendisplay: Review dispinfo.
%                   Review to do 2.0 below.
%                   TRIALS:
%                   - trials2block: New fun.
%                   - glabhelper_processtrials: New fun, used by gettrials.
%                   - starttrials: Uncomment fields definitions.
%                   - Change field names: .*Times -> .*TimeStamps  <!!>
%                   - tr.PERDISPLAY.TARGETS.Tag -> tr.TargetNames  <!!>
%                   - starttrials: Add StartDate.
%                   - Add BeforeDisplayTimeStamps, AfterDisplayTimeStamps
%                   o <TODO> Error summary
%                   o <TODO> TARGETS(iTar) -> OBJECTS.(tarName)   !!!
%                   o <TODO> PERDISPLAY -> PERFLIP.(tarName) 
%                   o <TODO> i*, n* -> *Count
%                   o <TODO> starttrial: first arg = cell arr with tar names OR tar#
%                   o <TODO> drawtarget: first arg = tar# OR tar name
%                   ? <TODO> field names: plur -> sing  <???>
%                   stopglab: Fix verbosity.
%                   DRAW:
%                   - Optim: buffersize(b) -> Screen('WindowSize',b)
%                   o <TODO> OPTIMIZE DRAW !!!
%                   editglabversion -> edgv
%                   displaywarning, displayerror: Add beep.
%                   displaymessage: Fix old "Press E to..." bug.
%          /19-23   Count LoCs: 13448.
%                   stopglab: Fix case missing GLABDISPLAY.doKeep field.
%                   onedegree: New fun, unfinished.
%                   EYEVIEW
%                   - savetrials4eyeview: Save offset & gain to convert from EyeLink's coord to cart coord in deg.
%                   - savetrials4eyeview: Open trials in Eyeview.
%                   - savetrials4eyeview: Get EyeLink file.
%                   - savetrials4eyeview: Eyeview events.
%                   - savetrials4eyeview: Fix secondary targets (-> T2h, etc.) & online eye (-> Oh, Ov).
%                   DIRS
%                   - tmp: Use always glabtmp.
%                   - glablog: New fun.
%                   - displayanimation: Use glablog => Log in x:\glab\var\log. Log only if full screen.
%                   isfullscreen: New fun.
%                   EYELINK
%                   o TODO: Eyelink coord: graph -> cart. <???>
%                   - geteyelinkfile: Fix doc.
%                   stopglab: Avoid try statement on one line to avoid annoying warning on M7.5.
%                   filterbuffer: Change nrinputchannels, nroututchannels. <Seems ~= on DARTAGNAN & CHEOPS !!> <TODO: become arg.>
%                   FIX PTB: EXPCreateStatic2DConvolutionShader, line 132: Fix ";". <FIX PTB!>
%                   STARTUP:
%                   - PRIORITY: startglab: Suppr. HIGH priority. <!!!>
%                   - PRIORITY: stoptrial: Set priority NORMAL <!>
%                   - opendisplay: NumFramesForQuickTest = 50;
%                   - opendisplay: Re-invert test 1 & 2 <revert v. /14-16> because message string disappeared.
%                   TRIAL:
%                   - glabhelper_processtrials: Fix case no // out.
%                   - glabhelper_processtrials: Fix case only 1 or 2 frames in trial.
%                   - displaybuffer: warning if Duration argument is missing.
%                   - displaybuffer: Fix displaybuffer(b,dur) doc.
%                   - displaybuffer: Fix Tag arg.
%                   - stoptrial: Fix isParallelOut
%                   - starttrial: Add TargetNames arg.
%                   o TODO: Add SoundOut events.
%                   FRAMESEQ:
%                   - displayframeseq: Record "Movement" as Tag.
%                   - displayframeseq: Fix multi-targets doc.
%                   o displayframeseq: Fix target names.
%                   o TODO: *frameseq: draw order.
%                   OPTIM:
%                   - gcw, opendisplay: Optim gcw: 131 ï¿½s -> 16 ï¿½s (on CHEOPS). 
%                   - iscog, isptb, setlibrary: Optim iscog, isptb: 75 ï¿½s -> 15 ï¿½s (on CHEOPS).
%                   - convertcoord: Optim convertcoord: 250 ï¿½s -> 175 ï¿½s (on CHEOPS).
%          /26-30   TEST on ATHOS setup:
%                   opendisplay: Fix gcw optim.
%                   oneframe: Fix optim.
%                   startglab: Fix order of operations: disp > set lib & path (setupglab!) > global vars.
%                   startrial: Eyelink Add starteyelinkrecord instead of error message.
%                   glabhelper_processtrials: Fix case # trials > 1.
%                   savetrials4eyeview: Fix save version bugs. <!>
%                   savetrials4eyeview: Suppress saving mfile content. (Was not correctly implemented + pb with reading executing mfile)
%                   EYELINK: See help openeyelink.
%                   - geteyelinkfile -> launched by close eyelink
%                   - start-/stopeyelinkrecord: disp info.
%                   - openeyelink: Rewrite Function Overview in doc.
%                   - openeyelink: Add CalibGrid arg and launches calibeyelink (first time only).
%                   - openeyelink: Crash in case of "Error in connecting to the eye tracker".
%                   - openeyelink, calibeyelink, closeeyelink: Fix GLAB_EYELINK.isCalibrated.
%                   - openeyelink: Fix global vars def.
%                   - geteyelinkfile: Fix GLAB_EYELINK.isFile*.
%                   - calibeyelink: Fix case calib aborted: Don't set isCalibrated=1.
%                   - starteyelinkcalib: New fun.
%                   - savetrials4eyeview: Fix deg to pix conversion.
%                   stoptrial: Fix disp info order.
%                   savetrials4eyeview: Fix FILE.Tfrq.
%                   drawtarget, displayframeseq: Fix b arg bug. <!>
%                   opendisplay: def # test frames: 800 -> 600.
%                   EYEVIEW:
%                   - savetrials4eyeview: Fix: remove old .asc file if there is one.
%                   - savetrials4eyeview: Fix gap & rampe events.
%                   - savetrials4eyeview: Add date suffix.
%                   - savetrials4eyeview: Fix gui input. <yet not tested>
%                   - savetrials4eyeview: Fix case M6.5.
%                   marcuslab_demo_beta23 -> frameseq_demo
% 2-beta24          x setupglab: Update bentools version required.
%                   x Run glabmanual.
%                   x Delete *eyelinkrecording.
%                   x Delete *.m~
%                   x Empty \log.
%                   x glabhelper_processtrials: suppr debug mode.
%                   starttrack: New fun.
%          /30 Aug  - openeyelink: Fix missing bg when run befre startglab.
%                   - openeyelink: Fix ";".
%                   - starteyelinkcalib: Finish doc. Add dispinfo.
%                   - openeyelink: Update doc.
%          /02 Sep  - startglab: Fix lib bug (!): invert setupglab & setlibrary(Lib)
%          /03                   + add glabglobal after setupglab <!>
% 2-beta25  09 Sep  PSB: VARIABLE COM#:
%                   - openpsb: New arg: openpsb(#) or openpsb('COM#')
%                   - psb_sendserialcommand, psb_getserialbytes: New funs.
%                   - openpsb, closepsb, psb_fullblanking, psb_getkeydown: Modif to use new funs.
%                     (with an exeption in closepsb (see code).)
%                   PSB: Misc.:
%                   - closepsb: Was in wrong dir.
%                   - openpsb: Check if GLab started and PSB not already open.
%                   - psb_getkeydown: Include modif from 2-beta16/GALILEO.
%                   LIBRARIES (/KEYBOARD):
%                   - getlibrary: Fix no arg case: A non-std char had been replaced by an editor. 
%                   - setlibrary: Fix doc, same pb as above.
%                   - waitkeydown: Fix no arg case over PTB.
%                   - <info> Current kb lib default: setlibrary/startpsych: <not modified, finally> <TODO: Review that>
%                           - Win + Matlab 6.5 + Cog:   Cog
%                           - Win + Matlab 6.5 + PTB:   PTB  <set in startpsych: todo: -> Cog ?>
%                           - Win + Matlab 7.x + Cog:   Cog
%                           - Win + Matlab 7.x + PTB:   PTB
%                           - Unixes:                   PTB
%                   - <TODO: waitkeydown: rewrite using waitframe>
%                   - <TODO: getlibrary: Priority lib setting not used.>
% 2-beta26  13 Sep  Used on PORTHOS.
%          /14      - psb_sendcommand: Add debug mode (disp echo)
%                   - openpsb, psb_getkeydown: Cosmetic modifs.
% 2-beta27  15 Sep  LINUX:
%                   - Fix case in sub-dirs names: /Test -> /test, /Legacy -> /legacy
%                   - startglab: Fix "dt" var not defined: suppr. dt computation on Unix.
%                   - setupglab: Fix glab dir creation: create ~/glab/
%                   - opendisplay: suppr. InitializeMatlabOpenGL and loading of shaders on Linux: it crashed.
%                   - glablog: Fix function's in doc.
%                   - glablog: on Unix, log dir = ~/glab/var/log
%          /22      MAC OS X:
%                   - openkeyboard: Fix case of 0 keys (bugged because of'00' and '000').
%                   - openkeyboard: Fix case of 0 backspace and del keys.
%                   - openparallelport: Review dispinfo.
%                   - setpriority: Test Mac code. Add in-code comments. Review dispinfo.
%                   - opendisplay: Priority: "HIGH" -> "OPTIMAL". Check all other functions.
%                   displayanimation: Review dispinfo.
%                   MATLAB 7.6+:
%                   - Test accel off: (OK!) First loop: 15.7ms -> 3.7ms, 2d loop: 30.5ms -> 4.9ms <todo: disp 3d loop ?>
%                   startglab: Add signature.
% 2-beta28  30 Sep  Test in LLN with Adriano's experiments.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% HSVMASK  Make binary mask for pixels within hue/saturation/value ranges.
%    M = HSVMASK(Ihsv,h)  returns logical matrix M, with 1's at the position of pixels 
%       with hue h  in HSV image 'Ihsv'. 'h' is the hue in HSV coordinate.
%    M = HSVMASK(Ihsv,[h0 h1])  finds hues in the range h0 to h1.
%    M = HSVMASK(Ihsv,[h0 h1],[s0 s1],[v0 v1])  defines also a range for saturation and
%       value. Default ranges are [1/255 1] for both. You can use the empty matrix []
%       to set an argument to it's default.
%    HSVMASK('HSV Demo')  plots the HSV hue values.
%
% See also: 
%    RGB2HSV, HSV2RGB (Matlab Toolbox)
%    ROIDEMO, ROICOLOR (Image Processing Toolbox)
%    BACKGROUNDMASK (G-Lab Toolbox)
%
% Ben, Nov. 2007.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% IMAGESIZE   Width and Height of the image stored in a matrix.
%    d = IMAGESIZE(I), returns the two-element row vector d = [w h] containing the
%    width and heigth in pixel of the image. Note that this order is the reverse of
%    the order used by the standard Matlab SIZE function.
%    For example, if I is a 600-by-800-by-3 matrix:
%       d = size(I);       returns d = [600 800 3] (uses Matrix Computing convention)
%       d = imagesize(I);  returns d = [800 600]   (uses Image Processing convention)
%    Note also that IMAGESIZE ignores the third dimension: it gives the size of the
%    image, not the size of the matrix in witch it's stored.
%  
%    [w,h] = IMAGESIZE(buffer) returns width and height as separate output variables.
%
%    w = IMAGESIZE(buffer,1) returns the width.
%    h = IMAGESIZE(buffer,2) returns the height.
%
% See also SIZE, BUFFERSIZE.
%
% Ben, Sept 2007.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% INDEXED2TRUECOLOR  Convert indexed 256 colors image matrix to truecolor matrix.
%    I3 = indexed2truecolor(I,M)  converts M-by-N matrix of indices I and D-by-3 (usually D = 256)
%    palette matrix M to M-by-N-by-3 image matrix (G-Lab standard). Both input and output colors 
%    are in the range 0.0 to 1.0.
%
% Ben, Feb 2009
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% ISABORT  True if Escape key has been pressed by the user.
%
% Example: Stop a program if Esc has been pressed:
%
%       if isabort
%           return
%       end
%
% Programmer's note: WAITFRAME and DISPLAYBUFFER always check
% if Escape key state: if down, they set the abort flag to 1.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% ISCOG  True if Cogent2000/CogentGraphics is used as low-level library.
%
%    v2 = ISCOG  if CogentGraphics is used as the main library (for graphics
%    & mouse), returns it's second version number v2 (i.e.: 24 or 28), else
%    returns 0.
%
%    v2 = ISCOG(Module)  returns v2 if Cogent2000/CogentGraphics are used
%    for module 'Module', 0 otherwise. Type 'getlibrary' to get the list
%    of modules.
%
% See also ISPTB, GETLIBRARY, SETLIBRARY.
%
% Ben, Sept-Oct 2008.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% ISFULLSCREEN  True if displaying in full screen.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% ISOPEN  True for open module.
%    ISOPEN XXX  is true if XXX is open (usually with the the STARTXXX or OPENXXX function).
%
%    ISOPEN GLAB  true if GLab is running (with or without display, when supported).
%
%    ISOPEN DISPLAY  true if a GLab display is open.
%
%    ISOPEN TRIAL  true between STARTTRIAL and STOPTRIAL calls.
%
%    ISOPEN('SERIALPORT',i)  true if serial port #i (COMi) is open.
%    ISOPEN SERIALPORT  returns a vector with true/false values for each possible ports.
%
%    ISOPEN('PARALLELPORT')  true if // port open.
%    ISOPEN('PARALLELPORT','OUT')  true if // port open for output.
%    ISOPEN('PARALLELPORT','IN')  true if // port open for input.
% 
%    ISOPEN EYELINK  true if Eyelink initialized. See also CHECKEYELINK.
%
%    ISOPEN PSB  true if PSB initialized. 
%
%    ISOPEN TDT  true if tdtstartblock has been called.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% ISPTB  True if PsychToolBox is used as low-level library.
%
%    true = ISCOG  returns 1 if PsychToolBox is used as the main library
%    (for graphics & mouse).
%
%    ISPTB(Module)  returns 1 if PsychToolBox is used for used for module
%    'Module', 0 otherwise. Type 'getlibrary' to get the list of modules.
%
% See also ISCOG, GETLIBRARY, SETLIBRARY.
%
% Ben, Sept-Oct 2008.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% LOADIMAGE   Read image file from graphics file and covert it to standard format.
%	 I = LOADIMAGE(filename)  reads image from file of given name and returns an
%	 M-by-N-by-3 matrix of values in the range 0 to 1 (Matlab standard data type).
%    If the file name is given without the extension, LOADIMAGE will try sequentially
%    all supported graphics file extensions. (See IMREAD to about supported files.)
%
%	 Images = LOADIMAGE(dirname)  reads all image files in given directory and returns 
%    it in a cell vector.
%
%    [Images,FileNames] = LOADIMAGE(dirname)  returns also the filenames, in a cell 
%    vector.
%
%    LOADIMAGE(...,ColorChannels)  defines color coding. ColorChannels can be 'black-and-white', 
%    (binary image), 'grayscale' (levels of gray), 'rgb' (default) or 'rgba' (red, green, blue + 
%    alpha).
%
%    LOADIMAGE(...,'int')  returns integer (uint8) matrix. This takes 8 times
%    less memory (!) than Matlab's standard double precision floating numbers, but the 
%    drawback is that Matlab 6 does not support operations on integers.
%
%    LOADIMAGE(...,wh)  resizes image(s) to resolution wh. 'wh' is a [width height] 
%    vector.
%
%    LOADIMAGE(...,'verbose')  or  LOADIMAGE(...,'-v')  prints file names when loading.
%
% See also: 
%    - Lowerlevel funct.:    IMREAD (Im. Processing Toolbox),
%    - Im. visualisation:    IMSHOW (Im. Processing Toolbox), SHOWIMAGE,
%    - Im. infos:            IMAGESIZE, 
%    - Im. processings:      BACKGROUNDMASK, CHANGEBACKGROUND, RESIZEIMAGE, SAMESIZE, SAMELUMINANCE, 
%                            RGB2GRAY (Im. Processing Tb), RGB2GGG, RGB2HSV, SCRAMBLEIMAGE,
%    - Store im. in VRAM buff.: STOREIMAGE.
%
% Ben 2007-2010. (Edit file for version infos)
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% MULTIPLEALPHA  Get alpha values for multiple blendings (more than 2 images superposed).
%    A = MULTIPLEALPHA(W)  Computes alpha values A to be used when blending images to get the
%    relative weigths W (proportion of each source image) in the resulting image. In other
%    words,  multiplealpha([w1; w2; ...; wM])  returns the alpha values to get the graphics
%    card making the job equivalent to  ( w1*I1 + w2*I2 + ... + wM*IM ) / M  in Matlab.
%    A and W are M-by-N matrices, where M is the number of images to be superposed and N is 
%    the number of frames.
%
% Example:
%    multiplealpha([.25; .25; .25; .25])  returns:
%
%           1.0000
%           0.5000
%           0.3333
%           0.2500
%
%    which are the alpha values to be used to superpose 4 images with a same contribution (25%)
%    of each.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% NEWBUFFER  Create a drawable offscreen buffer.
%	b = NEWBUFFER  creates a buffer of the same size than the screen and returns it's handle.
%
%	b = NEWBUFFER([w h])  creates a buffer of width w and heigth h. Use NEWBUFFER(IMAGESIZE(I))
%   to create a buffer of the size of image I.
%
%	b = NEWBUFFER(...,[r g b])  creates a buffer with given background color. (Otherwise, 
%   default background color will be used. See SETBACKGROUND.)
%
%   b = NEWBUFFER(I)  <???> creates a buffer of the size of image I, then store I in it with STOREIMAGE.
%
%   NEWBUFFER(b,...)  <CG only> creates a new buffer of handle b. (If a buffer with the same handle 
%   already exists, it will be deleted.)
%
% Examples 1: How to prepare a buffer of the same size than the screen (ready to be displayed).
%   I = loadimage(filename);  % Get image matrix from file.
%   b = newbuffer([1 1 1]);   % Create a buffer of the size of the screen, with white background.
%   storeimage(I,b);          % Copy image I in the buffer. Image will be centered.
%
% Examples 2: How to store a image in a buffer that fit the image size.
%   b = newbuffer(I);   % Create a buffer, then copy image I in it. Buffer has the size of the image.
%
% See also STOREIMAGE, CLEARBUFFER, DELETEBUFFER, RESIZEBUFFER, COPYBUFFER,  
% DISPLAYBUFFER, GCB, SETBACKGROUND, IMAGESIZE.
%
% Ben, 	Sept-Oct 2007
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% ONEDEGREE  One degree distance, in pixels. <TODO: UNFINISHED!>
%    ONEDEGREE  
%
% See also GETFRAMEDUR, GETSCREENFREQ.
%
% Ben, July 2010.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% ONEFRAME  Duration of one screen frame.
%    ONEFRAME  returns the frame duration in milliseconds. The value returned will less accurate 
%    before the first GraphicsLab startup.
%
%    It's the same than GETFRAMEDUR.
%
% See also GETFRAMEDUR, GETSCREENFREQ.
%
% Ben, July 2010.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% OPENDISPLAY  Open G-Lab display, in full screen or in a window.
%   OPENDISPLAY  starts display with default parameters.
%
%   OPENDISPLAY(Screen)  starts display in given screen. 'Screen' value can be 0   
%   (displayin a window), 1 (full screen display on main screen), 2 (full screen  
%   display on secondary screen), 3 (on screen #3), etc. 
%
%	OPENDISPLAY(Screen,DisplayRes)  starts display at given screen resolution. Default 
%   'DisplayRes' value is [800 600].
%
%   OPENDISPLAY(Screen,ScreenRes,BgColor)  starts display with BgColor as default 
%   background color. BgColor is an RGB triplet in the range 0.0 to 1.0.
%
%   OPENDISPLAY(Screen,ScreenRes,<BgColor>,ScreenReqFreq)  checks that the actual 
%   screen frequency matches the frequency that was requested to the operating system. 
%   ScreenReqFreq must have the same value than in the OS configuration. The BgColor 
%   argument is optionnal.
%
%   OPENDISPLAY(Screen,ScreenRes,<BgColor>,ScreenReqFreq,NumTestFrames)  specifies 
%   the number of frames to be displayed to do the screen frequency measure, which is done
%   at first start. The higher the NumFrames value, the higher the precision of the measure.
%   This is critical for EEG experiments. If NumTestFrames = 0, no test is done ; nominal 
%   value is kept as it. 
%
% CogentGraphics only:
%   OPENDISPLAY(...,'AlphaMode')  configurates display to have offscreen buffers in RAM 
%   instead of VRAM. This greatly increase CogentGraphics' alpha blending performances. 
%   Unfortunately, even with this hack, performances stay to low for us. Usage of RAM
%   buffers can also creates synchro problems !!! This mode has no effect on PTB.
%
% See also STARTGLAB, STARTCOGENT, STARTPSYCH, OPENSOUND, OPENKEYBOARD, OPENSERIALPORT, 
%   OPENPARALLELPORT, STOPGLAB.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% OPENGLABFOLDER  Open GLab folder in Windows Explorer.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% OPENKEYBOARD  Initialize keyboard.
%    OPENKEYBOARD  initalizes keyboard with default settings.
%
%    OPENKEYBOARD(isExclusive),  if set to 1, gives exclusive control on the keyboard to G-Lab.
%    This option IS NEEDED FOR PROPER TIMING PRECISION of keyboard events, but in case of G-Lab
%    crash, you'll not be able to stop it with Ctrl+Alt+Del or any other Windows shortcut. So, 
%    use it with care: DO NOT USE IT WHILE YOU ARE DEBUGGING!!! Default value is of course 0.
%    This option is only available under MS-Windows; on other systems it will be ignored.
%
%    OPENKEYBOARD(isExclusive,TimeResolution) precises time resolution in ms. Default value is 1
%    in exclusive mode or 5 in non-exclusive mode.
%
%    OPENKEYBOARD(isExclusive,TimeResolution,QueueLength) precises length of the key buffer. 
%    Default value is 100.
%
% Programmer only:
%    OPENKEYBOARD('PTB')  is used by OPENDISPLAY to initialize PTB keyboard only.
%
% See also STARTCOGENT, OPENDISPLAY, OPENSOUND, OPENSERIALPORT, OPENPARALLELPORT, STOPGLAB.
%
% G-Lab function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% OPENPARALLELPORT  Open and initialize parallel port.
%    OPENPARALLELPORT OUT  if a // port exists (LPT1) and is not already open, opens it and 
%    initializes it to send data. If the port is already open, simply sets direction. 
%
%    OPENPARALLELPORT IN  opens the // port and initializes it to receive data.
%
%    OPENPARALLELPORT(PortNum <,Direction>)  opens specified // port. (See example below.)
%
%    dio = OPENPARALLELPORT(...)  returns the port's digitalio object. (See DAq toolbox help.)
%
% Examples: 
%    openparallelport out;      % opens LPT1 for output.
%    openparallelport(2,'in');  % opens LPT2 for input.
%
% See also: SENDPARALLELBYTE, CLOSEPARALLELPORT.
%
% Ben,  Nov 2007  v1.0 <
%
%       Feb 2009. v2.0
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% OPENPHOTODIODE  Initialize GLab for photodiode use.
%    OPENPHOTODIODE(Locations,SquareSize)  sets GLab to display 1 to 4 photodiode squares in corners 
%    defined by the 'Location' matrix. 'Location' is a 2-by-2 square matrix of 0s and 1s. Each
%    element define the presence (1) or the absence (0) of a photodiode square in the corresponding
%    screen corner. 'SquareSize' is the size of the squares in pixels.
%
%    OPENPHOTODIODE(Locations,SquareSize,isAutoSwitchOff)  <TODO>
%
% Example:
%    openphotodiode([1 0; 0 0], 16)  initializes GLab to display one photodiode square of 16 pixels 
%    width in the upper-left corner on the screen.
%
% See also: SETPHOTODIODEVALUE, CLOSEPHOTODIODE.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% OPENSERIALPORT  Open a serial port.
%    OPENSERIALPORT  opens serial port (COM1) with default settings. Will work on most cases.
%
%    OPENSERIALPORT(port) opens given port. 'port' is the port number (e.g.: 1 for COM1). 
%    Multiple serial ports are not supported: you can only open one port at a time.
%
%    OPENSERIALPORT(port,baudrate) specifies baudrate (bits per second). Default value is 9600.
%    Valid values: 110,300,600,1200,2400,4800,9600,14400,19200,38400,56000,57600,115200,128000,256000.
%
%    OPENSERIALPORT(port,baudrate,parity) specifies also parity. Default is 'none'.
%    Valid values: 'none', 'odd', 'even', 'mark', 'space'.
%
%    OPENSERIALPORT(port,baudrate,parity,stopbits) specifies stop bits. Default is 1.
%    Valid values: 1, 1.5, 2.
%
%    OPENSERIALPORT(port,baudrate,parity,stopbits,bytesize) specifies byte size. Default is 8.
%    Valid values: 4 to 8. (Programmer's note: not sure for values 5 to 7.)
%    
% Examples:
%    openserialport(1,9600,'none',1,8)  is the same than openserialport with no arguments.
%
%    openserialport(4,115200)  opens COM4 with correct settings for the USB serial port (1) of
%                              Saint Luc's 3 Tesla fMRI scanner or (2) of Benoit Gerard PSB.
%
% See also: READSERIALBYTES, SENDSERIALBYTES, WAITSERIALBYTE, GETSERIALBYTES, CLOSESERIALPORT,
%    OPENPARALLELPORT.
%
% Ben, Jan. 2008
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% OPENSOUND  Initialize sounds for G-Lab.
%    OPENSOUND  initializes sounds with default settings. Good for most users.
%    It is the same than OPENSOUND(44100,16,2).
%
%    OPENSOUND(frequency)  specifies the sampling frequency. Default is 44100.
%    Common values are 8000, 11025, 22050 and 44100.
%
%    OPENSOUND(frequency,nbits)  specifies number of bits per sample (8 or 16). 
%    Default is 16.
%
%    OPENSOUND(frequency,nbits,2)  config. for stereo. (Default is mono.)
%
% Example:
%    opensound;                                 % initialize sound system.
%    storesound('C:\WINDOWS\Media\ringin.wav'); % stores sound in sound buffer.
%    t0 = playsound;                            % starts playing.
%    t1 = waitsound;                            % waits until end of playing.
%
% See also: OPENSOUND, STORESOUND, STORETUUT, PLAYSOUND, WAITSOUND.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% PEEKKEYEVENTS  Return keyboard events without clearing the event stack. <NOT YET FULLY INTEGRATED!>
%    [Times,IDs,isDown] = PEEKKEYEVENTS  returns key events since last call 
%    to GETKEYEVENT without modifying the keyboard event stack.
%
% See also GETKEYEVENTS, CHECKKEYDOWN.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% PIX2DEG  Pixels to degrees conversion.
%    deg = PIX2DEG(pix)
%
% See also DEG2PIX, SETSCREENSIZECM, SETVIEWINGDISTANCECM, SETHARDWARE<todo>.
%
% Ben, June 2010.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
%% PLAYSOUND  Start sound buffer playing.
%    A sound must first have been stored in the sound buffer with STORESOUND 
%    or STORETUUT.
%
%    t0 = PLAYSOUND  starts playing from default sound buffer (buffer 1) and 
%    returns onset time, immediatelly (i.e.: without waiting end of playing).
%    If you need to wait until end of playing, see WAITSOUND. Once played, 
%    the sound will be deleted from the buffer and has to be stored again to 
%    be played once more.
%
%    t0 = PLAYSOUND(b)  plays sound from sound buffer(s) b. b can be a scalar
%    of a vector of buffer handles. In the latter case, multiple sound will 
%    be played in parallel.
%
% Example:
%    opensound;                                 % initialize sound system.
%    storesound('C:\WINDOWS\Media\ringin.wav'); % stores sound in sound buffer.
%    t0 = playsound;                            % starts playing.
%    t1 = waitsound;                            % waits until end of playing.
%
% See also: OPENSOUND, STORESOUND, STORETUUT, PLAYSOUND, WAITSOUND.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% STARTPARALLELPORTPOLLING  <not finished>
%    STARTPARALLELPORTPOLLING  starts polling of // port that has been open by OPENPARALLELPORT.
%    ...
%
%    STARTPARALLELPORTPOLLING(dt)  polls every dt milliseconds. Minimum dt value is 1, which is also
%    the default value.
%
%    STARTPARALLELPORTPOLLING(n,dt)  polls LPTn every dt milliseconds.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% PREPAREFRAMESEQ  Prepare input variables for DISPLAYFRAMESEQ.
%    General syntax:
%       S = PREPAREFRAMESEQ(What,...,Movement,... <,'-option1',...> <,'-option2',...>
%
%    What:
%       PREPAREFRAMESEQ('',Duration)  displays nothing for Duration in milliseconds.
%
%       PREPAREFRAMESEQ(Shape,Color,Size,...)
%       PREPAREFRAMESEQ(Shape,Color,Size,LineWidth,...) <TODO: orientation>
%
%       PREPAREFRAMESEQ('buffer',b,...)
%
%       PREPAREFRAMESEQ('text',string,<FontName>,Size,Color,...)
%
%    Movement: (If you don't find what you which, see the 'custom' movement at the end)
%       PREPAREFRAMESEQ(...,'fix',[x y],Duration)
%       PREPAREFRAMESEQ(...,'fix',xyCenter,Rho,Theta,Duration) <todo>
%
%       PREPAREFRAMESEQ(...,'step',[xstep ystep]) <TODO: coord abs or rel ?> <ans: rel, otherwise it's a fix>
%
%       PREPAREFRAMESEQ('gap',Duration)  is the same that  PREPAREFRAMESEQ('',Duration).
%
%       PREPAREFRAMESEQ(...,'rampe',[x1 y1],Duration,[] ,[]   )  or,
%       PREPAREFRAMESEQ(...,'rampe',[x1 y1],[]      ,Vel,[]   )  or,
%       PREPAREFRAMESEQ(...,'rampe',[]     ,Duration,Vel,Alpha)  prepares a rampe from
%       the point x0, y0 to the point x1, y1, of duration 'Duration' (msec), at velocity 'Vel' and of 
%       orientation 'Alpha' (deg). Movement parameters which have to be computed are replaced by [].
%       [x0 y0] is never given as input argument: they are the co-ordinates of the last point of the 
%       previous movement (e.g.: a fixation or a step). See the drawing below to understand why.  
%
%               X ^
%                 |
%             x1 -|                             o  o  o  o  o  o
%                 |                          o
%                 |                       o
%                 |                    o
%                 |                 o
%             x0 -|  o  o  o  o  o
%                 '- |-----------|  |-----------|  |-----------|  ---> time
%                    t0   fix    t1 t0  rampe   t1 t0   fix    t1
%
%       PREPAREFRAMESEQ(...,'arc',xyCenter,Rho,Theta1,Duration,[]    ,[]     )  or,  <todo>
%       PREPAREFRAMESEQ(...,'arc',xyCenter,Rho,Theta1,[]      ,AngVel,VelSign)  or,  <todo>
%       PREPAREFRAMESEQ(...,'arc',xyCenter,Rho,[]    ,Duration,AngVel,VelSign)       <todo>
%
%       PREPAREFRAMESEQ( ... ,Shape,Size,Color,'continue',...)  x0 and y0 are the last x and y
%       values of the last call to PREPAREFRAMESEQ. <???>
%
%       PREPAREFRAMESEQ(...,'custom:xxx',xvect,yvect)
%
% Options:
%  - Tolerance Window:
%    PREPAREFRAMESEQ(...,'-tolwin',GraceDuration,WinSize)  defines a tolerance window, appearing
%    after GraceDuration ms, of size given by the [width heigth] vector WinSize.
%
%  - Sound:
%    PREPAREFRAMESEQ(...,'-sound',b,Delay)  associates a sound with the target. The sound  
%    previously stored in audio-buffer #b (by STORESOUND, STORETUUT or a similar STORE* function) 
%    will be  played Delay ms after the onset of the first frame. Delay will be rounded to an   
%    integer number of frames.
%
% Output:
%    The output S is a structure array (one structure per frame) containing the fields:
%           S.mov       Movement ('', 'fix', 'rampe', etc.)
%           S.what      'round', 'square', 'buffer', 'text', etc
%           S.size      Target width, or [width height], or relative coord for a arbitrary polygon
%           S.color     [r g b] or [r g b alpha] vector (values from 0.0 to 1.0)
%           S.x         x position (pixel)
%           S.y         y position (pixel)
%           S.option.tolwin    Tolerance window [width height] ([0 0] if no window)
%           S.option.sound     IDs of audio-buffers to be played (0 if none)
%
% Example: The incredible rashbass of the green point !!!
%    % Init display
%    startcogent % initializes Cogent display with default settings. Use startpsych to init psychToolbx display
%
%    % Get structures for each movement:
%    size = 10;
%    rgb = [1 0 0]; % MUST contain red for PSB !!!
%    fix1  = prepareframeseq('round',rgb,size,'fix',[-200 0],1000,'-tolwin',250,[100 100]);
%    gap   = prepareframeseq('',500);
%    rampe = prepareframeseq('round',rgb,size,'rampe',[200 0],2000,[],[],'-tolwin',250,[200 100],'-sound',1,0);
%    fix2  = prepareframeseq('round',rgb,size,'fix',[200 0],1000,'-tolwin',0,[100 100]);
%
%    % Concatenate structures:
%    target = [fix1 gap rampe fix2];
%
%    % Display trial
%    displayframeseq(target);
%
% See also DISPLAYFRAMESEQ.
%
% Ben,  Jun 2010.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% PREPARESINANIMATION  Prepare variables for DISPLAYANIMATION, to get sinusoidal stimuli.
%    [BUFFERS,ALPHA,Peaks,Phases] = PREPARESINANIMATION(Buff1,Buff2,Dur,SineFreq,AlphaRange,isHarmonic,<RandPattern>)
%
%    1) Image is Variable, Interlaced: Image change at each half-phase.
%    PREPARESINANIMATION(bb,bb,...)  (twice the same vector bb.)
%
%    2) Image is Variable, Non-Interlaced: Image change at each phase.
%    PREPARESINANIMATION(NaN,bb,...)
%
%    3) Image is Constant.
%    PREPARESINANIMATION(NaN|b1,b2,...)  (b* are scalars.)
%
%    Dur:       Duration in seconds.
%    SineFreq:  Freq. of sinusoid (not screen freq.!).
%
%    BUFFERS:   2-by-N matrix.
%    ALPHA:     2-by-N matrix.
%
%    Edit code to get more infos.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% RESIZEBUFFER  Change the size of an offscreen buffer.
%    RESIZEBUFFER(buff,[w h])  Change size to width w and height h.
%    RESIZEBUFFER(buff,IMAGESIZE(I))  Give the same size than image I.
%
% See also NEWBUFFER, BUFFERSIZE, IMAGESIZE.
%
% Ben, Sept 2007
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% RESIZEIMAGE  Resize image.
%    I = RESIZEIMAGE(I, SCALE) returns an image that is SCALE times the size of I,
%    which is a grayscale, RGB, or binary image, or a cell array containing such images.
%    
%    I = RESIZEIMAGE(I, [W H]) resizes the image so that it has W columns and H rows. 
%    Either W or H may be NaN, in which case RESIZEIMAGE computes the number of columns
%    or rows automatically in order to preserve the image aspect ratio.
%
%    To control the interpolation method used, add a METHOD argument to any of the
%    syntaxes above, like this:
%  
%         I = RESIZEIMAGE(I, SCALE, METHOD) 
%         I = RESIZEIMAGE(I, [NUMROWS NUMCOLS], METHOD),
%
%    See HELP IMRESIZE about the METHOD argument.
%
% Ben, Jan 2010.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% RGB2GGG   Color to grayscale conversion.
%    color = RGB2GGG(color)  Convert rgb vector or M-by-3 matrix 'color' to b&w.
%    I = RGB2GGG(I)          Convert M-by-N-by-3 image matrix 'I' to b&w.
%
% For theory, see:  http://en.wikipedia.org/wiki/Luma_%28video%29
%
% See also RGB2GRAY (Image Processing Toolbox)
%
% Ben, Oct 2007
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% RGB2HSV Convert red-green-blue colors to hue-saturation-value.
%
%   ==== This is a fixed version of the MATLAB 6.5 function. See below. ===
%
%   H = RGB2HSV(M) converts an RGB color map to an HSV color map.
%   Each map is a matrix with any number of rows, exactly three columns,
%   and elements in the interval 0 to 1.  The columns of the input matrix,
%   M, represent intensity of red, blue and green, respectively.  The
%   columns of the resulting output matrix, H, represent hue, saturation
%   and color value, respectively.
%
%   HSV = RGB2HSV(RGB) converts the RGB image RGB (3-D array) to the
%   equivalent HSV image HSV (3-D array).
%
%   CLASS SUPPORT
%   -------------
%   If the input is an RGB image, it can be of class uint8, uint16, or 
%   double; the output image is of class double.  If the input is a 
%   colormap, the input and output colormaps are both of class double.
% 
%   See also HSV2RGB, COLORMAP, RGBPLOT. 
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% RGB2RGB  Convertions between RGB 3-D matrix and R, G, B 2-D matrices.
%    [R,G,B] = RGB2RGB(RGB)
%    RGB = RGB2RGB(R,G,B)
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% ROUND2FRAME  "Round" a time to the closest multiplier of the frame duration.
%    t = ROUND2FRAME(t)
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% ROUND2FREQDIVISOR  Round frequencies to the closest divisor of the screen frequency.
%    freq = ROUND2FREQDIVISOR(freq)  Round to the closest divisor of 'screenfreq'.
%
%    freq = ROUND2FREQDIVISOR(freq,screenfreq)  Round to the closest divisor of 'screenfreq'.
%
%    freq = ROUND2FREQDIVISOR(freq,screenfreq,'even')  Round to the closest frequency with a 
%                                   even number of frames in a phase.
%
%    freq = UNIQUE(ROUND2FREQDIVISOR(...))  Suppress repetitions.
%
% Ben, Oct. 2007
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SAMELUMINANCE  Equalize luminance of images.
%    C = SAMELUMINANCE(C)  equalizes luminance of images matrices stored
%    in cell array C. Image matrices are M-by-N-by-P matrices, where P = 
%    1, 3 or 4, in the range 0 to 1. 
%
%    C = SAMELUMINANCE(C,BG)  ignores pixels defined by baground masks
%    (see BACKGROUNDMASK) contained in cell array BG.
%
%    RGB = SAMELUMINANCE(RGB)  equalizes luminances of colors contained
%    in the M-by-3 matrix of red-green-blue values, in the range 0 to 1,
%    "RGB".
%
%    Scientifical note: To be precise, what we actually equalize is the
%    "luma" (weigthed RGB values), which is only an approximate of the 
%    actual "luminance". This is fine for grayscale images if you've
%    corrected the gamma of your screen (otherwise it's meaningless.) 
%    On color images, even with gamma correction, the operation is very
%    approximative.
%
%    Note 2: Errors can occur because of 
%
% See also: SAMEHUE, SAMESIZE.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SAMESIZE  Equalize size of images.
%    C = SAMESIZE(C)  equalizes size of image matrices stored in cell array C 
%    by adding rows/columns of background color to the smallest. The function
%    uses BACKGROUNDMASK to extract the background color.
%
%    C = SAMESIZE(C,rgb)  adds rows/cols of given color, instead of using 
%    BACKGROUNDMASK to define the color automatically. "rgb" is a RGB triplet
%    or a RGBA quadruplet, in the range 0.0 to 1.0.
%
%    C = SAMESIZE(C,<rgb>,'VH')  precises where to add the rows and columns:
%    "V" stands for 'T' (Top), 'B' (Bottom) or 'C' (both: image on the Center);
%    "H" stands for 'L' (Left), 'R' (Right) or 'C' (both: image on the Center).
%    Default is 'CC'. "rgb" argument is optional.
%
%    C = SAMESIZE(C,<rgb>,VH,mn)  equalize row number to maximum width + m 
%    and column number to max heigth + n. "mn" is a 2 elements vector containing
%    the number of rows and columns to add. This option is usefull to avoid
%    border effects in further processing, especially to use BACGROUNDMASK with
%    the "Dilate" argument.
%
%    C = SAMESIZE(C,<rgb>,VH,mn,RoundTo)  rounds max width and heigth to even or 
%    odd number. "RoundTo" value can be 'even', 'odd' or ''.
%
% See also: SAMELUMINANCE, SAMEHUE.  <todo>
%
% Ben,  Nov. 2007   1.0
%       Nov. 2008   2.0
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SAVETRIALS  Save block of trials. <TODO: UNFINISHED!>
%    SAVETRIALS(FILENAME)  saves data that have been automatically collected between STARTTRIAL 
%    and STOPTRIAL.  Data will be saved both as a MATLAB .mat file and as a standard .txt file. 
%    The latter can be read by other programs (e.g.: Excell, Statistica, SPSS,...).
%
% See also: STARTTRIAL, DRAWTARGET, STOPTRIAL.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SAVETRIALS4EYEVIEW  Export trials data to Eyeview.
%    SAVETRIALS4EYEVIEW(savefile)  Saves automatically recorded trials data (see STARTTRIAL 
%    and STOPTRIAL) in a file readable by Eyeview 0.25 or later. 
%    For safety all variables in the caller function space will also be saved "as it".
%
%    SAVETRIALS4EYEVIEW('GUI')  opens a dialog box to let the user put a file name.
%
%    SAVETRIALS4EYEVIEW(...,'VARNAME1.field_name1',value1,'VARNAME2.field_name2',value2,...)  <TODO!!!>
%    stores values in fields of Eyeview's variables. 'VARNAME' can be 'FILE', 'BLOCKS' or 'TRIALS'.
%    'field_name' is the name of the field you want to have in Eyeview.
%
%    SAVETRIALS4EYEVIEW(...,'-open',1)  opens saved trials in Eyeview.
%    SAVETRIALS4EYEVIEW(...,'-open',0)  is the same than the default.
%
% Example:
%    savetrials4eyeview('gui') 
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SCRAMBLEIMAGE  Scramble FOREGROUND pixels in image(s).
%    I = scrambleimage(I,BG)  scrambles foreground pixels in image ,
%    matrix I. BG is the background mask, see BACKGROUNDMASK.
%    I and BG can also be cell arrays.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SELECTBUFFER   Select buffer b for subsequent use of cg* (CogentGraphics) functions.
%    The buffer becomes the "current buffer" (see GCB).
%    This function has no effect on PTB low-level functions.
%
%    SELECTBUFFER(b)
%
% Ben, Oct 2007
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SENDPARALLELBYTE  Send one byte through parallel port.
%    SENDPARALLELBYTE(n)  sends number n, an integer in the range 0:255, trough the port
%    open by OPENPARALLELPORT.
%
%    SENDPARALLELBYTE(bits)  'bits' is a vector of binary values.
%
%    SENDPARALLELBYTE(n,...)  send bytes trough LPTn.
%
%    t = SENDPARALLELBYTE(...)  returns time (ms). 
%
% Examples:
%       openparallelport out;               % open the port for output (open the 8 lines)
%       t = sendparallelbyte(8)             % set port value to: 0 0 0 0 1 0 0 0
%       wait(1)                             % let line 3 stay high 1 ms
%       sendparallelbyte(0)                 % reset to 0 (all lines low)
%       t = sendparallelbyte([1 0 1])       % set port value to: 0 0 0 0 0 1 0 1
%       wait(1)                             % let lines 0 and 2 stay high 1 ms
%       sendparallelbyte([0 0 0 0 0 0 0 0]) % reset to 0 (all lines low)
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SENDSERIALBYTES send bytes to serial port
%
% Description:
%     Send bytes to serial port.
%
% Usage:
%     SENDSERIALBYTES( port, bytes )
%
% Arguments:
%     port    - port number
%     bytes   - array of bytes
%
% Examples:
%     SENDSERIALBYTES( 1, 10 )          - Send 10 to COM1
%     SENDSERIALBYTES( 2, [ 1 2 4 8 ] ) - Send the bytes 1, 2, 4, 8 and 16 (in sequence) to COM2
%
% See also:
%     CONFIG_SERIAL, READSERIALBYTES, SENDSERIALBYTES, LOGSERIALBYTES, WAITSERIALBYTE, GETSERIALBYTES
%
% Ben, 26 Feb 2010.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SENDTRIALS2EYEVIEW  Open GLab trials in Eyeview. <UNFINISHED>
%    SENDTRIALS2EYEVIEW  if Eyeview is present, opens last file saved by SAVETRIALS4EYEVIEW with
%    Eyeview.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SETBACKGROUND  Set default backgound color.
%    SETBACKGROUND(rgb)  sets default backgound color to rgb. rgb is a [red green blue] vector in
%    the range 0.0 to 1.0. This background color will be used by NEWBUFFER (by default) and 
%    DISPLAYBUFFER.
%
%    SETBACKGROUND(b)  defines buffer b as the default background.
%
%    SETBACKGROUND([])  undo SETBACKGROUND(b).
%
% See also STARTCOGENT/STARTPSYCH, OPENDISPLAY, NEWBUFFER, DISPLAYBUFFER, GBB.
%
% Ben,	Sep 2007.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SETDRAW  Set drawing settings. <not finished>
%    SETDRAW(SettingName,SettingValue)  sets the value of specified setting.
%
%    SETDRAW(SettingName1,SettingValue1,SettingName2,SettingValue2,...)
%
% Valid setting names are:
%
%   'Scale':
%       SETDRAW('Scale','Pixel')  sets pixel coordinate. (G-Lab's default.)
%
%       SETDRAW('Scale',ScreenWidthDeg)  set degree (of visual angle) as the co-
%       ordinate system to use, and sets given value as the screen width in degrees.
%    
%       SETDRAW('Scale',[ScreenWidthMM ObserverDistanceMM)  set degree of visual
%       angle) as the coordinate system, and compute the screen with in deg from 
%       screen width and observer distance in millimeters.
%
%   'XAlign','YAlign':
%       SETDRAW('XAlign',Alignement)  sets horizontal alignement for all drawing 
%       operations. Alignement value can be: 'L' (or 'Left'), 'C' (or 'Center'),
%       'R' (or 'Right').
%   
%       SETDRAW('YAlign',Alignement)  sets vertical alignement for all drawing 
%       operations. Alignement value can be: 'T' (or 'Top'), 'C' (or 'Center'),
%       'B' (or 'Bottom').
%
%   'LineWidth'
%       SETDRAW('LineWidth',w)  sets line width to w pixels.
%
%   'DrawColor'
%       SETDRAW('DrawColor',rgb)  sets pen color. rgb is a red-green-blue triplet 
%       in the range 0.0 to 1.1.
%
%       SETDRAW('BackgroundColor',rgb)  sets default background color. rgb is a 
%       red-green-blue triplet in the range 0.0 to 1.1.
%       
%	, 'BackgroundColor', ('TransparencyColor'), 'FontName', 'FontSize'.
%       <TODO>
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SETGAMMA  Set gamma value, for hardware gamma correction.
%    oldTABLE = SETGAMMA(gamma)
%    oldTABLE = SETGAMMA(TABLE)
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SETHARDWARE
%    sethardware('screen',n,'size(cm)',[w h])  configurates GLab for using a screen of physical size  
%    w-by-h centimeters.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SETLIBRARY   Select lower-level C libraries to be used by the toolbox.
%    For graphics operations G-Lab version 2 can run either on top of
%    CogentGraphics (CG) MEX-files or on top of PsychToolBox (PTB) MEX-files.
%
%    SETLIBRARY('CG'|'PTB')  selects library for graphics operations and mouse 
%    control, either 'CG' or 'PTB'.  Non graphics-related operations are not 
%    affected and keep their current settings.
%
%    SETLIBRARY('CG',Version)  sets library version to use. 'Version' can be
%    [1 24] or [1 28].
%
%    SETLIBRARY(Module1,Lib1,Module2,Lib2,...)
%    See below about modules and related libs.
%
%    SETLIBRARY  <deprecated>
%
%    SETLIBRARY('All',LIB)  <TODO>
%
%    SETLIBRARY('Defaults')  resets to defaults.
%
%
% Available Libraries per Modules:
% ================================
%	 Module				Lib			Files							Notes
%	 ------             ---         -----                           -----
%	'Graphics'			CG			cg*.mex*, gprim.mex				Graphics + mouse. Alpha blending to slow!
%                       PTB         Screen.dll | Screen.mex*
%	'Sound'				Cog			CogSound.mex*,CogCapture.mex*
%	'Keyboard'			Cog	(v1.28)	CogInput.mex* (Does not work!)	Critical bug!, on MATLAB 6.5 & 7.5, on WinXP SP2
%						Cog	(v1.25)	CogInput.dll					Works fine. Cannot be used with CG 1.28.
%	'SerialPort'		Cog			CogSerial.mex*                  Matlab 6.5: Works fine. 
%                                                                   Matlab 7.5: Critical performance bug: several secs.
%                                                                               Crashes with PSB's USB serial.
%                       MATLAB      toolbox/matlab/iofun/@serial/*  Performance issue: several ms to send 1 byte. 
%	'ParallelPort'		DAQ			toolbox/daq/*
%	'Time'				CG			cogstd.mex*						No wait function: Must do buzzy wait.
%						PTB			GetSecs.mex*,WaitSecs.mex*		WaitSecs: Avoid buzzy wait.
%	'Priority'			CG			cogstd.mex*
%
%
% Libraries Info:
% ===============
%	Abr.	Name				Versions	For
%	----    ----                --------    ---
%	'CG'	Cogent Graphics		1.24, 1.28	Graphics, Sound (not yet supported), Mouse.
%	'Cog'	Cogent 2000			1.25, 1.28	Sound, Keyboard, Mouse (not supported),
%											Serial Port, Time, Priority.
%	'PTB'	PsychToolBox 3		3.0.8		Time. (Other stuffs will be supported in v2.0)
%	'DAQ'	Data Acquisition 	-			Parallel Port.
%			Toolbox
%
%
% Library Versions:
% =================
% 	Cog-1.25/CG-1.24:	Was powering G-Lab v. 0.x to 1.5.x.
%						Compatible with MATLAB 6.5 to 7.4 (R2007a).
%						Not compatible with MATLAB 7.5 (R2007b) and later.
%	Cog-1.28/CG-1.28:	Default libraries in G-Lab v1.6
%						Compatible with MATLAB 6.5 and later.
%						MATLAB 7.5: Keyboard problem.
%						Need a specific version for MATLAB 7.1.
%
%
% See also STARTCOGENT, STARTPSYCH, GETLIBRARY.
%
% Ben, Sept-Oct 2008
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SETMOUSE  Set current mouse position to given co-ordinates.
%    SETMOUSE(x,y)  sets mouse position to x, y co-ordinates.
%
%    SETMOUSE(xy)  does the same.
%
%    SETMOUSE OUT  puts mouse's cursor out of the display.
%
% See also GETMOUSE.
%
% Ben, March 2008.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SETPARALLELBIT
%    SETPARALLELBIT(iPort,i,value)
%
%    SETPARALLELBIT(iPort,i,value)
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SETPARALLELPORT  Set parallel port for input or output.
%    SETPARALLELPORT IN  sets // port to receive data.
%
%    SETPARALLELPORT OUT  sets // port to send data.
%
%    SETPARALLELPORT(n,'IN'|'OUT')  sets LPTn.  Programmer note: Use always this syntax inside
%    a G-Lab function, to avoid 1) abug if more than one port open and 2) unusefull displays.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SETPHOTODIODEVALUE
%    SETPHOTODIODEVALUE(halfbyte)  sets state of photodiode squares for the next display. 'halfbyte'
%    is an integer between 0 and 15: 1 is upper-left corner, 2 is upper-right, 4 is lower-left, 8 is 
%    lower-right; numbers can be added. The state will be actually changed at the next call of
%    DISPLAYBUFFER.
%
%    SETPHOTODIODEVALUE(SquareMatrix)  does the same. 'SquareMatrix' is 2-by-2 square matrix of 0
%    (off/black), 1 (on/white) and NaNs (no photodiode) which define the state of the photodiode
%    squares in the corresponding screen corners.
%
% Example 1:
%    openphotodiode([1 1, 1 0],16)  % Init for 3 photodiode squares in TL, TR and BL corners.
%    setphotodiodevalue(5)          % Set on photodiodes squares in TL (1) and BL (4) corners. (1+4=5)
%    displaybuffer(...)             % Display. The photodiode squares are actually updated.
%    setphotodiodevalue(0)          % Set off all photodiodes squares.
%    displaybuffer(...)             % Display. Photodiode squares actually off.
%
% Example 2:
%    setphotodiodevalue([1 0, 1 NaN])   % is the same than  setphotodiodevalue(5)  in the above example.
%
% See also: OPENPHOTODIODE, CLOSEPHOTODIODE, DISPLAYBUFFER.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SETPRIORITY  Request Windows to change the priority level given to MATLAB.
%    SETPRIORITY OPTIMAL   raises priority, letting G-Lab choose for you the best compromize between 
%    raising privilege and avoiding troubles, depending of your OS and peripherals in use.
%
%    SETPRIORITY NORMAL    Like any other user program.
%
%    SETPRIORITY HIGH      Higher priority than other user programs, but lower than system processes.
%
%    SETPRIORITY REALTIME  Higher priority than some system processes. That can cause troubles. Don't
%    stay longer than necessary in this priority level. If you still experiment troubles, use HIGH 
%    priority instead. Note that "REALTIME" priority does not ensure by itself that you'll get a 
%    perfect timing accuracy. "REALTIME" is just the name that Microsoft choosed for the highest 
%    priority level that a user program can get in the Windows operating system (which is NOT a 
%    real-time operating system).
%
%    SETPRIORITY LOW       Less than normal. Usefull to let Windows do its management task.
%
%    SETPRIORITY XXX -SILENT    runs in "silent" mode: displays nothing in command window.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SETSCREENSIZECM  Set screen size in centimeters.
%
%    SETSCREENSIZECM(wh)  defines physical size of the screen, overwriting the settings 
%    that GLab's got automatically from the operating system. 'wh' is a [width heigth] vector, in
%    cm. This setting will be used by PIX2DEG and DEG2PIX for pixels -> deg conversions.
%
%    SETSCREENSIZECM(width)  is the same than SETSCREENSIZECM([width 3/4*width]), 3/4 ration being
%    the tandard ration on CRT screens.
%
% See also GETSCREENSIZECM, SETVIEWINGDISTANCECM, SETHARDWARE<todo>, PIX2DEG, DEG2PIX, AICALIBRATION.
%
% Ben, June 2010.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SETTEXT   Set text properties.
%    SETTEXT(S)  where S is a structure returned by GETTEXT, sets all text properties.
%
%    SETTEXT(Property1,Value1,Property2,Value2,...)  sets given text property. Type 
%    "gettext" to get avalaible properties.
%
%    SETTEXT(b,S) or SETTEXT(b,Property,Value)  <PTB only> sets text properties for 
%    buffer b. Default b value is 0 (the backbuffer of the onscreen window).
%    If CG is used as graphics library, the b argument is ignored (settings are global).
%
% See also GETTEXT, DRAWTEXT.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SETUPGLAB  Install GraphicsLab toolbox.
%    SETUPGLAB  removes any existing G-Lab version from path,
%    then adds this version and saves path. Removes also from path any
%    existing Cogent2000 version, without saving.
%
%    SETUPGLAB(VSTR)  changes G-Lab current version. VSTR is 
%    the same version string than in the folder name. (i.e.:
%    ['G-Labv' VSTR] is the folder name and must correspond to
%    a valid sub-folder in the same parent folder than the current
%    version.)
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SETVIEWINGDISTANCECM  Define eye to screen distance.
%    SETVIEWINGDISTANCECM(D)  sets eye-screen distance as D cm. This value will be used by DEG2PIX
%    and PIX2DEG in place of the default. Default value is 360/(2*pi) = 57.2958 cm, distance at 
%    which 1 cm = 1 deg.
%
%    SETVIEWINGDISTANCECM(57)  resets to default (i.e.: 57.2958 cm, see above). 
%
% See also GETVIEWINGDISTANCECM, SETSCREENSIZECM, GETSCREENSIZECM, DEG2PIX, PIX2DEG.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SG  short for STOPGLAB.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SHOWBUFFERS  Display the content of offscreen buffers in a Matlab figure.
%    SHOWBUFFERS  shows the content of all buffers. Use the RIGHT ARROW and LEFT ARROWS keys to
%    navigate between them; press Q to quit.
%
%    SHOWBUFFERS(buffers)  shows specified buffers.
%
%    SHOWBUFFERS(buffers,rgb)  uses rgb code as background color.
%
% Ben, Sep 2007  v1.0
%      Oct 2009  v2.0
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SHOWHSV  Show hue/saturation/value planes of a HSV image matrix.
%    SHOWHSV(Ihsv)  shows HSV image 'Ihsv'.
%
% See also: SHOWRGB
% 
% Ben, Sept-Nov. 2007
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SHOWHUE  Display hue matrix of an image.
%    SHOWHUE(I)  Display hue matrix.
%    Ih = SHOWHUE(I)  Returns hue matrix.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SHOWIMAGE  Preview image(s).
%    This function will only work after STARTCOGENT or STARTPSYCH have
%    been run.
%    
%    SHOWIMAGE(I)
%    SHOWIMAGE(Cell)
%    SHOWIMAGE(FileNames)
%    SHOWIMAGE(FolderName)
%    SHOWIMAGE(BufferIDs)
%    SHOWIMAGE(..., <BackgroundColor>)
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SHOWIMAGEDIFF  Pixel per pixel difference of two images.
%    SHOWIMAGEDIFF(A,B)  shows B - A, channel by channel. Positive values are
%    lighter, negative values are darker. A and B be can be image matrices or 
%    image file names.
%
%    SHOWIMAGEDIFF(A,B,contrast)  multiplies difference by a contrast value.
%    
%       Examples: 
%       showimagediff(A,B,128)  shows differences in 3 colors: white is +,
%       black is -, grey is no diff.
%
%       showimagediff(A,B,1)    is the same than the default.
%
%       showimagediff(A,B,0.5)  scales to the whole range of possible values. 
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SHOWRGB  Show red, green and blue planes composing an image.
%    SHOWRGB(I)
%
% Programmer only:
%    ax = SHOWRGB(I,Ihsv)  is used by the SHOWHSV function.
%
% See also: SHOWHSV
% 
% Ben, Sept-Nov. 2007
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% STARTCOGENT  Start G-Lab, using Cogent as library.
%   STARTCOGENT  starts G-Lab with the CogentGraphics display, with default settings.
%
%   STARTCOGENT(Screen)  starts G-Lab Cogent with or without the CogentGraphics display.
%   'Screen' value can be 0 (display in a window), 1 (full screen display on main screen),
%   2 (full screen display on secondary screen), 3 (on screen #3), etc. If 'Screen' value 
%   is -1 or 'NoDisplay', Cogent starts without display. Display can be open later with
%   OPENDISPLAY.
%
%	STARTCOGENT(Screen,ScreenRes)  starts display at given screen resolution. Default 
%   'ScreenRes' value is [800 600].
%
%   STARTCOGENT(Screen,ScreenRes,BgColor)  starts display with BgColor as default 
%   background color. BgColor is an RGB triplet in the range 0.0 to 1.0.
%
%   STARTCOGENT(Screen,ScreenRes,<BgColor>,ScreenReqFreq)  checks that the actual 
%   screen frequency matches the frequency that was requested to the operating system. 
%   ScreenReqFreq must have the same value than in the OS configuration. The BgColor 
%   argument is optionnal.
%
%   STARTCOGENT(Screen,ScreenRes,<BgColor>,ScreenReqFreq,NumTestFrames)  specifies 
%   the number of frames to be displayed to do the screen frequency measure, which is done
%   at first start. The higher the NumFrames value, the higher the precision of the measure.
%   This is critical for EEG experiments. If NumTestFrames = 0, no test is done ; nominal 
%   value is kept as it. 
%
%   STARTCOGENT(...,'ExclusiveKeyboard')  gives exclusive control on the keyboard to 
%   Cogent. This option IS NEEDED if you need proper timing precision for keyboard events,
%   but in case of Cogent crash, you'll not be able to stop it with Ctrl+Alt+Del or another
%   Windows shortcut. So, use it with care: DO NOT USE IT WHILE YOU ARE DEBUGGING !!!
%
%   STARTCOGENT(...,'AlphaMode')  starts display in optimized mode for alpha blending.
%   There are problems with this mode; see "help opendisplay" for more infos.
%
% See also OPENDISPLAY, STOPGLAB.
%
% Ben, 2007 - 2008
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% STARTEYELINKCALIB
%    STARTEYELINKCALIB(CalibGrid,ScreenNum,ScreenRes <,ScreenBgColor>) 
%    CalibGrid can be 'H3', 'HV3', 'HV5', 'HV9' or 'HV13'. See EyeLink User Manual, fig. 2.3.2.2, p. 16.
%    ScreenNum, ScreenRes, ScreenBgColor are the same arguments that will be given to STARTGLAB during 
%    the experiment. Note that ScreenBgColor is optionnal but recommended, because background color has  
%    to be the same during calibration and experiment for optimal EyeLink accuracy.
%
% Example:
%    starteyelinkcalib('HV5', 0, [800 600], [.5 .5 .5]);
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% STARTGLAB  Initialize GLab toolbox.
%    See STARTCOGENT to start GLab over CogentGraphics (CG).
%    See STARTPSYCH to start GLab over PsychToolBox (PTB).
%
%    STARTGLAB('Cog',...)  starts GLab over CogentGraphics (CG).
%    STARTGLAB('PTB',...)  starts GLab over CogentGraphics (CG).
%
% See also STOPGLAB, CLEARGLAB.
%
% Ben, 2007 - 2008
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% STARTPSYCH    Start G-Lab, using PsychToolBox as library.
%    STARTPSYCH  opens a PTB display with default settings (800x600 window).
%
% <TODO: Finish doc See STARTCOGENT, for the moment.>
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% STARTTRACK  Run SR-Research's Track program, for EyeLink's camera setup.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% STARTTRIAL  Initialization of automatic processings during trial.
%    STARTTRIAL  initializes trial. Call this before the first DISPLAYBUFFER call of the trial.
%    This function is slow, and can take tens of msecs to execute. Actions wich have to be synchro-
%    nized with the onset of the first frame will be executed by the next DISPLAYBUFFER call.
%
%    STARTTRIAL(TargetNames)  initializes a trial with multiple targets. TargetNames is 1-by-N cell 
%    array of strings.
%
%    STARTTRIAL(nFrames)  initializes a trial of defined number of frames.
%
%    STARTTRIAL(TargetNames,nFrames)  cfr supra.
%
% Example:
%    for i = 1 : nTrials
%       ...
%       starttrial % Initializes new trial
%       ...
%       displaybuffer(0,duration) % Actual onset of the trial
%       ... % <-- during the trial: insert code here
%       stoptrial
%       ...
%    end
%
% See also: DRAWTARGET, DISPLAYBUFFER, WAITSYNCH, STOPTRIAL, SAVETRIALS.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% STDRGB   Convert to MATLAB most standard RGB format: doubles in the range 0-1.
%    RGB = STDRGB(RGB)  converts color/image matrix RGB. If RGB is an uint matrix,
%    convert it to double and divide it by 255 ; if it's already double, do nothing.
%
%    RGB = STDRGB(RGB,nChannels)  <todo>
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% STOPGLAB  Stop GraphicsLab.
%    STOPGLAB  closes display and everything that has been open by a GLab function.
%
% See also STARTGLAB, CLEARGLAB.
%
% Ben, Sept 2007 - March 2008
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% STOPTRIAL  End of automatic processings during trial.
%    DATA = STOPTRIAL  stops current trial and returns trial data in the structure DATA.
%
% See also: STARTRIAL.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% STOREIMAGE   Store image matrix in offscreen buffer. (Slow!)
%   b = STOREIMAGE(I)  creates an offscreen buffer, stores image I in it and
%   returns the buffer handle, b. I is an M-by-N-by-3 matrix in the range 0 to 1
%   (as returned by LOADIMAGE), or a cell array (1D or 2D) of such matrices.
%   On PTB, the created buffer will be optimized for fast drawing of the stored
%   image and performances will be significativelly better than with a buffer
%   created first with NEWBUFFER or NEWBUFFER(IMAGESIZE(I)). On the other hand, 
%   to draw into the buffer will be slower. (Technically, STOREIMAGE(I) creates
%   a texture, while NEWBUFFER creates an offscreen window.)
%
% <TODO: What to do whith the following syntaxes ?>
%	STOREIMAGE(I,b)  copies image I in an existing buffer b.
%   On PTB, in this case the already existing buffer will not be optimized. In 
%   most case, avoid this syntax: It can be usefull if you have a lot of things
%   to draw fastly *into* buffer b, but it'll be slower to copy data *from* b
%   to another buffer.
%
%	STOREIMAGE(I,b,[x y])  copies image I in buffer b with an x, y offset.
%   PTB: same remark as above.
%
% Deprecated syntax:
%   STOREIMAGE(I,b,x,y)
%
% See also LOADIMAGE, NEWBUFFER, COPYBUFFER.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% STOREPURETONE  Fill sound buffer with sin wave of specified duration and frequency.
%    The sound system must have been initialized with OPENSOUND before to use this
%    function. Once stored in buffer, the sound can be played with PLAYSOUND.
%    STOREPURETONE(frequency,duration)  creates a sound buffer (buffer 1) and fills 
%       it with sin wave of given frequency (in Hz) and duration (in ms).
%       Note that the range of human audition is frome 20Hz to 20000Hz.
%    STOREPURETONE(frequency,duration,buffer_number)  creates and fills sound buffer
%       of given number. This number can then be given as input argument to PLAYSOUND. 
%
% Examples:
%     storepuretone(500,1000) prepares a 500Hz 1000 millisecond sine wave (in buffer 1).
%     storepuretone(500,1000,3) prepares a 500Hz 1000 millisecond sine wave in buffer 3.
%
% Ben, Jan 2008.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
%% STORESOUND  Transfer a sound matrix from the matlab workspace to a sound buffer.
%    The sound system must have been initialized with OPENSOUND before to use this
%    function. Once stored in buffer, the sound can be played with PLAYSOUND.
%
%    STORESOUND(FileName)  loads sound from *.wav file and stores it in default
%    sound buffer (buffer 1).
%
%    STORESOUND(SoundMatrix)  stores SoundMatrix in default sound buffer (buffer 1).
%    SoundMatrix is a N-by-1 (mono) or a N-by-2 (stereo) matrix of values in the 
%    range -1 to +1.
%
%    STORESOUND(FileName,b)  or,
%    STORESOUND(SoundMatrix,b)  stores sound in sound buffer b. b can then be given
%    as input argument to PLAYSOUND.
%
% Example:
%    opensound;                                 % initialize sound system.
%    storesound('C:\WINDOWS\Media\ringin.wav'); % stores sound in sound buffer.
%    t0 = playsound;                            % starts playing.
%    t1 = waitsound;                            % waits until end of playing.
%
% See also: OPENSOUND, SINEWAVE, STORETUUT, PLAYSOUND, WAITSOUND.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% STORETUUT  Fill sound buffer with sin wave of specified duration and frequency.
%    The sound system must have been initialized with OPENSOUND before to use this
%    function. Once stored in buffer, the sound can be played with PLAYSOUND.
%
%    STORETUUT(frequency,duration)  creates a sound buffer (buffer 1) and fills it 
%    with sin wave of given frequency (in Hz) and duration (in ms). Note that the 
%    range of human audition is from 20Hz to 20000Hz.
%
%    STORETUUT(frequency,duration,buffer_number)  creates and fills sound buffer
%    of given number. This number can then be given as input argument to PLAYSOUND. 
%
% Examples:
%     storetuut(500,1000) prepares a 500Hz 1000 millisecond sine wave (in buffer 1).
%     storetuut(500,1000,3) prepares a 500Hz 1000 millisecond sine wave in buffer 3.
%
% See also: SINEWAVE, STORESOUND, STOREWHITENOISE.
%
% Ben, Jan 2008.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% STOREWHITENOISE  Fill sound buffer with white noise of specified duration.
%    STOREWHITENOISE(duration,b)  fills sound buffer b with white noise of specified duration in
%    milliseconds.
%
% Example:
%    storewhitenoise(1000,1);  % prepares 1000 milliseconds of white noise in buffer 1.
%
% See also: SINEWAVE, STORESOUND, STORETUUT.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% TESTANIMATION  Test program.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% TIME  Return current time in milliseconds.
%    t = TIME  returns time in milliseconds since G-Lab 
%    startup or since last call to TIME(0).
%
% CG only:
%    TIME(0)  resets timer. Not supported on PTB.
%
% See also : STARTCOGENT, WAIT, WAITSYNCH.
%
% G-Lab function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% TRIAL2BLOCK                      <TODO: write doc>
%    BL = TRIAL2BLOCK(TR)
%
%    [perTrial,perDisplay,perFrame] = TRIAL2BLOCK(TR)
%
%    [perTrial,perDisplay,perFrame,EventsString] = TRIAL2BLOCK(TR)
%
% Example:
%    [pt,pd,pf] = trials2block(gettrials)
%
% Ben, July 2010.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% WAIT  Wait for a specified duration.
%    WAIT(t)  waits t milliseconds. Note that this wait is not synchronized
%    with the screen refresh cycle. See WAITSYNCH for that.
%
%    Programmer note: Over PTB the function avoids system overload, 
%    but over Cogent, it's a buzzy wait. <TODO: Use always PTB ???>
%
% See also : WAITSYNCH, WAITFRAME, WAITUNTIL, TIME.
%
% G-Lab function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% WAITFRAME   Wait for frame update(s).
%    t = WAITFRAME  waits until next screen refresh onset and returns time.
%    
%    t = WAITFRAME(N)  waits for N frame updates.
%
%    [t,err] = WAITFRAME(...)  returns error status. "err" is an estimation 
%    of the number of missed frames. Note that the computation of err is not 
%    100pc reliable.
%
% See also : WAITSYNCH, WAITUNTIL, WAIT.
%
% Note: There is a also WAITFRAME function in Cogent2000: Dont use it! 
%       It's critically bugged!
%
% Ben, Nov. 2008. 
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% WAITKEYDOWN  Wait for a key press.
%    [keyNumber,time] = WAITKEYDOWN  Waits for any key press and returns the key ID number and time.
%    
%    [keyOut,time] = WAITKEYDOWN(keyName|keyNumber|keyCode)  waits only for the specified keys.
%    keyOut is at the same format than the input argument (name, number or code). <TODO!>
%
%    [keyOut,time] = WAITKEYDOWN(keyName|keyNumber|keyCode,timeout)  waits no more than given 
%    timeout (ms).
%
%    [keyOut,time] = WAITKEYDOWN(keyName|keyNumber|keyCode,<timeout>,lib)  forces library to use.
%    lib can be 'Cog' or 'PTB'.
%
% See also: OPENKEYBOARD, WAITKEYUP, GETKEYDOWN, GETKEYUP, GETKEYNUMBER, GETKEYCODE, GETKEYNAME.
%
% Ben, Feb. 2009.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% WAITKEYSEQUENCE  Wait for a sequence of key presses. <Cog only>
%    [IDs,isDown,Times,isError] = WAITKEYSEQUENCE(KeySequence)
%
%    [IDs,isDown,Times,isError] =  WAITKEYSEQUENCE(KeySequence,IgnoredKeys) ??
%
% TODO: 'Peek'/'Get' modes. (Now it's 'Peek'). See GETKEYEVENTS, PEEKKEYEVENTS.
% 
% G-Lab function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% WAITKEYUP waits for a key to be released.
%    Syntax is the same than WAITKEYDOWN. See.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% WAITMOUSECLICK  Wait mouse button click.
%    WAITMOUSECLICK  .
%    b = WAITMOUSECLICK  waits until user presses any mouse button  
%    and returns button number b (1=left, 2=middle, 4=right).
%
%    [b,t] = WAITMOUSECLICK  returns also time t (msec).
%
% See also GETMOUSE (GLab function), GetClicks (PTB function).
%
% Ben, 2007.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% WAITSCREEN  Display a message and wait for any key press.
%    WAITSCREEN(Message)
%    WAITSCREEN(Message,Option1,Option2,...)  defines text options.
%       See DRAWTEXT for text options.
%    Key = WAITSCREEN(...)  returns the key id. (See GETKEYMAP)
%    [Key,Time] = WAITSCREEN(...)  returns also the time when the key was
%       pushed down.
%
% Example 1:
%    waitscreen('Press any key when ready.');
%
% Example 2:
%    Key = waitscreen('Press ENTER to continue, Esc to exit.');
%    if strcmp(Key,'Escape'), return, end
%
% See also DRAWTEXT, WAITKEYDOWN, GETKEYMAP.
%
% Ben, Nov. 2007
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% WAITSERIALBYTE wait for byte to arrive on serial port
%
% Description:
%     Wait for serial byte to arrive at port.  The port need to be configured with CONFIG_PORT before 
%     WAITSERIALBYTE can be called.  
%
% Usage:
%     [ byte, t, n ] = WAITSERIALBYTE( port, duration )       - wait 'duration' milliseconds for any byte
%                                                               to arrive at COM port
%     [ byte, t, n ] = WAITSERIALBYTE( port, duration, code ) - wait 'duration' milliseconds for byte 'code' to 
%                                                               arrive at COM port 
%
% Arguments:
%    byte     - value of byte read at port
%    t        - time of byte read
%    n        - number of serial bytes returns
%    port     - serial port number
%    code     - serial bytes to wait for
%    duration - duration (in milliseconds) to wait for a serial byte
%
% Examples:
%     WAITSERIALBYTE( 1, 1000 )            - wait 1000 milliseconds for any byte to arrive on COM1
%     WAITSERIALBYTE( 2, 2000, 10 )        - wait 2000 milliseconds for byte=10 to arrive on COM2
%     WAITSERIALBYTE( 2, 2000, [ 10 20 ] ) - wait 2000 milliseconds for bytes 10 or 20 to arrive on COM2
%     WAITSERIALBYTE( 1, inf )             - wait for an indefinte amount of time for any byte to arrive on COM1
%     WAITSERIALBYTE( 2, inf, 10 )         - wait for an indefinte amount of time for byte=10 to arrive on COM2
%     WAITSERIALBYTE( 2, inf, [ 10 20 ] )  - wait for an indefinte amount of time for bytes 10 or 20 to arrive 
%                                          - on COM2
%
% See also:
%     CONFIG_SERIAL, READSERIALBYTES, SENDSERIALBYTES, LOGSERIALBYTES, WAITSERIALBYTE, GETSERIALBYTES
%
% Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% WAITSOUND  Wait sound playing end.
%    t1 = WAITSOUND  wait until default sound buffer (buffer 1) has  
%    stopped playing and returns offset time.
%
%    t1 = WAITSOUND(b) - wait until buffer b has stopped playing.
%
% Example:
%    opensound;                                 % initialize sound system.
%    storesound('C:\WINDOWS\Media\ringin.wav'); % stores sound in sound buffer.
%    t0 = playsound;                            % starts playing.
%    t1 = waitsound;                            % waits until end of playing.
%
% See also: OPENSOUND, STORESOUND, STORETUUT, PLAYSOUND, WAITSOUND.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% WAITSYNCH  Wait function for real-time display programs.
%    This function is intended to be used in conjunction with DISPLAYBUFFER.
%
%    t0 = WAITSYNCH  or  t0 = WAITSYNCH(0)  waits the beginning of next refresh
%    cycle.  This is the same than:  t0 = WAITFRAME.
%
%    WAITSYNCH(t)  waits t milliseconds between two displays. Waiting is synchro-
%    nized with the screen refresh cycle : wait duration will be rounded to an 
%    integer number of screen frames and will end precisely at the beginning  
%    of the last refresh cycle, so the next call to DISPLAYBUFFER will display  
%    exactly t ms after the previous one.
%
%    WAITSYNCH(t,unit)  waits t units. Unit can be 'ms' (default), 'sec' (or 's')
%    or 'frame'.
%
%    err = WAITSYNCH(...)  returns error status. "err" is an estimation of the
%    number of missed frames. (This is not 100pc reliable.)
%
% GLab programmer only: 
%    WAITSYNCH(t,'ms','-displaybuffer')  is used by displaybuffer.
%
% Example: Wait 500ms between two displays
%    displaybuffer(b1); % displays buffer b1.
%    waitsynch(500)     % waits the time needed (actually less than 500ms).
%    displaybuffer(b);  % displays buffer b2, 500ms after buffer b1.
%
% See also : DISPLAYBUFFER, GETFRAMEDUR, WAITFRAME, WAIT, TIME.
%
% Ben,	Oct 2007
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% WAITUNTIL  Waits until specified time.
%    WAITUNTIL(t)  Wait until specified time (as measured by function TIME).
%
% Example:
%    t0 = time;
%    waituntil(t0 + 1000);
%
% See also : WAIT, WAITSYNCH.
%
% G-Lab function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           




II. ORIGINAL COGENT 2000 FUNCTIONS:
===========================================================================


% CLEARKEYS clears all keyboard events
%
% Description:
%     Clears all keyboard events.
%
% Usage:
%     CLEARKEYS
%
% Arguments:
%     NONE
%
% Examples:
%
% See also:
%
% Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% COUNTKEYDOWN counts the number of key down events read in last call to READKEYS
%
% Description:
%     Counts the number of key down events read in last call to READKEYS
%
% Usage:
%     n = COUNTKEYDOWN
%
% Arguments:
%     n - number of keydown events
%
% Examples:
%
% See also:
%     CONFIG_KEYBOARD, READKEYS, LOGKEYS, WAITKEYDOWN, WAITKEYUP, LASTKEYDOWN, LASTKEYUP, GETKEYDOWN, 
%     GETKEYUP, GETKEYMAP, COUNTKEYDOWN, COUNTKEYUP
%
% Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% COUNTKEYUP counts the number of key up events read in last call to READKEYS
%
% Description:
%     Counts the number of key up events read in last call to READKEYS
%
% Usage:
%     n = COUNTKEYUP
%
% Arguments:
%     n - number of keyup events
%
% Examples:
%
% See also:
%     CONFIG_KEYBOARD, READKEYS, LOGKEYS, WAITKEYDOWN, WAITKEYUP, LASTKEYDOWN, LASTKEYUP, GETKEYDOWN, 
%     GETKEYUP, GETKEYMAP, COUNTKEYDOWN, COUNTKEYUP
%
% Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETKEYDOWN returns the key IDs and times of key presses read by last call to READKEYS
%
% Description:
%    Returns the key IDs and times of key presses read by last call to READKEYS.  Use GETKEYMAP to determine key IDs.
%
% Usage:
%     [ keyout, time, n ] = GETKEYDOWN
%     [ keyout, time, n ] = GETKEYDOWN( keyin )
%
% Arguments:
%     keyin  - array of key IDs to check for presses
%     keyout - array of key IDs of keys that have been pressed
%     time   - array of time of key presses
%     n      - number of key presses
%
% Examples:
%     [ keyout, time, n ] = GETKEYDOWN              - get all key presses
%     [ keyout, time, n ] = GETKEYDOWN( 1 )         - get all presses of key 1 (A)
%     [ keyout, time, n ] = GETKEYDOWN( [ 1 2 4 ] ) - get all presses of keys 1, 2 and 4 (A,B and C)
%
% See also:
%     CONFIG_KEYBOARD, READKEYS, LOGKEYS, WAITKEYDOWN, WAITKEYUP, LASTKEYDOWN, LASTKEYUP, GETKEYDOWN, 
%     GETKEYUP, GETKEYMAP, COUNTKEYDOWN, COUNTKEYUP
%
% Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETKEYMAP returns key IDs
%
% Description:
%     Return a structure containing key IDs.  Structure fields correspond to key names and
%     field values are key IDs.
%
% Usage:
%     map = GETKEYMAP
%
% Arguments:
%     map - keyboard map
%
% Examples:
%     map = getkeymap;  waitkeydown( map.Space ); - wait for space key to be pressed
%     map = getkeymap;  waitkeyup( map.A );       - wait for key a to be released
%
% See also:
%     CONFIG_KEYBOARD, READKEYS, LOGKEYS, WAITKEYDOWN, WAITKEYUP, LASTKEYDOWN, LASTKEYUP, GETKEYDOWN, 
%     GETKEYUP, GETKEYMAP, COUNTKEYDOWN, COUNTKEYUP
%
% Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETKEYUP gets the key IDs and times of key releases read in last call to READKEYS or CLEARKEYS
%
% Description:
%     Returns key IDs and times
%
% Usage:
%     [ keyout, time, n ] = GETKEYUP          - return key IDs and times of all key releases
%     [ keyout, time, n ] = GETKEYUP( keyin ) - return key IDs and times of key releases for specified keys
%
% Arguments:
%     keyin  - array of IDs to check for key releases
%     keyout - array of IDs of keys that have been released
%     time   - array of times of the key releases
%     n      - number of key releases
%
% Examples:
%     [ keyout, time, n ] = GETKEYUP              - get all key releases
%     [ keyout, time, n ] = GETKEYUP( 1 )         - get all releases of key 1 (A)
%     [ keyout, time, n ] = GETKEYUP( [ 1 2 4 ] ) - get all releases of keys 1, 2 and 4 (A,B and C)
%
% See also:
%     CONFIG_KEYBOARD, READKEYS, LOGKEYS, WAITKEYDOWN, WAITKEYUP, LASTKEYDOWN, LASTKEYUP, GETKEYDOWN, 
%     GETKEYUP, GETKEYMAP, COUNTKEYDOWN, COUNTKEYUP
%
% Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETRECORDING get recording buffer and return as matrix.
%
% Description:
%     Get current recording and return as a nchannels by nsamples matlab matrix.  
%
% Usage:
%     GETRECORDING
%
% Arguments:
%     NONE
%
% See also:
%     PREPARERECORDING, RECORDSOUND, WAITRECORD    
%
%   Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETSOUNDFREQ sets frequency of sound buffer
%
% Description:
%    Sets frequency of sound buffer in samples per second
%
% Usage:
%    freq = GETSOUNDFREQ( buff )
%
% Arguments:
%     buff - buffer number
%     freq  - frequency of buffer in sampleds per second
%
% Examples:
%
% See also:
%      CONFIG_SOUND, PREPARESOUND, PREPAREPURETONE, PREPAREWHITENOISE, LOADSOUND, WAITSOUND,
%      SOUNDPOSITION, SETSOUNDFREQ, GETSOUNDFREQ, GETSOUNDVOL, SETSOUNDVOL
%
% Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% GETSOUNDVOL gets volume of sound buffer
%
% Description:
%    Returns volume of sound buffer in hundredths of decibels ( 0 to -10000 )
%
% Usage:
%    GETSOUNDVOL( buff )
%
% Arguments:
%     buff - buffer number
%     vol  - volume of buffer in hundredths of decibels ( 0 to -10000 )
%
% Examples:
%
% See also:
%      CONFIG_SOUND, PREPARESOUND, PREPAREPURETONE, PREPAREWHITENOISE, LOADSOUND, WAITSOUND,
%      SOUNDPOSITION, SETSOUNDFREQ, GETSOUNDFREQ, GETSOUNDVOL, SETSOUNDVOL
%
% Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% LASTKEYDOWN returns the key and time of the most recent key press
%
% Description:
%     Returns the key and time of the most recent key press read by READKEYS.
%
% Usage: 
%     [ key, time ] = LASTKEYDOWN  
%
% Arguments:
%     key    - id of key           (0 if no key press)
%     time   - time of key press   (0 if no key press)
%
% Examples:
%
% See also:
%     CONFIG_KEYBOARD, READKEYS, LOGKEYS, WAITKEYDOWN, WAITKEYUP, LASTKEYDOWN, LASTKEYUP, GETKEYDOWN, 
%     GETKEYUP, GETKEYMAP
%
% Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% LASTKEYUP returns the key and time of the most recent key release.
%
% Description:
%     Returns the key and time of the most recent key release read by READKEYS
%
% Usage: 
%     [ key, time ] = LASTKEYUP
%
% Arguments:
%     key    - id of key           (0 if no key released)
%     time   - time of key press   (0 if no key released)
%
% Examples:
%
% See also:
%     CONFIG_KEYBOARD, READKEYS, LOGKEYS, WAITKEYDOWN, WAITKEYUP, LASTKEYDOWN, LASTKEYUP, GETKEYDOWN, 
%     GETKEYUP, GETKEYMAP
%
% Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% LOOPSOUND starts a sound buffer playing in a continuous loop
%
% Description:
%    Starts a sound buffer playing in a continuous loop.  To create this buffer use commands LOADSOUND
%    or PREPARESOUND. To stop buffer from playing use command STOPSOUND.
%
% Usage:
%    LOOPSOUND( buff ) - play sound in buffer 'buff'
%
% Arguments:
%     buff - buffer number
%
% Examples:
%
% See also:
%     CONFIG_SOUND, PREPARESOUND, PREPAREPURETONE, PREPAREWHITENOISE, LOADSOUND, WAITSOUND,
%     SOUNDPOSITION, LOOPSOUND, STOPSOUND.
%
% Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% PAUSEKEY pauses a key has been pressed and waits for another key press.
% PAUSEKEY(key) pauses if specific key has been pressed and waits for another key press.
%
% Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% PREPARERECORDING prepare recording buffer
%
% Description:
%     Prepare recording buffer for mono or stereo recording of specific duration
%
% Usage:
%     PREPARERECORDING( duration )            - prepare for mono recording
%     PREPARERECORDING( duration, nchannels ) - prepare for mono or stereo recording
%
% Arguments:
%     duration  - duration of recording in milliseconds
%     nchannels - number of channels (1-mono 2-stereo)
%
% See also:
%     GETRECORDING, RECORDSOUND, WAITRECORD    
%
%   Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% READKEYS  Read all keyboard events since last call to READKEYS or CLEARKEYS
%    READKEYS  reads all keyboard events since last call to READKEYS or CLEARKEYS.
%       Key IDs are defined in the structure returned by GETKEYMAP (Qwerty us)
%       or GETBELGIANMAP (Azerty be).
%
% Cogent 2000 function. v1.0
% Ben, Mar. 2008. 		v1.0.1	Modif. doc.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% RECORDSOUND start recording sound
%
% Description:
%     Start recording sounds into buffer setup by PREPARERECORDING
%
% Usage:
%     Record sound
%
% Arguments:
%     NONE
%
% See also:
%     PREPARERECORDING, GETRECORDING, WAITRECORD
%
% Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SAVERECORDING saves contents of recording buffer as a WAV file
%
% Description:
%     Saves contents of recording buffer as a WAV file
%
% Usage:
%     SAVERECORDING( filename ) - save recording to file 'filename'
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SETSOUNDFREQ sets frequency of sound buffer
%
% Description:
%    Sets frequency of sound buffer in samples per second
%
% Usage:
%    SETSOUNDFREQ( buff )
%
% Arguments:
%     buff - buffer number
%     freq  - frequency of buffer in sampleds per second
%
% Examples:
%
% See also:
%      CONFIG_SOUND, PREPARESOUND, PREPAREPURETONE, PREPAREWHITENOISE, LOADSOUND, WAITSOUND,
%      SOUNDPOSITION, SETSOUNDFREQ, GETSOUNDFREQ, GETSOUNDVOL, SETSOUNDVOL
%
% Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SETSOUNDPOSITION sets current play position of sound buffer
%
% Description:
%     Sets current play position of sound buffer.
%
% Usage:
%     SETSOUNDPOSITION( buff, pos )  - set play position of buffer 'buff'
%
% Arguments:
%     buff - sound buffer number
%     pos  - play position
%
% Examples:
%
% See also:
%     CONFIG_SOUND, PREPARESOUND, PREPAREPURETONE, PREPAREWHITENOISE, LOADSOUND, WAITSOUND,
%     SOUNDPOSITION, LOOPSOUND, STOPSOUND.
%
% Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SETSOUNDVOL sets volume of sound buffer
%
% Description:
%    Sets volume of sound buffer in hundredths of decibels ( 0 to -10000 )
%
% Usage:
%    SETSOUNDVOL( buff )
%
% Arguments:
%     buff - buffer number
%     vol  - volume of buffer in hundredths of decibels ( 0 to -10000 )
%
% Examples:
%
% See also:
%      CONFIG_SOUND, PREPARESOUND, PREPAREPURETONE, PREPAREWHITENOISE, LOADSOUND, WAITSOUND,
%      SOUNDPOSITION, SETSOUNDFREQ, GETSOUNDFREQ, GETSOUNDVOL, SETSOUNDVOL
%
% Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% SOUNDPOSITION returns current play position of sound buffer
%
% Description:
%     Returns current play position of sound buffer.
%
% Usage:
%     SOUNDPOSITION( buff )  - play position of buffer 'buff'
%
% Arguments:
%     buff - sound buffer number
%
% Examples:
%
% See also:
%     CONFIG_SOUND, PREPARESOUND, PREPAREPURETONE, PREPAREWHITENOISE, LOADSOUND, WAITSOUND,
%     SOUNDPOSITION, LOOPSOUND, STOPSOUND.
%
% Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% STOPSOUND stops a sound buffer playing.
%
% Description:
%    Stops a sound buffer playing.
%
% Usage:
%    STOPSOUND( buff ) - play sound in buffer 'buff'
%
% Arguments:
%     buff - buffer number
%
% Examples:
%
% See also:
%     CONFIG_SOUND, PREPARESOUND, PREPAREPURETONE, PREPAREWHITENOISE, LOADSOUND, WAITSOUND,
%     SOUNDPOSITION, LOOPSOUND, STOPSOUND.
%
% Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% Read previous keypresses.
% Wait for a specific key to be pressed after the call to waitkey.
% All key presses will be automatically read.
%
% Cogent 2000 function.  v1.0
% Ben, Mar. 2008: 		 v1.1	Suppress logging and display in Matlab 
%                 				Command window for timing accuracy.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
% WAITRECORD wait for recording to finish
%
% Description:
%    Wait for recording to finish.
%
% Usage:
%    WAITRECORD
%
% Arguments:
%    NONE
%
% See also:
%     PREPARERECORDING, GETRECORDING, RECORDSOUND
%
% Cogent 2000 function.
                                                                           
___________________________________________________________________________
                                                                           
                                                                           
